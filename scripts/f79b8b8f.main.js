(function(){var a=[].slice;define("events",[],function(){var b;return b=function(){function b(){this.directory={}}return b.prototype.on=function(a,b){var c;return null==this.directory[a]&&(this.directory[a]=[]),c=this.directory[a],c.push(b)},b.prototype.off=function(a,b){var c;if(null!=this.directory[a])return c=this.directory[a],this.directory[a]=_.without(c,b)},b.prototype.trigger=function(){var b,c,d;return d=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],null!=this.directory[d]?(c=this.directory[d],_.each(c,function(a){return a.apply(this,b)})):void 0},b.prototype.clear=function(){return this.directory={}},b}()})}).call(this),function(){define("stage",["events"],function(a){var b;return b=function(){function b(b){var c,d;this.options=b,c=this.createCanvas(),d=this.options.container,d.appendChild(c),this.stage=new PIXI.Stage(1190457,!0),this.stage.setInteractive(!0),this.stage.setBackgroundColor(1190457),this.width=c.width,this.height=c.height,this.pixiRenderer=PIXI.autoDetectRenderer(this.width,this.height,c),this.pixleRatio=window.devicePixelRatio,this.container=new PIXI.DisplayObjectContainer,this.container.width=this.width/this.pixleRatio,this.container.height=this.height/this.pixleRatio,this.container.pivot=new PIXI.Point(.5,.5),this.container.scale=new PIXI.Point(this.pixleRatio,this.pixleRatio),this.stage.addChild(this.container),createjs.Sound.initializeDefaultPlugins(),createjs.Sound.registerPlugins([createjs.CocoonJSAudioPlugin]),this.events=new a}return b.prototype.createCanvas=function(){var a;return a=document.createElement("canvas"),a.style.width=this.options.width,a.style.height=this.options.height,a.width=this.options.width*window.devicePixelRatio,a.height=this.options.height*window.devicePixelRatio,a},b.prototype.startMainLoop=function(){var a,b=this;return(a=function(){return b.paused?void 0:(b.events.trigger("frame"),b.render(),requestAnimFrame(a))})()},b.prototype.pause=function(){return this.paused=!0},b.prototype.resume=function(){return this.paused=!1,this.startMainLoop()},b.prototype.getContainer=function(){return this.container},b.prototype.getPixiRenderer=function(){return this.pixiRenderer},b.prototype.render=function(){return this.pixiRenderer.render(this.stage)},b.prototype.clear=function(){var a;for(a=[];this.container.children.length>0;)a.push(this.container.removeChild(this.container.children[0]));return a},b.prototype.getWidth=function(){return this.container.width},b.prototype.getHeight=function(){return this.container.height},b}()})}.call(this),function(){define("asset_loader",[],function(){var a;return a=function(){function a(){}return a.loadAudioAssets=function(a){var b,c;return console.log("loading sounds"),b=0,createjs.Sound.alternateExtensions=["wav"],c=new Promise(function(c){return createjs.Sound.addEventListener("fileload",function(d){return console.log("loaded "+d.src),b+=1,b===a.length?(console.log("done loading sounds"),c()):void 0}),createjs.Sound.registerManifest(a,"audio/")})},a.loadGraphicAssets=function(a){return console.log("loading graphcis"),new Promise(function(b){var c;return c=new PIXI.AssetLoader(a),c.load(),c.addEventListener("onComplete",function(){return console.log("done loading graphics"),b()})})},a.loadAssets=function(a,b){return Promise.all([this.loadAudioAssets(b,this.loadGraphicAssets(a))])},a}()})}.call(this),function(){define("stopwatch",[],function(){var a;return a=function(){function a(){this.marks={}}return a.prototype.getFrameTime=function(){var a,b;if(this.paused)throw new Error("Time is paused. Cannot read frame time");return b=(new Date).getTime(),a=null!=this.lastTime?(b-this.lastTime)/1e3:1/60,this.lastTime=b,a},a.prototype.setMark=function(a){return this.marks[a]=new Date},a.prototype.getTimeSinceMark=function(a){var b;if(null==this.marks[a])throw"no mark "+a+" have been defined";return b=new Date,b-this.marks[a]},a.prototype.pause=function(){var a;return a=new Date,this.frameTimeAtPause=a-this.lastTime,this.paused=!0},a.prototype.resume=function(){var a;return this.paused=!1,a=new Date,this.lastTime=a-this.frameTimeAtPause},a}()})}.call(this),function(){define("view",["stopwatch","events"],function(a,b){var c;return c=function(){function c(c,d){this.container=c,this.camera=d,this.container=this.container,this.stopwatch=new a,this.graphics=this.createGraphics(),this.addedToContainer=!1,this.events=new b}return c.prototype.render=function(){return this.addedToContainer||(this.addedToContainer=!0,this.container.addChild(this.graphics),"function"==typeof this.onAppearance&&this.onAppearance()),"function"==typeof this.updateGraphics?this.updateGraphics():void 0},c.prototype.destroy=function(){var a=this;return"function"==typeof this.onDestroy&&this.onDestroy(),null!=this.activePromise?this.activePromise.then(function(){return a.container.removeChild(a.graphics)}):this.container.removeChild(this.graphics)},c.prototype.getFrameTime=function(){return this.stopwatch.getFrameTime()},c.prototype.pushToTop=function(){return this.container.removeChild(this.graphics),this.container.addChild(this.graphics)},c.prototype.setActivePromise=function(a){return this.activePromise=a},c}()})}.call(this),function(){define("pixi_animator",[],function(){var a;return a=function(){function a(a){this.graphics=a}return a.prototype.fadeIn=function(a,b,c){var d,e,f=this;return e=new Date,d=(e-b)/c,this.graphics.alpha=d,this.graphics.alpha<1?requestAnimFrame(function(){return f.fadeIn(a,b,c)}):(this.graphics.alpha=1,a())},a.prototype.stay=function(a,b,c){return setTimeout(function(){return a()},c)},a.prototype.fadeOut=function(a,b,c){var d,e,f=this;return e=new Date,d=1-(e-b)/c,this.graphics.alpha=d,this.graphics.alpha>0?requestAnimFrame(function(){return f.fadeOut(a,b,c)}):(this.graphics.alpha=0,a())},a.prototype.grow=function(a,b,c,d){var e,f;return e=this.graphics.scale.x,f=d.by*this.graphics.scale.x,this._grow(a,b,c,e,f)},a.prototype._grow=function(a,b,c,d,e){var f,g,h,i=this;return f=new Date,g=(f-b)/c,h=d+(e-d)*g,this.graphics.scale.x=h,this.graphics.scale.y=h,e>h?requestAnimFrame(function(){return i._grow(a,b,c,d,e)}):(this.graphics.scale.x=e,this.graphics.scale.y=e,a())},a.prototype.animateParallel=function(a){var b,c;return b=this._createFunctions(a),c=new Promise(function(a){return async.parallel(b,function(){return a()})})},a.prototype.animate=function(a){var b,c;return b=this._createFunctions(a),c=new Promise(function(a){return async.series(b,function(){return a()})})},a.prototype._createFunctions=function(a){var b,c,d,e,f,g=this;for(c=[],e=0,f=a.length;f>e;e++)b=a[e],d=function(){var a,c,d;return a=g[b.type],c=b.duration,d=_(b).clone(),function(b){var e;return e=new Date,a.call(g,b,e,c,d)}}(),c.push(d);return c},a}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("splashscreen_view",["view","pixi_animator"],function(a,c){var d;return d=function(a){function d(a){d.__super__.constructor.call(this,a)}return b(d,a),d.prototype.createGraphics=function(){var a,b,c,d,e;return e=PIXI.Texture.fromImage("images/splashscreen.png"),d=new PIXI.Sprite(e),b=this.container.width/d.width,c=this.container.height/d.height,a=Math.min(b,c),d.scale=new PIXI.Point(a,a),d.position=new PIXI.Point(this.container.width/2,this.container.height/2),d.anchor=new PIXI.Point(.5,.5),d.alpha=0,d},d.prototype.onAppearance=function(){return new c(this.graphics).animate([{type:"fadeIn",duration:1e3}])},d.prototype.fadeOut=function(){return new c(this.graphics).animate([{type:"fadeOut",duration:1e3}])},d.prototype.updateGraphics=function(){},d}(a)})}.call(this),function(){define("box2d",[],function(){return window.B2D={Vec2:Box2D.Common.Math.b2Vec2,BodyDef:Box2D.Dynamics.b2BodyDef,Body:Box2D.Dynamics.b2Body,FixtureDef:Box2D.Dynamics.b2FixtureDef,Fixture:Box2D.Dynamics.b2Fixture,World:Box2D.Dynamics.b2World,MassData:Box2D.Collision.Shapes.b2MassData,PolygonShape:Box2D.Collision.Shapes.b2PolygonShape,CircleShape:Box2D.Collision.Shapes.b2CircleShape,DebugDraw:Box2D.Dynamics.b2DebugDraw,Mat22:Box2D.Common.Math.b2Mat22,WorldManifold:Box2D.Collision.b2WorldManifold}})}.call(this),function(){define("typed_object",[],function(){var a;return a=function(){function a(a){this.type=a,this.id=""+this.type+"_"+Math.random()}return a.prototype.toString=function(){return this.id},a}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("entity",["typed_object","box2d","events"],function(a,c,d){var e;return e=function(a){function e(a){e.__super__.constructor.call(this,a),this._exists=!0,this.events=new d}return b(e,a),e.prototype.setBody=function(a){return this.body=a},e.prototype.getEntityDef=function(){var a,b;return a=new c.BodyDef,a.type=c.Body.b2_dynamicBody,a.position=new c.Vec2(30,30),a.angularDamping=5,b=new c.FixtureDef,b.mass=1,b.density=1,b.friction=0,b.shape=new c.PolygonShape,b.shape.SetAsBox(1,1),{bodyDef:a,fixtureDef:b}},e.prototype.getPosition=function(){return this.body.GetPosition()},e.prototype.setPosition=function(a){return this.body.SetPosition(a)},e.prototype.setSpeed=function(a){return this.body.SetLinearVelocity(a)},e.prototype.getSpeed=function(){return this.body.GetLinearVelocity()},e.prototype.getAngle=function(){return this.body.GetAngle()},e.prototype.setAngle=function(a){return this.body.SetAngle(a)},e.prototype.destroy=function(){return this._exists=!1,this.events.trigger("destroy",this)},e.prototype.exists=function(){return this._exists},e.prototype.getAABB=function(){return this.body.GetFixtureList().GetAABB()},e.prototype.on=function(a,b){return this.events.on(a,b)},e.prototype.handleEnterWorld=function(){},e.prototype.handleExitWorld=function(){},e}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("astroid",["entity"],function(a){var c;return window.log=_.throttle(function(a){return console.log(a)},100),c=function(a){function c(a){c.__super__.constructor.call(this,"astroid"),this.radius=a.radius,this.planet=a.planet,this.density=a.density,this.forceWasApplied=!1}return b(c,a),c.prototype.getEntityDef=function(){var a,b;return a=new B2D.BodyDef,a.type=B2D.Body.b2_dynamicBody,a.position=new B2D.Vec2(0,0),b=new B2D.FixtureDef,b.density=this.density,b.friction=0,b.shape=new B2D.CircleShape(this.radius),{bodyDef:a,fixtureDef:b}},c.prototype.update=function(){var a,b,c,d;return c=this.planet.getPosition().Copy(),c.Subtract(this.getPosition()),b=c.Length(),c.Normalize(),a=.003,d=a*this.body.GetMass()*this.body.GetMass(),null!=c&&c.Multiply(d),this.body.ApplyForce(c,this.body.GetWorldPoint(new B2D.Vec2(0,0)))},c.prototype.getRadius=function(){return this.radius},c.prototype.handleExitWorld=function(){return this.destroy()},c.prototype.getDensity=function(){return this.body.GetFixtureList().GetDensity()},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("planet",["entity","astroid","box2d"],function(a,c,d){var e;return e=function(a){function e(a){e.__super__.constructor.call(this,"planet"),this.radius=a.radius,this.shieldRadius=1.2*this.radius,this.shieldActive=!1}return b(e,a),e.prototype.getEntityDef=function(){var a,b;return a=new d.BodyDef,a.type=d.Body.b2_staticBody,a.position=new d.Vec2(0,0),b=new d.FixtureDef,b.density=1,b.friction=0,b.shape=new d.CircleShape(this.radius),{bodyDef:a,fixtureDef:b}},e.prototype.getRadius=function(){return this.radius},e.prototype.handleCollision=function(a,b){var d=this;return a instanceof c?_.defer(function(){return d.shieldActive?(d._luanchAstroidAway(a),d.dropShield()):d.events.trigger("worldDistruction",b)}):void 0},e.prototype.deployShield=function(){return this.shieldActive?void 0:(this.shieldActive=!0,this._changePlanetBodyRadius(this.shieldRadius),this.events.trigger("rasingShield"))},e.prototype.dropShield=function(){return this.shieldActive?(this.shieldActive=!1,this._changePlanetBodyRadius(this.radius),this.events.trigger("dropingShield")):void 0},e.prototype.hasShield=function(){return this.shieldActive},e.prototype.getShieldRadius=function(){return this.shieldRadius},e.prototype._luanchAstroidAway=function(a){var b,c,e;return c=300,b=a.getPosition(),e=b.Copy(),e.Add(this.getPosition()),e.Multiply(c),a.body.ApplyImpulse(e,new d.Vec2(0,0))},e.prototype._changePlanetBodyRadius=function(a){var b,c,d;return b=this.body.GetFixtureList(),this.body.DestroyFixture(b),d=this.getEntityDef().fixtureDef,d.shape.SetRadius(a),c=this.body.CreateFixture(d)},e}(a)})}.call(this),function(){define("vector_helpers",["box2d"],function(a){var b;return b=function(){function b(){}return b.rotate=function(b,c){var d,e;return e=a.Mat22.FromAngle(c),d=b.Copy(),d.MulM(e),d},b.createDirectionVector=function(c){var d;return d=new a.Vec2(1,0),b.rotate(d,c)},b}()})}.call(this),function(){define("math_helpers",[],function(){var a;return a=function(){function a(){}return a.d2r=function(a){return a*Math.PI/180},a.r2d=function(a){return 180*a/Math.PI},a.adjustAngle=function(a){return a>180?a-=360:-180>a&&(a+=360),a},a.average=function(a,b,c){return null==c&&(c=.5),a*c+b*(1-c)},a.random=function(a,b){return Math.random()*(b-a)+a},a}()})}.call(this),function(){define("cannon",["vector_helpers","box2d"],function(a,b){var c;return c=function(){function c(a){_.defaults(a,{bulletSpeed:30,cannonHeatRate:.01,cannonCooldownRate:.05}),this.cannonRate=200,this.cannonOffset=a.cannonOffset,this.cannonHeatRate=a.cannonHeatRate,this.cannonCooldownRate=a.cannonCooldownRate,this.cannonTemperature=0,this.bulletSpeed=a.bulletSpeed,this.bulletDensity=15,this.speed=new b.Vec2(0,0),this.position=new b.Vec2(0,0),this.angle=0,this.canJam=!0}return c.prototype.setPosition=function(a){return this.position=a},c.prototype.setAngle=function(a){return this.angle=a},c.prototype.setSpeed=function(a){return this.speed=a},c.prototype.fireCannon=function(){var a=this;return null==this.cannonIntervalHandler?(this.fireBullet(),this.cannonIntervalHandler=setInterval(function(){return a.fireBullet()},this.cannonRate)):void 0},c.prototype.turnCannonOff=function(){return clearInterval(this.cannonIntervalHandler),this.cannonIntervalHandler=null},c.prototype.fireBullet=function(){return!this.cannonJammed&&(this._createBullet(),this.canJam&&(this.cannonTemperature+=this.cannonHeatRate,this.cannonTemperature=Math.min(this.cannonTemperature,1),1===this.cannonTemperature))?this.cannonJammed=!0:void 0},c.prototype.update=function(a){return this.cannonTemperature>0&&(this.cannonTemperature-=this.cannonCooldownRate*a),this.cannonJammed&&this.cannonTemperature<=0?(this.cannonJammed=!1,this.cannonTemperature=0):void 0},c.prototype.isCannonOn=function(){return null!=this.cannonIntervalHandler},c.prototype.isCannonJammed=function(){return this.cannonJammed},c.prototype.getCannonTemperature=function(){return this.cannonTemperature},c.prototype.addBulletDensity=function(a){return this.bulletDensity+=a},c.prototype.destroy=function(){return this.turnCannonOff()},c.prototype._createBullet=function(){var b,c,d,e;return e=this.cannonOffset.Copy(),e=a.rotate(e,this.angle),e.Add(this.position),d=this.speed,c=this._getDirectionVector(),c.Multiply(this.bulletSpeed),c.Add(d),b=EntityFactory.createBullet({density:this.bulletDensity}),b.setAngle(this.angle),b.setPosition(e),b.setSpeed(c)},c.prototype._getDirectionVector=function(){var b,c;return b=this.angle,c=a.createDirectionVector(b)},c}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("spaceship",["box2d","entity","vector_helpers","math_helpers","cannon"],function(a,c,d,e,f){var g;return g=function(c){function g(b){g.__super__.constructor.call(this,"spaceship"),this.speed=b.speed,this.angularSpeed=b.angularSpeed,this.length=b.length,this.width=b.width,this.cannon=new f({bulletSpeed:30,cannonOffset:new a.Vec2(this.length),cannonRate:200,cannonHeatRate:b.cannonHeatRate,cannonCooldownRate:b.cannonCooldownRate}),this.angularDamping=b.angularDamping,this.linearDamping=b.linearDamping,this.thrusters={main:"off",left:"off",right:"off"},this.outOfWorld=!1}return b(g,c),g.prototype.getEntityDef=function(){var b,c;return b=new a.BodyDef,b.type=a.Body.b2_dynamicBody,b.angularDamping=this.angularDamping,b.linearDamping=this.linearDamping,c=new a.FixtureDef,c.mass=1,c.density=1,c.friction=0,c.shape=new a.PolygonShape,c.shape.SetAsArray([new a.Vec2(-this.length/2,-this.width/2),new a.Vec2(this.length/2,0),new a.Vec2(-this.length/2,this.width/2)],3),{bodyDef:b,fixtureDef:c}},g.prototype.fireMainThrusters=function(){return this.thrusters.main="on"},g.prototype.fireLeftThrusters=function(){return this.thrusters.left="on"},g.prototype.fireRightThrusters=function(){return this.thrusters.right="on"},g.prototype.turnMainThrustersOff=function(){return this.thrusters.main="off"},g.prototype.turnLeftThrustersOff=function(){return this.thrusters.left="off"},g.prototype.turnRightThrustersOff=function(){return this.thrusters.right="off"},g.prototype.setAutoPilotTarget=function(a){return this.autoPilotTarget=a},g.prototype.stopAutoPilot=function(){return this.turnLeftThrustersOff(),this.turnRightThrustersOff(),this.turnMainThrustersOff(),delete this.autoPilotTarget},g.prototype.fireCannon=function(){return this.cannon.fireCannon()},g.prototype.turnCannonOff=function(){return this.cannon.turnCannonOff()},g.prototype.update=function(a){return null!=this.autoPilotTarget&&this._autoPilot(),this._thrustersOn("main")&&this._mainThrustersAction(),this._thrustersOn("left")&&this._leftThrustersAction(),this._thrustersOn("right")&&this._rightThrustersACtion(),this.cannon.setPosition(this.getPosition()),this.cannon.setAngle(this.getAngle()),this.cannon.setSpeed(this.body.GetLinearVelocity()),this.cannon.update(a)},g.prototype.getVertices=function(){return this.body.GetFixtureList().GetShape().GetVertices()},g.prototype.isCannonOn=function(){return this.cannon.isCannonOn()},g.prototype.isCannonJammed=function(){return this.cannon.isCannonJammed()},g.prototype.getCannonTemperature=function(){return this.cannon.getCannonTemperature()},g.prototype.destroy=function(){return this.cannon.destroy()},g.prototype.handleExitWorld=function(){return this.outOfWorld=!0},g.prototype.handleEnterWorld=function(){return this.outOfWorld=!1},g.prototype.isOutOfWOrld=function(){return this.outOfWorld},g.prototype.getSpeed=function(){var a;return a=this.body.GetLinearVelocity(),a.Length()},g.prototype.setSuperCannon=function(){return this.cannon.canJam=!1},g.prototype.isSuperCannon=function(){return!this.cannon.canJam},g.prototype.addSpeed=function(a){return this.speed+=a},g.prototype.addBulletDensity=function(a){return this.cannon.addBulletDensity(a)},g.prototype._autoPilot=function(){var a;if(a=this._calculateAngleTwardsTarget(),Math.abs(a)<5)return this.isCannonOn()||this.fireMainThrusters(),this.turnLeftThrustersOff(),this.turnRightThrustersOff();if(0>a){if(this.fireRightThrusters(),this.turnLeftThrustersOff(),!this.isCannonOn())return this.fireMainThrusters()}else if(this.fireLeftThrusters(),this.turnRightThrustersOff(),!this.isCannonOn())return this.fireMainThrusters()},g.prototype._calculateAngleTwardsTarget=function(){var b,c,d,f;return f=this.body.GetPosition(),d=new a.Vec2(this.autoPilotTarget.x-f.x,this.autoPilotTarget.y-f.y),d.Normalize(),c=this._getDirectionVector(),b=Math.atan2(d.x,d.y)-Math.atan2(c.x,c.y),b=e.r2d(b),b=e.adjustAngle(b)},g.prototype._thrustersOn=function(a){return"on"===this.thrusters[a]},g.prototype._mainThrustersAction=function(){var b;return b=this._getDirectionVector(),b.Multiply(this.speed),this.body.ApplyForce(b,this.body.GetWorldPoint(new a.Vec2(0,0)))},g.prototype._leftThrustersAction=function(){return this.body.ApplyTorque(-this.angularSpeed)},g.prototype._rightThrustersACtion=function(){return this.body.ApplyTorque(this.angularSpeed)},g.prototype._getDirectionVector=function(){var a,b;return a=this.body.GetAngle(),b=d.createDirectionVector(a)},g}(c)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("bullet",["entity"],function(a){var c;return c=function(a){function c(a){c.__super__.constructor.call(this,"bullet"),this.radius=a.radius,this.density=a.density}return b(c,a),c.prototype.getEntityDef=function(){var a,b;return a=new B2D.BodyDef,a.type=B2D.Body.b2_dynamicBody,a.position=new B2D.Vec2(0,0),a.bullet=!0,b=new B2D.FixtureDef,b.density=this.density,b.friction=0,b.shape=new B2D.CircleShape(this.radius),{bodyDef:a,fixtureDef:b}},c.prototype.getRadius=function(){return this.radius},c.prototype.handleExitWorld=function(){return this.destroy()},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("powerup",["entity","spaceship","bullet","astroid","planet","vector_helpers"],function(a,c,d,e,f,g){var h;return h=function(a){function h(a){h.__super__.constructor.call(this,a),this.applied=!1,this.options={radius:1}}return b(h,a),h.prototype.handleCollision=function(a,b){return!this.applied&&a instanceof c?(this.apply(a,b),this.events.trigger("applied"),this.destroy()):void 0},h.prototype.shouldPassThrough=function(a){return a instanceof c||a instanceof d||a instanceof e||a instanceof f},h.prototype.handleExitWorld=function(){return this.destroy()},h.prototype.goToDirection=function(a){var b;return b=g.createDirectionVector(a),b.Multiply(70),this.body.ApplyImpulse(b,new B2D.Vec2(0,0))},h.prototype.getRadius=function(){return this.options.radius},h.prototype.getEntityDef=function(){var a,b;return a=new B2D.BodyDef,a.type=B2D.Body.b2_dynamicBody,a.position=new B2D.Vec2(0,0),b=new B2D.FixtureDef,b.density=10,b.friction=.5,a.linearDamping=.1,b.shape=new B2D.CircleShape(this.options.radius),{bodyDef:a,fixtureDef:b}},h}(a)})}.call(this),function(){define("world",["box2d","events","astroid","planet","spaceship","powerup"],function(a,b){var c,d;return d=function(){function c(a){this.worldBody=a,this.events=new b}return c.prototype.BeginContact=function(a){var b,c,d;return b=a.GetFixtureA().GetBody(),c=a.GetFixtureB().GetBody(),(d=this._findWorldBody(b,c))?this.events.trigger("entityEnter",d.GetUserData()):this._handleEntitiesCollision(b,c,a)},c.prototype.EndContact=function(a){var b,c,d;return b=a.GetFixtureA().GetBody(),c=a.GetFixtureB().GetBody(),(d=this._findWorldBody(b,c))?this.events.trigger("entityExit",d.GetUserData()):void 0},c.prototype.PreSolve=function(a){var b,c;return b=a.GetFixtureA().GetBody().GetUserData(),c=a.GetFixtureB().GetBody().GetUserData(),("function"==typeof b.shouldPassThrough?b.shouldPassThrough(c):void 0)||("function"==typeof c.shouldPassThrough?c.shouldPassThrough(b):void 0)?a.SetEnabled(!1):void 0},c.prototype.PostSolve=function(){},c.prototype._findWorldBody=function(a,b){var c;return c=null,(a===this.worldBody||b===this.worldBody)&&(c=a===this.worldBody?b:a),c},c.prototype._handleEntitiesCollision=function(b,c,d){var e,f,g,h,i;return f=b.GetUserData(),g=c.GetUserData(),i=new a.WorldManifold,h=d.GetWorldManifold(i),e=i.m_points[0],this.events.trigger("collision",f,g,e)},c}(),c=function(){function c(c){var e;this.world=new a.World(new a.Vec2(0,0),!0),this.size=c.size,this.entities=[],this.outWorldEntities={},this.inWorldEntities={},this.events=new b,this.worldBody=this._createWorldBody(),e=new d(this.worldBody),e.events.on("collision",function(a,b,c){return"function"==typeof a.handleCollision&&a.handleCollision(b,c),"function"==typeof b.handleCollision?b.handleCollision(a,c):void 0}),e.events.on("entityEnter",function(a){return a.handleEnterWorld()}),e.events.on("entityExit",function(a){return a.handleExitWorld()}),this.world.SetContactListener(e)}return c.prototype.registerEntity=function(a){var b,c,d;return d=a.getEntityDef().fixtureDef,c=a.getEntityDef().bodyDef,b=this.world.CreateBody(c),b.CreateFixture(d),b.SetUserData(a),a.setBody(b),this.entities.push(a)},c.prototype.getBodyCount=function(){return this.world.GetBodyCount()},c.prototype.getEntities=function(){return this.entities},c.prototype.startShockWave=function(b,c){var d,e,f,g,h,i,j,k;for(this.shockWavePosition=b,h=600,d=null!=c?_(this.entities).filter(function(a){return _(c).any(function(b){return a instanceof b})}):this.entities,k=[],i=0,j=d.length;j>i;i++)e=d[i],f=e.getPosition(),g=f.Copy(),g.Add(b.GetNegative()),g.Normalize(),g.Multiply(h),k.push(e.body.ApplyImpulse(g,new a.Vec2(0,0)));return k},c.prototype.update=function(a){var b=this;return _.each(this.entities,function(c){return c.exists()||(b.world.DestroyBody(c.body),b.entities=_(b.entities).without(c)),"function"==typeof c.update?c.update(a):void 0}),this.world.Step(a,10,10),this.world.ClearForces()},c.prototype.hitCheck=function(a,b){var c,d,e;for(c=this.world.GetBodyList();null!=c;){if((null!=(e=c.GetUserData())?e.type:void 0)===a)for(d=c.GetFixtureList();null!=d;){if(d.TestPoint(b))return!0;d=d.GetNext()}c=c.GetNext()}return!1},c.prototype.destroy=function(){var a,b;for(a=this.world.GetBodyList(),b=[];a;)this.world.DestroyBody(a),b.push(a=a.GetNext());return b},c.prototype.setupDebugRenderer=function(b){var c;return c=new a.DebugDraw,c.SetSprite(b.getContext("2d")),c.SetDrawScale(1),c.SetFillAlpha(.5),c.SetLineThickness(1),c.SetFlags(a.DebugDraw.e_shapeBit|a.DebugDraw.e_jointBit),this.world.SetDebugDraw(c)},c.prototype._createWorldBody=function(){var b,c,d;return b=new a.BodyDef,b.type=a.Body.b2_staticBody,b.position=new a.Vec2(0,0),c=new a.FixtureDef,c.mass=1,c.density=1,c.friction=0,c.shape=new a.PolygonShape,c.shape.SetAsBox(this.size.width/2,this.size.height/2),c.isSensor=!0,d=this.world.CreateBody(b),d.CreateFixture(c),d},c}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("speed_powerup",["powerup","box2d"],function(a){var c;return c=function(a){function c(){c.__super__.constructor.call(this,"speedPowerup"),this.amount=10}return b(c,a),c.prototype.apply=function(a){return a.addSpeed(this.amount)},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("bullet_mass_powerup",["powerup","box2d","spaceship"],function(a){var c;return c=function(a){function c(){c.__super__.constructor.call(this,"bulletMassPowerup"),this.amount=3}return b(c,a),c.prototype.apply=function(a){return a.addBulletDensity(this.amount)},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("shockwave_powerup",["powerup","box2d","spaceship","astroid","bullet"],function(a,c,d,e,f){var g;return g=function(a){function c(a){this.world=a,c.__super__.constructor.call(this,"shockwavePowerup")}return b(c,a),c.prototype.apply=function(){return this.world.startShockWave(this.getPosition(),[d,e,f])},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("shield_powerup",["powerup","box2d"],function(a){var c;return c=function(a){function c(a){this.planet=a,c.__super__.constructor.call(this,"shieldPowerup"),this.amount=10}return b(c,a),c.prototype.apply=function(){var a=this;return _.defer(function(){return a.planet.deployShield()})},c}(a)})}.call(this),function(){define("entity_factory",["world","spaceship","bullet","astroid","planet","speed_powerup","bullet_mass_powerup","shockwave_powerup","shield_powerup"],function(a,b,c,d,e,f,g,h,i){var j;return j=function(){function a(a,b){this.world=a,this.config=b}return a.prototype.createSpaceship=function(){return this._createEntity(b,this.config.Spaceship)},a.prototype.createBullet=function(a){return null==a&&(a={}),_.defaults(a,{radius:.3,density:7}),this._createEntity(c,a)},a.prototype.createAstroid=function(a){return null==a&&(a={}),a.planet=this.planet,this._createEntity(d,a)},a.prototype.createPlanet=function(){return this.planet=this._createEntity(e,{radius:10}),this.planet},a.prototype.createSpeedPowerup=function(){return this._createEntity(f)},a.prototype.createBulletMassPowerup=function(){return this._createEntity(g)},a.prototype.createShockwavePowerup=function(){return this._createEntity(h,this.world)},a.prototype.createShieldPowerup=function(){return this._createEntity(i,this.planet)},a.prototype._createEntity=function(a,b){var c,d;return null==b&&(b={}),d=new a(b),this.world.registerEntity(d),null!=b.position&&(c=new B2D.Vec2(b.position.x,b.position.y),d.setPosition(c)),d},a}()})}.call(this),function(){define("views_collection",["view"],function(){var a;return a=function(){function a(){this.views={}}return a.prototype.add=function(a,b,c){return null==c&&(c=0),this.views[a]={view:b,z:c}},a.prototype.remove=function(a){return null!=this.views[a]?(this.views[a].view.destroy(),delete this.views[a]):void 0},a.prototype.get=function(a){return this.views[a].view},a.prototype.exists=function(a){return null!=this.views[a]},a.prototype.render=function(){return _.chain(this.views).values().sortBy(function(a){return a.z}).each(function(a){return a.view.render()})},a.prototype.getViews=function(){return _.chain(this.views).values().sortBy(function(a){return a.z}).map(function(a){return a.view}).value()},a}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("world_view",["view","views_collection"],function(a,c){var d;return d=function(a){function d(a,b,e){this.world=e,d.__super__.constructor.call(this,a,b),this.viewsTypes={},this.views=new c}return b(d,a),d.prototype.createGraphics=function(){var a;return a=new PIXI.DisplayObjectContainer,a.width=this.container.width,a.height=this.container.height,a},d.prototype.updateGraphics=function(){return this.renderEntities(this.world.getEntities())},d.prototype.renderEntities=function(a){var b=this;return _.each(a,function(a){return a.exists()?b.getView(a).render(a):b.views.remove(a)}),this._sortViewsInContainer()},d.prototype.getView=function(a){var b;return this.views.exists(a)||(b=this.getViewType(a.type),this.views.add(a,new b(this.graphics,this.camera,a),this.getViewTypeZ(a.type))),this.views.get(a)},d.prototype.getViewType=function(a){return this.viewsTypes[a].type},d.prototype.getViewTypeZ=function(a){return this.viewsTypes[a].z},d.prototype.registerView=function(a,b,c){return null==c&&(c=0),this.viewsTypes[a]={type:b,z:c}},d.prototype._sortViewsInContainer=function(){var a,b=this;return a=this.views.getViews(),_(a).each(function(a){return b.graphics.removeChild(a.graphics)}),_(a).each(function(a){return b.graphics.addChild(a.graphics)})},d}(a)})}.call(this),function(){define("dom_events",[],function(){var a;return a=function(){function a(){}return a.bind=function(a,b,c){return a.attachEvent?(a["e"+b+c]=c,a[b+c]=function(){return a["e"+b+c](window.event)
},a.attachEvent("on"+b,a[b+c])):a.addEventListener(b,c,!1)},a.unbind=function(a,b,c){return a.detachEvent?(a.detachEvent("on"+b,a[b+c]),a[b+c]=null):a.removeEventListener(b,c,!1)},a}()})}.call(this),function(){define("player",["box2d","dom_events"],function(a,b){var c;return c=function(){function c(a,b){this.camera=a,this.world=b,this.mapping={65:this.setLeftThrusters,37:this.setLeftThrusters,87:this.setMainThrusters,38:this.setMainThrusters,68:this.setRightThrusters,39:this.setRightThrusters,32:this.fireCannon}}return c.prototype.control=function(a){var b=this;return this.spaceship=a,this.keyDownCallback=function(a){var c;return c=b.mapping[a.keyCode],null!=c?(c.apply(b,["on"]),a.preventDefault()):void 0},this.keyUpCallback=function(a){var c;return c=b.mapping[a.keyCode],null!=c?(c.apply(b,["off"]),a.preventDefault()):void 0},this.touchstartCallback=function(a){return b.handleTouch(a)},this.touchEndCallback=function(a){return b.handleTouchEnd(a)},this._addEvent(document,"keydown",this.keyDownCallback),this._addEvent(document,"keyup",this.keyUpCallback),this._addEvent(document,"touchstart",this.touchstartCallback),this._addEvent(document,"touchmove",this.touchstartCallback),this._addEvent(document,"touchend",this.touchEndCallback)},c.prototype.setLeftThrusters=function(a){return"on"===a?this.spaceship.fireLeftThrusters():this.spaceship.turnLeftThrustersOff()},c.prototype.setRightThrusters=function(a){return"on"===a?this.spaceship.fireRightThrusters():this.spaceship.turnRightThrustersOff()},c.prototype.setMainThrusters=function(a){return"on"===a?this.spaceship.fireMainThrusters():this.spaceship.turnMainThrustersOff()},c.prototype.fireCannon=function(a){return"on"===a?this.spaceship.fireCannon():this.spaceship.turnCannonOff()},c.prototype.handleTouch=function(b){var c,d,e;return c=b.touches[0],d=new a.Vec2(c.pageX,c.pageY),e=this.camera.backProject(d),this.world.hitCheck("astroid",e)?this.spaceship.fireCannon():this.spaceship.turnCannonOff(),this.spaceship.setAutoPilotTarget(e)},c.prototype.handleTouchEnd=function(){return this.spaceship.stopAutoPilot(),this.spaceship.turnCannonOff()},c.prototype.stopControling=function(){return this.spaceship.turnCannonOff(),this.spaceship.turnLeftThrustersOff(),this.spaceship.turnRightThrustersOff(),this.spaceship.turnMainThrustersOff(),this.spaceship.stopAutoPilot(),this._removeEvent(document,"keydown",this.keyDownCallback),this._removeEvent(document,"keyup",this.keyUpCallback),this._removeEvent(document,"touchstart",this.touchstartCallback),this._removeEvent(document,"touchmove",this.touchstartCallback),this._removeEvent(document,"touchend",this.touchEndCallback)},c.prototype.destroy=function(){return this.stopControling()},c.prototype._addEvent=function(a,c,d){return b.bind(a,c,d)},c.prototype._removeEvent=function(a,c,d){return b.unbind(a,c,d)},c}()})}.call(this),function(){var c=this,d=d||{};d.WEBGL_RENDERER=0,d.CANVAS_RENDERER=1,d.VERSION="v1.5.0",d.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},d.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},d.INTERACTION_FREQUENCY=30,d.AUTO_PREVENT_DEFAULT=!0,d.RAD_TO_DEG=180/Math.PI,d.DEG_TO_RAD=Math.PI/180,d.Point=function(a,b){this.x=a||0,this.y=b||0},d.Point.prototype.clone=function(){return new d.Point(this.x,this.y)},d.Point.prototype.constructor=d.Point,d.Point.prototype.set=function(a,b){this.x=a||0,this.y=b||(0!==b?this.x:0)},d.Rectangle=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},d.Rectangle.prototype.clone=function(){return new d.Rectangle(this.x,this.y,this.width,this.height)},d.Rectangle.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=this.x;if(a>=c&&a<=c+this.width){var d=this.y;if(b>=d&&b<=d+this.height)return!0}return!1},d.Rectangle.prototype.constructor=d.Rectangle,d.EmptyRectangle=new d.Rectangle(0,0,0,0),d.Polygon=function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var b=[],c=0,e=a.length;e>c;c+=2)b.push(new d.Point(a[c],a[c+1]));a=b}this.points=a},d.Polygon.prototype.clone=function(){for(var a=[],b=0;b<this.points.length;b++)a.push(this.points[b].clone());return new d.Polygon(a)},d.Polygon.prototype.contains=function(a,b){for(var c=!1,d=0,e=this.points.length-1;d<this.points.length;e=d++){var f=this.points[d].x,g=this.points[d].y,h=this.points[e].x,i=this.points[e].y,j=g>b!=i>b&&(h-f)*(b-g)/(i-g)+f>a;j&&(c=!c)}return c},d.Polygon.prototype.constructor=d.Polygon,d.Circle=function(a,b,c){this.x=a||0,this.y=b||0,this.radius=c||0},d.Circle.prototype.clone=function(){return new d.Circle(this.x,this.y,this.radius)},d.Circle.prototype.contains=function(a,b){if(this.radius<=0)return!1;var c=this.x-a,d=this.y-b,e=this.radius*this.radius;return c*=c,d*=d,e>=c+d},d.Circle.prototype.constructor=d.Circle,d.Ellipse=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},d.Ellipse.prototype.clone=function(){return new d.Ellipse(this.x,this.y,this.width,this.height)},d.Ellipse.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=(a-this.x)/this.width,d=(b-this.y)/this.height;return c*=c,d*=d,1>=c+d},d.Ellipse.prototype.getBounds=function(){return new d.Rectangle(this.x,this.y,this.width,this.height)},d.Ellipse.prototype.constructor=d.Ellipse,d.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array},d.Matrix2=d.determineMatrixArrayType(),d.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},d.Matrix.prototype.fromArray=function(a){this.a=a[0],this.b=a[1],this.c=a[3],this.d=a[4],this.tx=a[2],this.ty=a[5]},d.Matrix.prototype.toArray=function(a){this.array||(this.array=new Float32Array(9));var b=this.array;return a?(this.array[0]=this.a,this.array[1]=this.c,this.array[2]=0,this.array[3]=this.b,this.array[4]=this.d,this.array[5]=0,this.array[6]=this.tx,this.array[7]=this.ty,this.array[8]=1):(this.array[0]=this.a,this.array[1]=this.b,this.array[2]=this.tx,this.array[3]=this.c,this.array[4]=this.d,this.array[5]=this.ty,this.array[6]=0,this.array[7]=0,this.array[8]=1),b},d.identityMatrix=new d.Matrix,d.DisplayObject=function(){this.position=new d.Point,this.scale=new d.Point(1,1),this.pivot=new d.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new d.Matrix,this.color=[],this.dynamic=!0,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new d.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},d.DisplayObject.prototype.constructor=d.DisplayObject,d.DisplayObject.prototype.setInteractive=function(a){this.interactive=a},Object.defineProperty(d.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(d.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}}),Object.defineProperty(d.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1),this._mask=a,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(d.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].passes,e=0;e<d.length;e++)b.push(d[e]);this._filterBlock={target:this,filterPasses:b}}this._filters=a}}),Object.defineProperty(d.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}}),d.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var a=this.parent.worldTransform,b=this.worldTransform,c=this.pivot.x,d=this.pivot.y,e=this._cr*this.scale.x,f=-this._sr*this.scale.y,g=this._sr*this.scale.x,h=this._cr*this.scale.y,i=this.position.x-e*c-d*f,j=this.position.y-h*d-c*g,k=a.a,l=a.b,m=a.c,n=a.d;b.a=k*e+l*g,b.b=k*f+l*h,b.tx=k*i+l*j+a.tx,b.c=m*e+n*g,b.d=m*f+n*h,b.ty=m*i+n*j+a.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha},d.DisplayObject.prototype.getBounds=function(a){return a=a,d.EmptyRectangle},d.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(d.identityMatrix)},d.DisplayObject.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0)},d.DisplayObject.prototype.generateTexture=function(a){var b=this.getLocalBounds(),c=new d.RenderTexture(0|b.width,0|b.height,a);return c.render(this),c},d.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},d.DisplayObject.prototype._renderCachedSprite=function(a){a.gl?d.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):d.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)},d.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|a.width,0|a.height);else{var b=new d.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new d.Sprite(b),this._cachedSprite.worldTransform=this.worldTransform}var c=this._filters;this._filters=null,this._cachedSprite.filters=c,this._cachedSprite.texture.render(this),this._filters=c,this._cacheAsBitmap=!0},d.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},d.DisplayObject.prototype._renderWebGL=function(a){a=a},d.DisplayObject.prototype._renderCanvas=function(a){a=a},Object.defineProperty(d.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(d.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),d.DisplayObjectContainer=function(){d.DisplayObject.call(this),this.children=[]},d.DisplayObjectContainer.prototype=Object.create(d.DisplayObject.prototype),d.DisplayObjectContainer.prototype.constructor=d.DisplayObjectContainer,d.DisplayObjectContainer.prototype.addChild=function(a){this.addChildAt(a,this.children.length)},d.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(!(b>=0&&b<=this.children.length))throw new Error(a+" The index "+b+" supplied is out of bounds "+this.children.length);a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this.stage&&a.setStageReference(this.stage)},d.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a!==b){var c=this.children.indexOf(a),d=this.children.indexOf(b);if(0>c||0>d)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[c]=b,this.children[d]=a}},d.DisplayObjectContainer.prototype.getChildAt=function(a){if(a>=0&&a<this.children.length)return this.children[a];throw new Error("The supplied DisplayObjects must be a child of the caller "+this)},d.DisplayObjectContainer.prototype.removeChild=function(a){var b=this.children.indexOf(a);if(-1===b)throw new Error(a+" The supplied DisplayObject must be a child of the caller "+this);this.stage&&a.removeStageReference(),a.parent=void 0,this.children.splice(b,1)},d.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(d.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform()},d.DisplayObjectContainer.prototype.getBounds=function(a){if(0===this.children.length)return d.EmptyRectangle;if(a){var b=this.worldTransform;this.worldTransform=a,this.updateTransform(),this.worldTransform=b}for(var c,e,f,g=1/0,h=1/0,i=-1/0,j=-1/0,k=!1,l=0,m=this.children.length;m>l;l++){var n=this.children[l];n.visible&&(k=!0,c=this.children[l].getBounds(a),g=g<c.x?g:c.x,h=h<c.y?h:c.y,e=c.width+c.x,f=c.height+c.y,i=i>e?i:e,j=j>f?j:f)}if(!k)return d.EmptyRectangle;var o=this._bounds;return o.x=g,o.y=h,o.width=i-g,o.height=j-h,o},d.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=d.identityMatrix;for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateTransform();var e=this.getBounds();return this.worldTransform=a,e},d.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d.setStageReference(a)}},d.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0,b=this.children.length;b>a;a++){var c=this.children[a];c.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},d.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);var b,c;if(this._mask||this._filters){for(this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(a),a.spriteBatch.start()}else for(b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},d.DisplayObjectContainer.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);this._mask&&a.maskManager.pushMask(this._mask,a.context);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d._renderCanvas(a)}this._mask&&a.maskManager.popMask(a.context)}},d.Sprite=function(a){d.DisplayObjectContainer.call(this),this.anchor=new d.Point,this.texture=a,this._width=0,this._height=0,this.tint=16777215,this.blendMode=d.blendModes.NORMAL,a.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},d.Sprite.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Sprite.prototype.constructor=d.Sprite,Object.defineProperty(d.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(d.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}}),d.Sprite.prototype.setTexture=function(a){this.texture.baseTexture!==a.baseTexture?(this.textureChange=!0,this.texture=a):this.texture=a,this.cachedTint=16777215,this.updateFrame=!0},d.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},d.Sprite.prototype.getBounds=function(a){var b=this.texture.frame.width,c=this.texture.frame.height,d=b*(1-this.anchor.x),e=b*-this.anchor.x,f=c*(1-this.anchor.y),g=c*-this.anchor.y,h=a||this.worldTransform,i=h.a,j=h.c,k=h.b,l=h.d,m=h.tx,n=h.ty,o=i*e+k*g+m,p=l*g+j*e+n,q=i*d+k*g+m,r=l*g+j*d+n,s=i*d+k*f+m,t=l*f+j*d+n,u=i*e+k*f+m,v=l*f+j*e+n,w=-1/0,x=-1/0,y=1/0,z=1/0;y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,z=z>p?p:z,z=z>r?r:z,z=z>t?t:z,z=z>v?v:z,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w,x=p>x?p:x,x=r>x?r:x,x=t>x?t:x,x=v>x?v:x;var A=this._bounds;return A.x=y,A.width=w-y,A.y=z,A.height=x-z,this._currentBounds=A,A},d.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){var b,c;if(this._mask||this._filters){var d=a.spriteBatch;for(this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start()),this._filters&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),d.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);d.stop(),this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(a),d.start()}else for(a.spriteBatch.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},d.Sprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){var b=this.texture.frame,c=a.context,e=this.texture;if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=d.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a.context),b&&b.width&&b.height&&e.baseTexture.source){c.globalAlpha=this.worldAlpha;var f=this.worldTransform;if(a.roundPixels?c.setTransform(f.a,f.c,f.b,f.d,0|f.tx,0|f.ty):c.setTransform(f.a,f.c,f.b,f.d,f.tx,f.ty),a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,c[a.smoothProperty]=a.scaleMode===d.scaleModes.LINEAR),16777215!==this.tint){if(this.cachedTint!==this.tint){if(!e.baseTexture.hasLoaded)return;this.cachedTint=this.tint,this.tintedTexture=d.CanvasTinter.getTintedTexture(this,this.tint)}c.drawImage(this.tintedTexture,0,0,b.width,b.height,this.anchor.x*-b.width,this.anchor.y*-b.height,b.width,b.height)}else if(e.trim){var g=e.trim;c.drawImage(this.texture.baseTexture.source,b.x,b.y,b.width,b.height,g.x-this.anchor.x*g.width,g.y-this.anchor.y*g.height,b.width,b.height)}else c.drawImage(this.texture.baseTexture.source,b.x,b.y,b.width,b.height,this.anchor.x*-b.width,this.anchor.y*-b.height,b.width,b.height)}for(var h=0,i=this.children.length;i>h;h++){var j=this.children[h];j._renderCanvas(a)}this._mask&&a.maskManager.popMask(a.context)}},d.Sprite.fromFrame=function(a){var b=d.TextureCache[a];if(!b)throw new Error('The frameId "'+a+'" does not exist in the texture cache'+this);return new d.Sprite(b)},d.Sprite.fromImage=function(a,b,c){var e=d.Texture.fromImage(a,b,c);return new d.Sprite(e)},d.SpriteBatch=function(a){d.DisplayObjectContainer.call(this),this.textureThing=a,this.ready=!1},d.SpriteBatch.prototype=Object.create(d.DisplayObjectContainer.prototype),d.SpriteBatch.constructor=d.SpriteBatch,d.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new d.WebGLFastSpriteBatch(a),this.ready=!0},d.SpriteBatch.prototype.updateTransform=function(){d.DisplayObject.prototype.updateTransform.call(this)},d.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(a.gl),a.spriteBatch.stop(),a.shaderManager.activateShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.shaderManager.activateShader(a.shaderManager.defaultShader),a.spriteBatch.start())},d.SpriteBatch.prototype._renderCanvas=function(a){var b=a.context;b.globalAlpha=this.worldAlpha,d.DisplayObject.prototype.updateTransform.call(this);for(var c=this.worldTransform,e=!0,f=0;f<this.children.length;f++){var g=this.children[f];if(g.visible){var h=g.texture,i=h.frame;if(b.globalAlpha=this.worldAlpha*g.alpha,g.rotation%(2*Math.PI)===0)e&&(b.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty),e=!1),b.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*-i.width*g.scale.x+g.position.x+.5|0,g.anchor.y*-i.height*g.scale.y+g.position.y+.5|0,i.width*g.scale.x,i.height*g.scale.y);else{e||(e=!0),d.DisplayObject.prototype.updateTransform.call(g);var j=g.worldTransform;a.roundPixels?b.setTransform(j.a,j.c,j.b,j.d,0|j.tx,0|j.ty):b.setTransform(j.a,j.c,j.b,j.d,j.tx,j.ty),b.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*-i.width+.5|0,g.anchor.y*-i.height+.5|0,i.width,i.height)}}}},d.MovieClip=function(a){d.Sprite.call(this,a[0]),this.textures=a,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},d.MovieClip.prototype=Object.create(d.Sprite.prototype),d.MovieClip.prototype.constructor=d.MovieClip,Object.defineProperty(d.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),d.MovieClip.prototype.stop=function(){this.playing=!1},d.MovieClip.prototype.play=function(){this.playing=!0},d.MovieClip.prototype.gotoAndStop=function(a){this.playing=!1,this.currentFrame=a;var b=this.currentFrame+.5|0;this.setTexture(this.textures[b%this.textures.length])},d.MovieClip.prototype.gotoAndPlay=function(a){this.currentFrame=a,this.playing=!0},d.MovieClip.prototype.updateTransform=function(){if(d.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var a=this.currentFrame+.5|0;this.loop||a<this.textures.length?this.setTexture(this.textures[a%this.textures.length]):a>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},d.FilterBlock=function(){this.visible=!0,this.renderable=!0},d.Text=function(a,b){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),d.Sprite.call(this,d.Texture.fromCanvas(this.canvas)),this.setText(a),this.setStyle(b),this.updateText(),this.dirty=!1},d.Text.prototype=Object.create(d.Sprite.prototype),d.Text.prototype.constructor=d.Text,d.Text.prototype.setStyle=function(a){a=a||{},a.font=a.font||"bold 20pt Arial",a.fill=a.fill||"black",a.align=a.align||"left",a.stroke=a.stroke||"black",a.strokeThickness=a.strokeThickness||0,a.wordWrap=a.wordWrap||!1,a.wordWrapWidth=a.wordWrapWidth||100,this.style=a,this.dirty=!0},d.Text.prototype.setText=function(a){this.text=a.toString()||" ",this.dirty=!0},d.Text.prototype.updateText=function(){this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));for(var b=a.split(/(?:\r\n|\r|\n)/),c=[],e=0,f=0;f<b.length;f++){var g=this.context.measureText(b[f]).width;c[f]=g,e=Math.max(e,g)}this.canvas.width=e+this.style.strokeThickness;var h=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=h*b.length,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",f=0;f<b.length;f++){var i=new d.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+f*h);"right"===this.style.align?i.x+=e-c[f]:"center"===this.style.align&&(i.x+=(e-c[f])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(b[f],i.x,i.y),this.style.fill&&this.context.fillText(b[f],i.x,i.y)}this.updateTexture()},d.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.requiresUpdate=!0},d.Text.prototype._renderWebGL=function(a){this.requiresUpdate&&(this.requiresUpdate=!1,d.updateWebGLTexture(this.texture.baseTexture,a.gl)),d.Sprite.prototype._renderWebGL.call(this,a)},d.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),d.Sprite.prototype.updateTransform.call(this)},d.Text.prototype.determineFontHeight=function(a){var b=d.Text.heightCache[a];if(!b){var c=document.getElementsByTagName("body")[0],e=document.createElement("div"),f=document.createTextNode("M");e.appendChild(f),e.setAttribute("style",a+";position:absolute;top:0;left:0"),c.appendChild(e),b=e.offsetHeight,d.Text.heightCache[a]=b,c.removeChild(e)}return b},d.Text.prototype.wordWrap=function(a){for(var b="",c=a.split("\n"),d=0;d<c.length;d++){for(var e=this.style.wordWrapWidth,f=c[d].split(" "),g=0;g<f.length;g++){var h=this.context.measureText(f[g]).width,i=h+this.context.measureText(" ").width;i>e?(g>0&&(b+="\n"),b+=f[g]+" ",e=this.style.wordWrapWidth-h):(e-=i,b+=f[g]+" ")}d<c.length-1&&(b+="\n")}return b},d.Text.prototype.destroy=function(a){a&&this.texture.destroy()},d.Text.heightCache={},d.BitmapText=function(a,b){d.DisplayObjectContainer.call(this),this._pool=[],this.setText(a),this.setStyle(b),this.updateText(),this.dirty=!1},d.BitmapText.prototype=Object.create(d.DisplayObjectContainer.prototype),d.BitmapText.prototype.constructor=d.BitmapText,d.BitmapText.prototype.setText=function(a){this.text=a||" ",this.dirty=!0},d.BitmapText.prototype.setStyle=function(a){a=a||{},a.align=a.align||"left",this.style=a;var b=a.font.split(" ");this.fontName=b[b.length-1],this.fontSize=b.length>=2?parseInt(b[b.length-2],10):d.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=a.tint},d.BitmapText.prototype.updateText=function(){for(var a=d.BitmapText.fonts[this.fontName],b=new d.Point,c=null,e=[],f=0,g=[],h=0,i=this.fontSize/a.size,j=0;j<this.text.length;j++){var k=this.text.charCodeAt(j);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(j)))g.push(b.x),f=Math.max(f,b.x),h++,b.x=0,b.y+=a.lineHeight,c=null;else{var l=a.chars[k];l&&(c&&l[c]&&(b.x+=l.kerning[c]),e.push({texture:l.texture,line:h,charCode:k,position:new d.Point(b.x+l.xOffset,b.y+l.yOffset)}),b.x+=l.xAdvance,c=k)}}g.push(b.x),f=Math.max(f,b.x);var m=[];for(j=0;h>=j;j++){var n=0;"right"===this.style.align?n=f-g[j]:"center"===this.style.align&&(n=(f-g[j])/2),m.push(n)}var o=this.children.length,p=e.length,q=this.tint||16777215;for(j=0;p>j;j++){var r=o>j?this.children[j]:this._pool.pop();r?r.setTexture(e[j].texture):r=new d.Sprite(e[j].texture),r.position.x=(e[j].position.x+m[e[j].line])*i,r.position.y=e[j].position.y*i,r.scale.x=r.scale.y=i,r.tint=q,r.parent||this.addChild(r)}for(;this.children.length>p;){var s=this.getChildAt(this.children.length-1);this._pool.push(s),this.removeChild(s)}this.textWidth=f*i,this.textHeight=(b.y+a.lineHeight)*i},d.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),d.DisplayObjectContainer.prototype.updateTransform.call(this)},d.BitmapText.fonts={},d.InteractionData=function(){this.global=new d.Point,this.local=new d.Point,this.target=null,this.originalEvent=null},d.InteractionData.prototype.getLocalPosition=function(a){var b=a.worldTransform,c=this.global,e=b.a,f=b.b,g=b.tx,h=b.c,i=b.d,j=b.ty,k=1/(e*i+f*-h);return new d.Point(i*k*c.x+-f*k*c.y+(j*f-g*i)*k,e*k*c.y+-h*k*c.x+(-j*e+g*h)*k)},d.InteractionData.prototype.constructor=d.InteractionData,d.InteractionManager=function(a){this.stage=a,this.mouse=new d.InteractionData,this.touchs={},this.tempPoint=new d.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1},d.InteractionManager.prototype.constructor=d.InteractionManager,d.InteractionManager.prototype.collectInteractiveSprite=function(a,b){for(var c=a.children,d=c.length,e=d-1;e>=0;e--){var f=c[e];f._interactive?(b.interactiveChildren=!0,this.interactiveItems.push(f),f.children.length>0&&this.collectInteractiveSprite(f,f)):(f.__iParent=null,f.children.length>0&&this.collectInteractiveSprite(f,b))}},d.InteractionManager.prototype.setTarget=function(a){this.target=a,null===this.interactionDOMElement&&this.setTargetDomElement(a.view)},d.InteractionManager.prototype.setTargetDomElement=function(a){this.removeEvents(),window.navigator.msPointerEnabled&&(a.style["-ms-content-zooming"]="none",a.style["-ms-touch-action"]="none"),this.interactionDOMElement=a,a.addEventListener("mousemove",this.onMouseMove,!0),a.addEventListener("mousedown",this.onMouseDown,!0),a.addEventListener("mouseout",this.onMouseOut,!0),a.addEventListener("touchstart",this.onTouchStart,!0),a.addEventListener("touchend",this.onTouchEnd,!0),a.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},d.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},d.InteractionManager.prototype.update=function(){if(this.target){var a=Date.now(),b=a-this.last;if(b=b*d.INTERACTION_FREQUENCY/1e3,!(1>b)){this.last=a;var c=0;if(this.dirty){this.dirty=!1;var e=this.interactiveItems.length;for(c=0;e>c;c++)this.interactiveItems[c].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var f=this.interactiveItems.length,g="inherit",h=!1;for(c=0;f>c;c++){var i=this.interactiveItems[c];i.__hit=this.hitTest(i,this.mouse),this.mouse.target=i,i.__hit&&!h?(i.buttonMode&&(g=i.defaultCursor),i.interactiveChildren||(h=!0),i.__isOver||(i.mouseover&&i.mouseover(this.mouse),i.__isOver=!0)):i.__isOver&&(i.mouseout&&i.mouseout(this.mouse),i.__isOver=!1)}this.currentCursorStyle!==g&&(this.currentCursorStyle=g,this.interactionDOMElement.style.cursor=g)}}},d.InteractionManager.prototype.onMouseMove=function(a){this.mouse.originalEvent=a||window.event;var b=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(a.clientX-b.left)*(this.target.width/b.width),this.mouse.global.y=(a.clientY-b.top)*(this.target.height/b.height);for(var c=this.interactiveItems.length,d=0;c>d;d++){var e=this.interactiveItems[d];e.mousemove&&e.mousemove(this.mouse)}},d.InteractionManager.prototype.onMouseDown=function(a){this.mouse.originalEvent=a||window.event,d.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var b=this.interactiveItems.length,c=0;b>c;c++){var e=this.interactiveItems[c];if((e.mousedown||e.click)&&(e.__mouseIsDown=!0,e.__hit=this.hitTest(e,this.mouse),e.__hit&&(e.mousedown&&e.mousedown(this.mouse),e.__isDown=!0,!e.interactiveChildren)))break}},d.InteractionManager.prototype.onMouseOut=function(){var a=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var b=0;a>b;b++){var c=this.interactiveItems[b];c.__isOver&&(this.mouse.target=c,c.mouseout&&c.mouseout(this.mouse),c.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},d.InteractionManager.prototype.onMouseUp=function(a){this.mouse.originalEvent=a||window.event;for(var b=this.interactiveItems.length,c=!1,d=0;b>d;d++){var e=this.interactiveItems[d];e.__hit=this.hitTest(e,this.mouse),e.__hit&&!c?(e.mouseup&&e.mouseup(this.mouse),e.__isDown&&e.click&&e.click(this.mouse),e.interactiveChildren||(c=!0)):e.__isDown&&e.mouseupoutside&&e.mouseupoutside(this.mouse),e.__isDown=!1}},d.InteractionManager.prototype.hitTest=function(a,b){var c=b.global;if(!a.worldVisible)return!1;var e=a instanceof d.Sprite,f=a.worldTransform,g=f.a,h=f.b,i=f.tx,j=f.c,k=f.d,l=f.ty,m=1/(g*k+h*-j),n=k*m*c.x+-h*m*c.y+(l*h-i*k)*m,o=g*m*c.y+-j*m*c.x+(-l*g+i*j)*m;if(b.target=a,a.hitArea&&a.hitArea.contains)return a.hitArea.contains(n,o)?(b.target=a,!0):!1;if(e){var p,q=a.texture.frame.width,r=a.texture.frame.height,s=-q*a.anchor.x;if(n>s&&s+q>n&&(p=-r*a.anchor.y,o>p&&p+r>o))return b.target=a,!0}for(var t=a.children.length,u=0;t>u;u++){var v=a.children[u],w=this.hitTest(v,b);
if(w)return b.target=a,!0}return!1},d.InteractionManager.prototype.onTouchMove=function(a){var b,c=this.interactionDOMElement.getBoundingClientRect(),d=a.changedTouches,e=0;for(e=0;e<d.length;e++){var f=d[e];b=this.touchs[f.identifier],b.originalEvent=a||window.event,b.global.x=(f.clientX-c.left)*(this.target.width/c.width),b.global.y=(f.clientY-c.top)*(this.target.height/c.height),navigator.isCocoonJS&&(b.global.x=f.clientX,b.global.y=f.clientY)}var g=this.interactiveItems.length;for(e=0;g>e;e++){var h=this.interactiveItems[e];h.touchmove&&h.touchmove(b)}},d.InteractionManager.prototype.onTouchStart=function(a){var b=this.interactionDOMElement.getBoundingClientRect();d.AUTO_PREVENT_DEFAULT&&a.preventDefault();for(var c=a.changedTouches,e=0;e<c.length;e++){var f=c[e],g=this.pool.pop();g||(g=new d.InteractionData),g.originalEvent=a||window.event,this.touchs[f.identifier]=g,g.global.x=(f.clientX-b.left)*(this.target.width/b.width),g.global.y=(f.clientY-b.top)*(this.target.height/b.height),navigator.isCocoonJS&&(g.global.x=f.clientX,g.global.y=f.clientY);for(var h=this.interactiveItems.length,i=0;h>i;i++){var j=this.interactiveItems[i];if((j.touchstart||j.tap)&&(j.__hit=this.hitTest(j,g),j.__hit&&(j.touchstart&&j.touchstart(g),j.__isDown=!0,j.__touchData=g,!j.interactiveChildren)))break}}},d.InteractionManager.prototype.onTouchEnd=function(a){for(var b=this.interactionDOMElement.getBoundingClientRect(),c=a.changedTouches,d=0;d<c.length;d++){var e=c[d],f=this.touchs[e.identifier],g=!1;f.global.x=(e.clientX-b.left)*(this.target.width/b.width),f.global.y=(e.clientY-b.top)*(this.target.height/b.height),navigator.isCocoonJS&&(f.global.x=e.clientX,f.global.y=e.clientY);for(var h=this.interactiveItems.length,i=0;h>i;i++){var j=this.interactiveItems[i],k=j.__touchData;j.__hit=this.hitTest(j,f),k===f&&(f.originalEvent=a||window.event,(j.touchend||j.tap)&&(j.__hit&&!g?(j.touchend&&j.touchend(f),j.__isDown&&j.tap&&j.tap(f),j.interactiveChildren||(g=!0)):j.__isDown&&j.touchendoutside&&j.touchendoutside(f),j.__isDown=!1),j.__touchData=null)}this.pool.push(f),this.touchs[e.identifier]=null}},d.Stage=function(a){d.DisplayObjectContainer.call(this),this.worldTransform=new d.Matrix,this.interactive=!0,this.interactionManager=new d.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new d.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(a)},d.Stage.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Stage.prototype.constructor=d.Stage,d.Stage.prototype.setInteractionDelegate=function(a){this.interactionManager.setTargetDomElement(a)},d.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},d.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0,this.backgroundColorSplit=d.hex2rgb(this.backgroundColor);var b=this.backgroundColor.toString(16);b="000000".substr(0,6-b.length)+b,this.backgroundColorString="#"+b},d.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var e=0,f=["ms","moz","webkit","o"],h=0;h<f.length&&!window.requestAnimationFrame;++h)window.requestAnimationFrame=window[f[h]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[f[h]+"CancelAnimationFrame"]||window[f[h]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-e)),d=window.setTimeout(function(){a(b+c)},c);return e=b+c,d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)}),window.requestAnimFrame=window.requestAnimationFrame,d.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]},d.rgb2hex=function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(b){function c(){var f=e.concat(a.call(arguments));d.apply(this instanceof c?this:b,f)}var d=this,e=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return c.prototype=function f(a){return a&&(f.prototype=a),this instanceof f?void 0:new f}(d.prototype),c}}()),d.AjaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(c){}},d.canUseNewCanvasBlendModes=function(){var a=document.createElement("canvas");a.width=1,a.height=1;var b=a.getContext("2d");return b.fillStyle="#000",b.fillRect(0,0,1,1),b.globalCompositeOperation="multiply",b.fillStyle="#fff",b.fillRect(0,0,1,1),0===b.getImageData(0,0,1,1).data[0]},d.getNextPowerOfTwo=function(a){if(a>0&&0===(a&a-1))return a;for(var b=1;a>b;)b<<=1;return b},d.EventTarget=function(){var a={};this.addEventListener=this.on=function(b,c){void 0===a[b]&&(a[b]=[]),-1===a[b].indexOf(c)&&a[b].push(c)},this.dispatchEvent=this.emit=function(b){if(a[b.type]&&a[b.type].length)for(var c=0,d=a[b.type].length;d>c;c++)a[b.type][c](b)},this.removeEventListener=this.off=function(b,c){var d=a[b].indexOf(c);-1!==d&&a[b].splice(d,1)},this.removeAllEventListeners=function(b){var c=a[b];c&&(c.length=0)}},d.autoDetectRenderer=function(a,b,c,e,f){a||(a=800),b||(b=600);var g=function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}();return g?new d.WebGLRenderer(a,b,c,e,f):new d.CanvasRenderer(a,b,c,e)},d.PolyK={},d.PolyK.Triangulate=function(a){var b=!0,c=a.length>>1;if(3>c)return[];for(var e=[],f=[],g=0;c>g;g++)f.push(g);g=0;for(var h=c;h>3;){var i=f[(g+0)%h],j=f[(g+1)%h],k=f[(g+2)%h],l=a[2*i],m=a[2*i+1],n=a[2*j],o=a[2*j+1],p=a[2*k],q=a[2*k+1],r=!1;if(d.PolyK._convex(l,m,n,o,p,q,b)){r=!0;for(var s=0;h>s;s++){var t=f[s];if(t!==i&&t!==j&&t!==k&&d.PolyK._PointInTriangle(a[2*t],a[2*t+1],l,m,n,o,p,q)){r=!1;break}}}if(r)e.push(i,j,k),f.splice((g+1)%h,1),h--,g=0;else if(g++>3*h){if(!b)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(e=[],f=[],g=0;c>g;g++)f.push(g);g=0,h=c,b=!1}}return e.push(f[0],f[1],f[2]),e},d.PolyK._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},d.PolyK._convex=function(a,b,c,d,e,f,g){return(b-d)*(e-c)+(c-a)*(f-d)>=0===g},d.initDefaultShaders=function(){},d.CompileVertexShader=function(a,b){return d._CompileShader(a,b,a.VERTEX_SHADER)},d.CompileFragmentShader=function(a,b){return d._CompileShader(a,b,a.FRAGMENT_SHADER)},d._CompileShader=function(a,b,c){var d=b.join("\n"),e=a.createShader(c);return a.shaderSource(e,d),a.compileShader(e),a.getShaderParameter(e,a.COMPILE_STATUS)?e:(window.console.log(a.getShaderInfoLog(e)),null)},d.compileProgram=function(a,b,c){var e=d.CompileFragmentShader(a,c),f=d.CompileVertexShader(a,b),g=a.createProgram();return a.attachShader(g,f),a.attachShader(g,e),a.linkProgram(g),a.getProgramParameter(g,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),g},d.PixiShader=function(a){this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.attributes=[],this.init()},d.PixiShader.prototype.init=function(){var a=this.gl,b=d.compileProgram(a,this.vertexSrc||d.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.dimensions=a.getUniformLocation(b,"dimensions"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(b,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var c in this.uniforms)this.uniforms[c].uniformLocation=a.getUniformLocation(b,c);this.initUniforms(),this.program=b},d.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,b=this.gl;for(var c in this.uniforms){a=this.uniforms[c];var d=a.type;"sampler2D"===d?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===d||"mat3"===d||"mat4"===d?(a.glMatrix=!0,a.glValueLength=1,"mat2"===d?a.glFunc=b.uniformMatrix2fv:"mat3"===d?a.glFunc=b.uniformMatrix3fv:"mat4"===d&&(a.glFunc=b.uniformMatrix4fv)):(a.glFunc=b["uniform"+d],a.glValueLength="2f"===d||"2i"===d?2:"3f"===d||"3i"===d?3:"4f"===d||"4i"===d?4:1)}},d.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var b=this.gl;if(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]),a.textureData){var c=a.textureData,d=c.magFilter?c.magFilter:b.LINEAR,e=c.minFilter?c.minFilter:b.LINEAR,f=c.wrapS?c.wrapS:b.CLAMP_TO_EDGE,g=c.wrapT?c.wrapT:b.CLAMP_TO_EDGE,h=c.luminance?b.LUMINANCE:b.RGBA;if(c.repeat&&(f=b.REPEAT,g=b.REPEAT),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!!c.flipY),c.width){var i=c.width?c.width:512,j=c.height?c.height:2,k=c.border?c.border:0;b.texImage2D(b.TEXTURE_2D,0,h,i,j,k,h,b.UNSIGNED_BYTE,null)}else b.texImage2D(b.TEXTURE_2D,0,h,b.RGBA,b.UNSIGNED_BYTE,a.value.baseTexture.source);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,e),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,g)}b.uniform1i(a.uniformLocation,this.textureCount),a._init=!0,this.textureCount++}},d.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,b=this.gl;for(var c in this.uniforms)a=this.uniforms[c],1===a.glValueLength?a.glMatrix===!0?a.glFunc.call(b,a.uniformLocation,a.transpose,a.value):a.glFunc.call(b,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]||d.createWebGLTexture(a.value.baseTexture,b)),b.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))},d.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},d.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],d.PixiFastShader=function(a){this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},d.PixiFastShader.prototype.init=function(){var a=this.gl,b=d.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.dimensions=a.getUniformLocation(b,"dimensions"),this.uMatrix=a.getUniformLocation(b,"uMatrix"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aPositionCoord=a.getAttribLocation(b,"aPositionCoord"),this.aScale=a.getAttribLocation(b,"aScale"),this.aRotation=a.getAttribLocation(b,"aRotation"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(b,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=b},d.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},d.StripShader=function(){this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","   gl_FragColor = gl_FragColor * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","uniform vec2 offsetVector;","varying float vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"]},d.StripShader.prototype.init=function(){var a=d.gl,b=d.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.colorAttribute=a.getAttribLocation(b,"aColor"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.translationMatrix=a.getUniformLocation(b,"translationMatrix"),this.alpha=a.getUniformLocation(b,"alpha"),this.program=b},d.PrimitiveShader=function(a){this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},d.PrimitiveShader.prototype.init=function(){var a=this.gl,b=d.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.tintColor=a.getUniformLocation(b,"tint"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.colorAttribute=a.getAttribLocation(b,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(b,"translationMatrix"),this.alpha=a.getUniformLocation(b,"alpha"),this.program=b},d.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},d.WebGLGraphics=function(){},d.WebGLGraphics.renderGraphics=function(a,b){var c=b.gl,e=b.projection,f=b.offset,g=b.shaderManager.primitiveShader;a._webGL[c.id]||(a._webGL[c.id]={points:[],indices:[],lastIndex:0,buffer:c.createBuffer(),indexBuffer:c.createBuffer()});var h=a._webGL[c.id];a.dirty&&(a.dirty=!1,a.clearDirty&&(a.clearDirty=!1,h.lastIndex=0,h.points=[],h.indices=[]),d.WebGLGraphics.updateGraphics(a,c)),b.shaderManager.activatePrimitiveShader(),c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.uniformMatrix3fv(g.translationMatrix,!1,a.worldTransform.toArray(!0)),c.uniform2f(g.projectionVector,e.x,-e.y),c.uniform2f(g.offsetVector,-f.x,-f.y),c.uniform3fv(g.tintColor,d.hex2rgb(a.tint)),c.uniform1f(g.alpha,a.worldAlpha),c.bindBuffer(c.ARRAY_BUFFER,h.buffer),c.vertexAttribPointer(g.aVertexPosition,2,c.FLOAT,!1,24,0),c.vertexAttribPointer(g.colorAttribute,4,c.FLOAT,!1,24,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h.indexBuffer),c.drawElements(c.TRIANGLE_STRIP,h.indices.length,c.UNSIGNED_SHORT,0),b.shaderManager.deactivatePrimitiveShader()},d.WebGLGraphics.updateGraphics=function(a,b){for(var c=a._webGL[b.id],e=c.lastIndex;e<a.graphicsData.length;e++){var f=a.graphicsData[e];f.type===d.Graphics.POLY?(f.fill&&f.points.length>3&&d.WebGLGraphics.buildPoly(f,c),f.lineWidth>0&&d.WebGLGraphics.buildLine(f,c)):f.type===d.Graphics.RECT?d.WebGLGraphics.buildRectangle(f,c):(f.type===d.Graphics.CIRC||f.type===d.Graphics.ELIP)&&d.WebGLGraphics.buildCircle(f,c)}c.lastIndex=a.graphicsData.length,c.glPoints=new Float32Array(c.points),b.bindBuffer(b.ARRAY_BUFFER,c.buffer),b.bufferData(b.ARRAY_BUFFER,c.glPoints,b.STATIC_DRAW),c.glIndicies=new Uint16Array(c.indices),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,c.glIndicies,b.STATIC_DRAW)},d.WebGLGraphics.buildRectangle=function(a,b){var c=a.points,e=c[0],f=c[1],g=c[2],h=c[3];if(a.fill){var i=d.hex2rgb(a.fillColor),j=a.fillAlpha,k=i[0]*j,l=i[1]*j,m=i[2]*j,n=b.points,o=b.indices,p=n.length/6;n.push(e,f),n.push(k,l,m,j),n.push(e+g,f),n.push(k,l,m,j),n.push(e,f+h),n.push(k,l,m,j),n.push(e+g,f+h),n.push(k,l,m,j),o.push(p,p,p+1,p+2,p+3,p+3)}if(a.lineWidth){var q=a.points;a.points=[e,f,e+g,f,e+g,f+h,e,f+h,e,f],d.WebGLGraphics.buildLine(a,b),a.points=q}},d.WebGLGraphics.buildCircle=function(a,b){var c=a.points,e=c[0],f=c[1],g=c[2],h=c[3],i=40,j=2*Math.PI/i,k=0;if(a.fill){var l=d.hex2rgb(a.fillColor),m=a.fillAlpha,n=l[0]*m,o=l[1]*m,p=l[2]*m,q=b.points,r=b.indices,s=q.length/6;for(r.push(s),k=0;i+1>k;k++)q.push(e,f,n,o,p,m),q.push(e+Math.sin(j*k)*g,f+Math.cos(j*k)*h,n,o,p,m),r.push(s++,s++);r.push(s-1)}if(a.lineWidth){var t=a.points;for(a.points=[],k=0;i+1>k;k++)a.points.push(e+Math.sin(j*k)*g,f+Math.cos(j*k)*h);d.WebGLGraphics.buildLine(a,b),a.points=t}},d.WebGLGraphics.buildLine=function(a,b){var c=0,e=a.points;if(0!==e.length){if(a.lineWidth%2)for(c=0;c<e.length;c++)e[c]+=.5;var f=new d.Point(e[0],e[1]),g=new d.Point(e[e.length-2],e[e.length-1]);if(f.x===g.x&&f.y===g.y){e.pop(),e.pop(),g=new d.Point(e[e.length-2],e[e.length-1]);var h=g.x+.5*(f.x-g.x),i=g.y+.5*(f.y-g.y);e.unshift(h,i),e.push(h,i)}var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=b.points,H=b.indices,I=e.length/2,J=e.length,K=G.length/6,L=a.lineWidth/2,M=d.hex2rgb(a.lineColor),N=a.lineAlpha,O=M[0]*N,P=M[1]*N,Q=M[2]*N;for(l=e[0],m=e[1],n=e[2],o=e[3],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(l-r,m-s,O,P,Q,N),G.push(l+r,m+s,O,P,Q,N),c=1;I-1>c;c++)l=e[2*(c-1)],m=e[2*(c-1)+1],n=e[2*c],o=e[2*c+1],p=e[2*(c+1)],q=e[2*(c+1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,t=-(o-q),u=n-p,F=Math.sqrt(t*t+u*u),t/=F,u/=F,t*=L,u*=L,x=-s+m-(-s+o),y=-r+n-(-r+l),z=(-r+l)*(-s+o)-(-r+n)*(-s+m),A=-u+q-(-u+o),B=-t+n-(-t+p),C=(-t+p)*(-u+o)-(-t+n)*(-u+q),D=x*B-A*y,Math.abs(D)<.1?(D+=10.1,G.push(n-r,o-s,O,P,Q,N),G.push(n+r,o+s,O,P,Q,N)):(j=(y*C-B*z)/D,k=(A*z-x*C)/D,E=(j-n)*(j-n)+(k-o)+(k-o),E>19600?(v=r-t,w=s-u,F=Math.sqrt(v*v+w*w),v/=F,w/=F,v*=L,w*=L,G.push(n-v,o-w),G.push(O,P,Q,N),G.push(n+v,o+w),G.push(O,P,Q,N),G.push(n-v,o-w),G.push(O,P,Q,N),J++):(G.push(j,k),G.push(O,P,Q,N),G.push(n-(j-n),o-(k-o)),G.push(O,P,Q,N)));for(l=e[2*(I-2)],m=e[2*(I-2)+1],n=e[2*(I-1)],o=e[2*(I-1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(n-r,o-s),G.push(O,P,Q,N),G.push(n+r,o+s),G.push(O,P,Q,N),H.push(K),c=0;J>c;c++)H.push(K++);H.push(K-1)}},d.WebGLGraphics.buildPoly=function(a,b){var c=a.points;if(!(c.length<6)){var e=b.points,f=b.indices,g=c.length/2,h=d.hex2rgb(a.fillColor),i=a.fillAlpha,j=h[0]*i,k=h[1]*i,l=h[2]*i,m=d.PolyK.Triangulate(c),n=e.length/6,o=0;for(o=0;o<m.length;o+=3)f.push(m[o]+n),f.push(m[o]+n),f.push(m[o+1]+n),f.push(m[o+2]+n),f.push(m[o+2]+n);for(o=0;g>o;o++)e.push(c[2*o],c[2*o+1],j,k,l,i)}},d.glContexts=[],d.WebGLRenderer=function(a,b,c,e,f){d.defaultRenderer||(d.defaultRenderer=this),this.type=d.WEBGL_RENDERER,this.transparent=!!e,this.width=a||800,this.height=b||600,this.view=c||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.contextLost=this.handleContextLost.bind(this),this.contextRestoredLost=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLost,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1),this.options={alpha:this.transparent,antialias:!!f,premultipliedAlpha:!!e,stencil:!0};try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(g){try{this.gl=this.view.getContext("webgl",this.options)}catch(h){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var i=this.gl;this.glContextId=i.id=d.WebGLRenderer.glContextId++,d.glContexts[this.glContextId]=i,d.blendModesWebGL||(d.blendModesWebGL=[],d.blendModesWebGL[d.blendModes.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.ADD]=[i.SRC_ALPHA,i.DST_ALPHA],d.blendModesWebGL[d.blendModes.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.SCREEN]=[i.SRC_ALPHA,i.ONE],d.blendModesWebGL[d.blendModes.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],d.blendModesWebGL[d.blendModes.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA]),this.projection=new d.Point,this.projection.x=this.width/2,this.projection.y=-this.height/2,this.offset=new d.Point(0,0),this.resize(this.width,this.height),this.contextLost=!1,this.shaderManager=new d.WebGLShaderManager(i),this.spriteBatch=new d.WebGLSpriteBatch(i),this.maskManager=new d.WebGLMaskManager(i),this.filterManager=new d.WebGLFilterManager(i,this.transparent),this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.renderer=this,i.useProgram(this.shaderManager.defaultShader.program),i.disable(i.DEPTH_TEST),i.disable(i.CULL_FACE),i.enable(i.BLEND),i.colorMask(!0,!0,!0,this.transparent)},d.WebGLRenderer.prototype.constructor=d.WebGLRenderer,d.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(a.interactive&&a.interactionManager.removeEvents(),this.__stage=a),d.WebGLRenderer.updateTextures(),a.updateTransform(),a._interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)));var b=this.gl;b.viewport(0,0,this.width,this.height),b.bindFramebuffer(b.FRAMEBUFFER,null),this.transparent?b.clearColor(0,0,0,0):b.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),b.clear(b.COLOR_BUFFER_BIT),this.renderDisplayObject(a,this.projection),a.interactive?a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)):a._interactiveEventsAdded&&(a._interactiveEventsAdded=!1,a.interactionManager.setTarget(this))}},d.WebGLRenderer.prototype.renderDisplayObject=function(a,b,c){this.renderSession.drawCount=0,this.renderSession.currentBlendMode=9999,this.renderSession.projection=b,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,c),a._renderWebGL(this.renderSession),this.spriteBatch.end()},d.WebGLRenderer.updateTextures=function(){var a=0;for(a=0;a<d.Texture.frameUpdates.length;a++)d.WebGLRenderer.updateTextureFrame(d.Texture.frameUpdates[a]);for(a=0;a<d.texturesToDestroy.length;a++)d.WebGLRenderer.destroyTexture(d.texturesToDestroy[a]);d.texturesToUpdate.length=0,d.texturesToDestroy.length=0,d.Texture.frameUpdates.length=0},d.WebGLRenderer.destroyTexture=function(a){for(var b=a._glTextures.length-1;b>=0;b--){var c=a._glTextures[b],e=d.glContexts[b];e&&c&&e.deleteTexture(c)}a._glTextures.length=0},d.WebGLRenderer.updateTextureFrame=function(a){a.updateFrame=!1,a._updateWebGLuvs()},d.WebGLRenderer.prototype.resize=function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2,this.projection.y=-this.height/2},d.createWebGLTexture=function(a,b){return a.hasLoaded&&(a._glTextures[b.id]=b.createTexture(),b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===d.scaleModes.LINEAR?b.LINEAR:b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===d.scaleModes.LINEAR?b.LINEAR:b.NEAREST),a._powerOf2?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)),b.bindTexture(b.TEXTURE_2D,null)),a._glTextures[b.id]},d.updateWebGLTexture=function(a,b){a._glTextures[b.id]&&(b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===d.scaleModes.LINEAR?b.LINEAR:b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===d.scaleModes.LINEAR?b.LINEAR:b.NEAREST),a._powerOf2?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)),b.bindTexture(b.TEXTURE_2D,null))},d.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault(),this.contextLost=!0},d.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(a){try{this.gl=this.view.getContext("webgl",this.options)}catch(b){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var c=this.gl;c.id=d.WebGLRenderer.glContextId++,this.shaderManager.setContext(c),this.spriteBatch.setContext(c),this.maskManager.setContext(c),this.filterManager.setContext(c),this.renderSession.gl=this.gl,c.disable(c.DEPTH_TEST),c.disable(c.CULL_FACE),c.enable(c.BLEND),c.colorMask(!0,!0,!0,this.transparent),this.gl.viewport(0,0,this.width,this.height);for(var e in d.TextureCache){var f=d.TextureCache[e].baseTexture;f._glTextures=[]}this.contextLost=!1},d.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost),this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost),d.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},d.WebGLRenderer.glContextId=0,d.WebGLMaskManager=function(a){this.maskStack=[],this.maskPosition=0,this.setContext(a)},d.WebGLMaskManager.prototype.setContext=function(a){this.gl=a},d.WebGLMaskManager.prototype.pushMask=function(a,b){var c=this.gl;0===this.maskStack.length&&(c.enable(c.STENCIL_TEST),c.stencilFunc(c.ALWAYS,1,1)),this.maskStack.push(a),c.colorMask(!1,!1,!1,!0),c.stencilOp(c.KEEP,c.KEEP,c.INCR),d.WebGLGraphics.renderGraphics(a,b),c.colorMask(!0,!0,!0,!0),c.stencilFunc(c.NOTEQUAL,0,this.maskStack.length),c.stencilOp(c.KEEP,c.KEEP,c.KEEP)},d.WebGLMaskManager.prototype.popMask=function(a){var b=this.gl,c=this.maskStack.pop();c&&(b.colorMask(!1,!1,!1,!1),b.stencilOp(b.KEEP,b.KEEP,b.DECR),d.WebGLGraphics.renderGraphics(c,a),b.colorMask(!0,!0,!0,!0),b.stencilFunc(b.NOTEQUAL,0,this.maskStack.length),b.stencilOp(b.KEEP,b.KEEP,b.KEEP)),0===this.maskStack.length&&b.disable(b.STENCIL_TEST)},d.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},d.WebGLShaderManager=function(a){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var b=0;b<this.maxAttibs;b++)this.attribState[b]=!1;this.setContext(a)},d.WebGLShaderManager.prototype.setContext=function(a){this.gl=a,this.primitiveShader=new d.PrimitiveShader(a),this.defaultShader=new d.PixiShader(a),this.fastShader=new d.PixiFastShader(a),this.activateShader(this.defaultShader)},d.WebGLShaderManager.prototype.setAttribs=function(a){var b;for(b=0;b<this.tempAttribState.length;b++)this.tempAttribState[b]=!1;for(b=0;b<a.length;b++){var c=a[b];this.tempAttribState[c]=!0}var d=this.gl;for(b=0;b<this.attribState.length;b++)this.attribState[b]!==this.tempAttribState[b]&&(this.attribState[b]=this.tempAttribState[b],this.tempAttribState[b]?d.enableVertexAttribArray(b):d.disableVertexAttribArray(b))},d.WebGLShaderManager.prototype.activateShader=function(a){this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes)},d.WebGLShaderManager.prototype.activatePrimitiveShader=function(){var a=this.gl;a.useProgram(this.primitiveShader.program),this.setAttribs(this.primitiveShader.attributes)},d.WebGLShaderManager.prototype.deactivatePrimitiveShader=function(){var a=this.gl;a.useProgram(this.defaultShader.program),this.setAttribs(this.defaultShader.attributes)},d.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.gl=null},d.WebGLSpriteBatch=function(a){this.vertSize=6,this.size=2e3;var b=4*this.size*this.vertSize,c=6*this.size;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.lastIndexCount=0;for(var d=0,e=0;c>d;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;
this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.setContext(a)},d.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.currentBlendMode=99999},d.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},d.WebGLSpriteBatch.prototype.end=function(){this.flush()},d.WebGLSpriteBatch.prototype.render=function(a){var b=a.texture;(b.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size)&&(this.flush(),this.currentBaseTexture=b.baseTexture),a.blendMode!==this.currentBlendMode&&this.setBlendMode(a.blendMode);var c=a._uvs||a.texture._uvs;if(c){var d,e,f,g,h=a.worldAlpha,i=a.tint,j=this.vertices,k=a.anchor.x,l=a.anchor.y;if(a.texture.trim){var m=a.texture.trim;e=m.x-k*m.width,d=e+b.frame.width,g=m.y-l*m.height,f=g+b.frame.height}else d=b.frame.width*(1-k),e=b.frame.width*-k,f=b.frame.height*(1-l),g=b.frame.height*-l;var n=4*this.currentBatchSize*this.vertSize,o=a.worldTransform,p=o.a,q=o.c,r=o.b,s=o.d,t=o.tx,u=o.ty;j[n++]=p*e+r*g+t,j[n++]=s*g+q*e+u,j[n++]=c.x0,j[n++]=c.y0,j[n++]=h,j[n++]=i,j[n++]=p*d+r*g+t,j[n++]=s*g+q*d+u,j[n++]=c.x1,j[n++]=c.y1,j[n++]=h,j[n++]=i,j[n++]=p*d+r*f+t,j[n++]=s*f+q*d+u,j[n++]=c.x2,j[n++]=c.y2,j[n++]=h,j[n++]=i,j[n++]=p*e+r*f+t,j[n++]=s*f+q*e+u,j[n++]=c.x3,j[n++]=c.y3,j[n++]=h,j[n++]=i,this.currentBatchSize++}},d.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var b=a.tilingTexture;(b.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size)&&(this.flush(),this.currentBaseTexture=b.baseTexture),a.blendMode!==this.currentBlendMode&&this.setBlendMode(a.blendMode),a._uvs||(a._uvs=new d.TextureUvs);var c=a._uvs;a.tilePosition.x%=b.baseTexture.width*a.tileScaleOffset.x,a.tilePosition.y%=b.baseTexture.height*a.tileScaleOffset.y;var e=a.tilePosition.x/(b.baseTexture.width*a.tileScaleOffset.x),f=a.tilePosition.y/(b.baseTexture.height*a.tileScaleOffset.y),g=a.width/b.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),h=a.height/b.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);c.x0=0-e,c.y0=0-f,c.x1=1*g-e,c.y1=0-f,c.x2=1*g-e,c.y2=1*h-f,c.x3=0-e,c.y3=1*h-f;var i=a.worldAlpha,j=a.tint,k=this.vertices,l=a.width,m=a.height,n=a.anchor.x,o=a.anchor.y,p=l*(1-n),q=l*-n,r=m*(1-o),s=m*-o,t=4*this.currentBatchSize*this.vertSize,u=a.worldTransform,v=u.a,w=u.c,x=u.b,y=u.d,z=u.tx,A=u.ty;k[t++]=v*q+x*s+z,k[t++]=y*s+w*q+A,k[t++]=c.x0,k[t++]=c.y0,k[t++]=i,k[t++]=j,k[t++]=v*p+x*s+z,k[t++]=y*s+w*p+A,k[t++]=c.x1,k[t++]=c.y1,k[t++]=i,k[t++]=j,k[t++]=v*p+x*r+z,k[t++]=y*r+w*p+A,k[t++]=c.x2,k[t++]=c.y2,k[t++]=i,k[t++]=j,k[t++]=v*q+x*r+z,k[t++]=y*r+w*q+A,k[t++]=c.x3,k[t++]=c.y3,k[t++]=i,k[t++]=j,this.currentBatchSize++},d.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]||d.createWebGLTexture(this.currentBaseTexture,a)),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},d.WebGLSpriteBatch.prototype.stop=function(){this.flush()},d.WebGLSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y);var c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,8),a.vertexAttribPointer(this.shader.colorAttribute,2,a.FLOAT,!1,c,16),this.currentBlendMode!==d.blendModes.NORMAL&&this.setBlendMode(d.blendModes.NORMAL)},d.WebGLSpriteBatch.prototype.setBlendMode=function(a){this.flush(),this.currentBlendMode=a;var b=d.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(b[0],b[1])},d.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},d.WebGLFastSpriteBatch=function(a){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var b=4*this.size*this.vertSize,c=6*this.maxSize;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var d=0,e=0;c>d;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(a)},d.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.currentBlendMode=99999},d.WebGLFastSpriteBatch.prototype.begin=function(a,b){this.renderSession=b,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=a.worldTransform.toArray(!0),this.start()},d.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},d.WebGLFastSpriteBatch.prototype.render=function(a){var b=a.children,c=b[0];if(c.texture._uvs){this.currentBaseTexture=c.texture.baseTexture,c.blendMode!==this.currentBlendMode&&this.setBlendMode(c.blendMode);for(var d=0,e=b.length;e>d;d++)this.renderSprite(b[d]);this.flush()}},d.WebGLFastSpriteBatch.prototype.renderSprite=function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=a.texture.baseTexture,a.texture._uvs))){var b,c,d,e,f,g,h,i,j=this.vertices;if(b=a.texture._uvs,c=a.texture.frame.width,d=a.texture.frame.height,a.texture.trim){var k=a.texture.trim;f=k.x-a.anchor.x*k.width,e=f+a.texture.frame.width,h=k.y-a.anchor.y*k.height,g=h+a.texture.frame.height}else e=a.texture.frame.width*(1-a.anchor.x),f=a.texture.frame.width*-a.anchor.x,g=a.texture.frame.height*(1-a.anchor.y),h=a.texture.frame.height*-a.anchor.y;i=4*this.currentBatchSize*this.vertSize,j[i++]=f,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x0,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x1,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x2,j[i++]=b.y2,j[i++]=a.alpha,j[i++]=f,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x3,j[i++]=b.y3,j[i++]=a.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},d.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||d.createWebGLTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},d.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},d.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y),a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0),a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,c,8),a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,c,16),a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,c,24),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,28),a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,c,36),this.currentBlendMode!==d.blendModes.NORMAL&&this.setBlendMode(d.blendModes.NORMAL)},d.WebGLFastSpriteBatch.prototype.setBlendMode=function(a){this.flush(),this.currentBlendMode=a;var b=d.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(b[0],b[1])},d.WebGLFilterManager=function(a,b){this.transparent=b,this.filterStack=[],this.offsetX=0,this.offsetY=0,this.setContext(a)},d.WebGLFilterManager.prototype.setContext=function(a){this.gl=a,this.texturePool=[],this.initShaderBuffers()},d.WebGLFilterManager.prototype.begin=function(a,b){this.renderSession=a,this.defaultShader=a.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=2*c.x,this.height=2*-c.y,this.buffer=b},d.WebGLFilterManager.prototype.pushFilter=function(a){var b=this.gl,c=this.renderSession.projection,e=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds(),this.filterStack.push(a);var f=a.filterPasses[0];this.offsetX+=a._filterArea.x,this.offsetY+=a._filterArea.y;var g=this.texturePool.pop();g?g.resize(this.width,this.height):g=new d.FilterTexture(this.gl,this.width,this.height),b.bindTexture(b.TEXTURE_2D,g.texture);var h=a._filterArea,i=f.padding;h.x-=i,h.y-=i,h.width+=2*i,h.height+=2*i,h.x<0&&(h.x=0),h.width>this.width&&(h.width=this.width),h.y<0&&(h.y=0),h.height>this.height&&(h.height=this.height),b.bindFramebuffer(b.FRAMEBUFFER,g.frameBuffer),b.viewport(0,0,h.width,h.height),c.x=h.width/2,c.y=-h.height/2,e.x=-h.x,e.y=-h.y,b.uniform2f(this.defaultShader.projectionVector,h.width/2,-h.height/2),b.uniform2f(this.defaultShader.offsetVector,-h.x,-h.y),b.colorMask(!0,!0,!0,!0),b.clearColor(0,0,0,0),b.clear(b.COLOR_BUFFER_BIT),a._glFilterTexture=g},d.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,b=this.filterStack.pop(),c=b._filterArea,e=b._glFilterTexture,f=this.renderSession.projection,g=this.renderSession.offset;if(b.filterPasses.length>1){a.viewport(0,0,c.width,c.height),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=c.height,this.vertexArray[2]=c.width,this.vertexArray[3]=c.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=c.width,this.vertexArray[7]=0,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=c.width/this.width,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var h=e,i=this.texturePool.pop();i||(i=new d.FilterTexture(this.gl,this.width,this.height)),i.resize(this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.BLEND);for(var j=0;j<b.filterPasses.length-1;j++){var k=b.filterPasses[j];a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,h.texture),this.applyFilterPass(k,c,c.width,c.height);var l=h;h=i,i=l}a.enable(a.BLEND),e=h,this.texturePool.push(i)}var m=b.filterPasses[b.filterPasses.length-1];this.offsetX-=c.x,this.offsetY-=c.y;var n=this.width,o=this.height,p=0,q=0,r=this.buffer;if(0===this.filterStack.length)a.colorMask(!0,!0,!0,!0);else{var s=this.filterStack[this.filterStack.length-1];c=s._filterArea,n=c.width,o=c.height,p=c.x,q=c.y,r=s._glFilterTexture.frameBuffer}f.x=n/2,f.y=-o/2,g.x=p,g.y=q,c=b._filterArea;var t=c.x-p,u=c.y-q;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=t,this.vertexArray[1]=u+c.height,this.vertexArray[2]=t+c.width,this.vertexArray[3]=u+c.height,this.vertexArray[4]=t,this.vertexArray[5]=u,this.vertexArray[6]=t+c.width,this.vertexArray[7]=u,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=c.width/this.width,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray),a.viewport(0,0,n,o),a.bindFramebuffer(a.FRAMEBUFFER,r),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,e.texture),this.applyFilterPass(m,c,n,o),a.useProgram(this.defaultShader.program),a.uniform2f(this.defaultShader.projectionVector,n/2,-o/2),a.uniform2f(this.defaultShader.offsetVector,-p,-q),this.texturePool.push(e),b._glFilterTexture=null},d.WebGLFilterManager.prototype.applyFilterPass=function(a,b,c,e){var f=this.gl,g=a.shaders[f.id];g||(g=new d.PixiShader(f),g.fragmentSrc=a.fragmentSrc,g.uniforms=a.uniforms,g.init(),a.shaders[f.id]=g),f.useProgram(g.program),f.uniform2f(g.projectionVector,c/2,-e/2),f.uniform2f(g.offsetVector,0,0),a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]),g.syncUniforms(),f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer),f.vertexAttribPointer(g.aVertexPosition,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer),f.vertexAttribPointer(g.aTextureCoord,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer),f.vertexAttribPointer(g.colorAttribute,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),this.renderSession.drawCount++},d.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer(),this.uvBuffer=a.createBuffer(),this.colorBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)},d.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var b=0;b<this.texturePool.length;b++)this.texturePool.destroy();this.texturePool=null,a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.uvBuffer),a.deleteBuffer(this.colorBuffer),a.deleteBuffer(this.indexBuffer)},d.FilterTexture=function(a,b,c){this.gl=a,this.frameBuffer=a.createFramebuffer(),this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0),this.resize(b,c)},d.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)},d.FilterTexture.prototype.resize=function(a,b){if(this.width!==a||this.height!==b){this.width=a,this.height=b;var c=this.gl;c.bindTexture(c.TEXTURE_2D,this.texture),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null)}},d.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer),a.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},d.CanvasMaskManager=function(){},d.CanvasMaskManager.prototype.pushMask=function(a,b){b.save();var c=a.alpha,e=a.worldTransform;b.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty),d.CanvasGraphics.renderGraphicsMask(a,b),b.clip(),a.worldAlpha=c},d.CanvasMaskManager.prototype.popMask=function(a){a.restore()},d.CanvasTinter=function(){},d.CanvasTinter.getTintedTexture=function(a,b){var c=a.texture;b=d.CanvasTinter.roundColor(b);var e="#"+("00000"+(0|b).toString(16)).substr(-6);if(c.tintCache=c.tintCache||{},c.tintCache[e])return c.tintCache[e];var f=d.CanvasTinter.canvas||document.createElement("canvas");if(d.CanvasTinter.tintMethod(c,b,f),d.CanvasTinter.convertTintToImage){var g=new Image;g.src=f.toDataURL(),c.tintCache[e]=g}else c.tintCache[e]=f,d.CanvasTinter.canvas=null;return f},d.CanvasTinter.tintWithMultiply=function(a,b,c){var d=c.getContext("2d"),e=a.frame;c.width=e.width,c.height=e.height,d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="multiply",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},d.CanvasTinter.tintWithOverlay=function(a,b,c){var d=c.getContext("2d"),e=a.frame;c.width=e.width,c.height=e.height,d.globalCompositeOperation="copy",d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},d.CanvasTinter.tintWithPerPixel=function(a,b,c){var e=c.getContext("2d"),f=a.frame;c.width=f.width,c.height=f.height,e.globalCompositeOperation="copy",e.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);for(var g=d.hex2rgb(b),h=g[0],i=g[1],j=g[2],k=e.getImageData(0,0,f.width,f.height),l=k.data,m=0;m<l.length;m+=4)l[m+0]*=h,l[m+1]*=i,l[m+2]*=j;e.putImageData(k,0,0)},d.CanvasTinter.roundColor=function(a){var b=d.CanvasTinter.cacheStepsPerColorChannel,c=d.hex2rgb(a);return c[0]=Math.min(255,c[0]/b*b),c[1]=Math.min(255,c[1]/b*b),c[2]=Math.min(255,c[2]/b*b),d.rgb2hex(c)},d.CanvasTinter.cacheStepsPerColorChannel=8,d.CanvasTinter.convertTintToImage=!1,d.CanvasTinter.canUseMultiply=d.canUseNewCanvasBlendModes(),d.CanvasTinter.tintMethod=d.CanvasTinter.canUseMultiply?d.CanvasTinter.tintWithMultiply:d.CanvasTinter.tintWithPerPixel,d.CanvasRenderer=function(a,b,c,e){d.defaultRenderer=d.defaultRenderer||this,this.type=d.CANVAS_RENDERER,this.clearBeforeRender=!0,this.roundPixels=!1,this.transparent=!!e,d.blendModesCanvas||(d.blendModesCanvas=[],d.canUseNewCanvasBlendModes()?(d.blendModesCanvas[d.blendModes.NORMAL]="source-over",d.blendModesCanvas[d.blendModes.ADD]="lighter",d.blendModesCanvas[d.blendModes.MULTIPLY]="multiply",d.blendModesCanvas[d.blendModes.SCREEN]="screen",d.blendModesCanvas[d.blendModes.OVERLAY]="overlay",d.blendModesCanvas[d.blendModes.DARKEN]="darken",d.blendModesCanvas[d.blendModes.LIGHTEN]="lighten",d.blendModesCanvas[d.blendModes.COLOR_DODGE]="color-dodge",d.blendModesCanvas[d.blendModes.COLOR_BURN]="color-burn",d.blendModesCanvas[d.blendModes.HARD_LIGHT]="hard-light",d.blendModesCanvas[d.blendModes.SOFT_LIGHT]="soft-light",d.blendModesCanvas[d.blendModes.DIFFERENCE]="difference",d.blendModesCanvas[d.blendModes.EXCLUSION]="exclusion",d.blendModesCanvas[d.blendModes.HUE]="hue",d.blendModesCanvas[d.blendModes.SATURATION]="saturation",d.blendModesCanvas[d.blendModes.COLOR]="color",d.blendModesCanvas[d.blendModes.LUMINOSITY]="luminosity"):(d.blendModesCanvas[d.blendModes.NORMAL]="source-over",d.blendModesCanvas[d.blendModes.ADD]="lighter",d.blendModesCanvas[d.blendModes.MULTIPLY]="source-over",d.blendModesCanvas[d.blendModes.SCREEN]="source-over",d.blendModesCanvas[d.blendModes.OVERLAY]="source-over",d.blendModesCanvas[d.blendModes.DARKEN]="source-over",d.blendModesCanvas[d.blendModes.LIGHTEN]="source-over",d.blendModesCanvas[d.blendModes.COLOR_DODGE]="source-over",d.blendModesCanvas[d.blendModes.COLOR_BURN]="source-over",d.blendModesCanvas[d.blendModes.HARD_LIGHT]="source-over",d.blendModesCanvas[d.blendModes.SOFT_LIGHT]="source-over",d.blendModesCanvas[d.blendModes.DIFFERENCE]="source-over",d.blendModesCanvas[d.blendModes.EXCLUSION]="source-over",d.blendModesCanvas[d.blendModes.HUE]="source-over",d.blendModesCanvas[d.blendModes.SATURATION]="source-over",d.blendModesCanvas[d.blendModes.COLOR]="source-over",d.blendModesCanvas[d.blendModes.LUMINOSITY]="source-over")),this.width=a||800,this.height=b||600,this.view=c||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0,this.maskManager=new d.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null},"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")},d.CanvasRenderer.prototype.constructor=d.CanvasRenderer,d.CanvasRenderer.prototype.render=function(a){d.texturesToUpdate.length=0,d.texturesToDestroy.length=0,a.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(a),a.interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this))),d.Texture.frameUpdates.length>0&&(d.Texture.frameUpdates.length=0)},d.CanvasRenderer.prototype.resize=function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b},d.CanvasRenderer.prototype.renderDisplayObject=function(a,b){this.renderSession.context=b||this.context,a._renderCanvas(this.renderSession)},d.CanvasRenderer.prototype.renderStripFlat=function(a){var b=this.context,c=a.verticies,d=c.length/2;this.count++,b.beginPath();for(var e=1;d-2>e;e++){var f=2*e,g=c[f],h=c[f+2],i=c[f+4],j=c[f+1],k=c[f+3],l=c[f+5];b.moveTo(g,j),b.lineTo(h,k),b.lineTo(i,l)}b.fillStyle="#FF0000",b.fill(),b.closePath()},d.CanvasRenderer.prototype.renderStrip=function(a){var b=this.context,c=a.verticies,d=a.uvs,e=c.length/2;this.count++;for(var f=1;e-2>f;f++){var g=2*f,h=c[g],i=c[g+2],j=c[g+4],k=c[g+1],l=c[g+3],m=c[g+5],n=d[g]*a.texture.width,o=d[g+2]*a.texture.width,p=d[g+4]*a.texture.width,q=d[g+1]*a.texture.height,r=d[g+3]*a.texture.height,s=d[g+5]*a.texture.height;b.save(),b.beginPath(),b.moveTo(h,k),b.lineTo(i,l),b.lineTo(j,m),b.closePath(),b.clip();var t=n*r+q*p+o*s-r*p-q*o-n*s,u=h*r+q*j+i*s-r*j-q*i-h*s,v=n*i+h*p+o*j-i*p-h*o-n*j,w=n*r*j+q*i*p+h*o*s-h*r*p-q*o*j-n*i*s,x=k*r+q*m+l*s-r*m-q*l-k*s,y=n*l+k*p+o*m-l*p-k*o-n*m,z=n*r*m+q*l*p+k*o*s-k*r*p-q*o*m-n*l*s;b.transform(u/t,x/t,v/t,y/t,w/t,z/t),b.drawImage(a.texture.baseTexture.source,0,0),b.restore()}},d.CanvasBuffer=function(a,b){this.width=a,this.height=b,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b},d.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},d.CanvasBuffer.prototype.resize=function(a,b){this.width=this.canvas.width=a,this.height=this.canvas.height=b},d.CanvasGraphics=function(){},d.CanvasGraphics.renderGraphics=function(a,b){for(var c=a.worldAlpha,e="",f=0;f<a.graphicsData.length;f++){var g=a.graphicsData[f],h=g.points;if(b.strokeStyle=e="#"+("00000"+(0|g.lineColor).toString(16)).substr(-6),b.lineWidth=g.lineWidth,g.type===d.Graphics.POLY){b.beginPath(),b.moveTo(h[0],h[1]);for(var i=1;i<h.length/2;i++)b.lineTo(h[2*i],h[2*i+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&b.closePath(),g.fill&&(b.globalAlpha=g.fillAlpha*c,b.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),b.fill()),g.lineWidth&&(b.globalAlpha=g.lineAlpha*c,b.stroke())}else if(g.type===d.Graphics.RECT)(g.fillColor||0===g.fillColor)&&(b.globalAlpha=g.fillAlpha*c,b.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),b.fillRect(h[0],h[1],h[2],h[3])),g.lineWidth&&(b.globalAlpha=g.lineAlpha*c,b.strokeRect(h[0],h[1],h[2],h[3]));else if(g.type===d.Graphics.CIRC)b.beginPath(),b.arc(h[0],h[1],h[2],0,2*Math.PI),b.closePath(),g.fill&&(b.globalAlpha=g.fillAlpha*c,b.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),b.fill()),g.lineWidth&&(b.globalAlpha=g.lineAlpha*c,b.stroke());else if(g.type===d.Graphics.ELIP){var j=g.points,k=2*j[2],l=2*j[3],m=j[0]-k/2,n=j[1]-l/2;b.beginPath();var o=.5522848,p=k/2*o,q=l/2*o,r=m+k,s=n+l,t=m+k/2,u=n+l/2;b.moveTo(m,u),b.bezierCurveTo(m,u-q,t-p,n,t,n),b.bezierCurveTo(t+p,n,r,u-q,r,u),b.bezierCurveTo(r,u+q,t+p,s,t,s),b.bezierCurveTo(t-p,s,m,u+q,m,u),b.closePath(),g.fill&&(b.globalAlpha=g.fillAlpha*c,b.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),b.fill()),g.lineWidth&&(b.globalAlpha=g.lineAlpha*c,b.stroke())}}},d.CanvasGraphics.renderGraphicsMask=function(a,b){var c=a.graphicsData.length;if(0!==c){c>1&&(c=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var e=0;1>e;e++){var f=a.graphicsData[e],g=f.points;if(f.type===d.Graphics.POLY){b.beginPath(),b.moveTo(g[0],g[1]);for(var h=1;h<g.length/2;h++)b.lineTo(g[2*h],g[2*h+1]);g[0]===g[g.length-2]&&g[1]===g[g.length-1]&&b.closePath()}else if(f.type===d.Graphics.RECT)b.beginPath(),b.rect(g[0],g[1],g[2],g[3]),b.closePath();else if(f.type===d.Graphics.CIRC)b.beginPath(),b.arc(g[0],g[1],g[2],0,2*Math.PI),b.closePath();else if(f.type===d.Graphics.ELIP){var i=f.points,j=2*i[2],k=2*i[3],l=i[0]-j/2,m=i[1]-k/2;b.beginPath();var n=.5522848,o=j/2*n,p=k/2*n,q=l+j,r=m+k,s=l+j/2,t=m+k/2;b.moveTo(l,t),b.bezierCurveTo(l,t-p,s-o,m,s,m),b.bezierCurveTo(s+o,m,q,t-p,q,t),b.bezierCurveTo(q,t+p,s+o,r,s,r),b.bezierCurveTo(s-o,r,l,t+p,l,t),b.closePath()}}}},d.Graphics=function(){d.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.tint=16777215,this.blendMode=d.blendModes.NORMAL,this.currentPath={points:[]},this._webGL=[],this.isMask=!1,this.bounds=null,this.boundsPadding=10},d.Graphics.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Graphics.prototype.constructor=d.Graphics,Object.defineProperty(d.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap=a,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),d.Graphics.prototype.lineStyle=function(a,b,c){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=a||0,this.lineColor=b||0,this.lineAlpha=arguments.length<3?1:c,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:d.Graphics.POLY},this.graphicsData.push(this.currentPath),this},d.Graphics.prototype.moveTo=function(a,b){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:d.Graphics.POLY},this.currentPath.points.push(a,b),this.graphicsData.push(this.currentPath),this},d.Graphics.prototype.lineTo=function(a,b){return this.currentPath.points.push(a,b),this.dirty=!0,this},d.Graphics.prototype.beginFill=function(a,b){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=arguments.length<2?1:b,this},d.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},d.Graphics.prototype.drawRect=function(a,b,c,e){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,b,c,e],type:d.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this},d.Graphics.prototype.drawCircle=function(a,b,c){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,b,c,c],type:d.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},d.Graphics.prototype.drawEllipse=function(a,b,c,e){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,b,c,e],type:d.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0,this},d.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this},d.Graphics.prototype.generateTexture=function(){var a=this.getBounds(),b=new d.CanvasBuffer(a.width,a.height),c=d.Texture.fromCanvas(b.canvas);return b.context.translate(-a.x,-a.y),d.CanvasGraphics.renderGraphics(this,b.context),c},d.Graphics.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return this.dirty&&(this._generateCachedSprite(),d.updateWebGLTexture(this._cachedSprite.texture.baseTexture,a.gl),this.dirty=!1),void d.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);if(a.spriteBatch.stop(),this._mask&&a.maskManager.pushMask(this.mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var b=d.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(b[0],b[1])}if(d.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var c=0,e=this.children.length;e>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(a),a.drawCount++,a.spriteBatch.start()}},d.Graphics.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){var b=a.context,c=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,b.globalCompositeOperation=d.blendModesCanvas[a.currentBlendMode]),b.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty),d.CanvasGraphics.renderGraphics(this,b);for(var e=0,f=this.children.length;f>e;e++)this.children[e]._renderCanvas(a)}},d.Graphics.prototype.getBounds=function(a){this.bounds||this.updateBounds();var b=this.bounds.x,c=this.bounds.width+this.bounds.x,d=this.bounds.y,e=this.bounds.height+this.bounds.y,f=a||this.worldTransform,g=f.a,h=f.c,i=f.b,j=f.d,k=f.tx,l=f.ty,m=g*c+i*e+k,n=j*e+h*c+l,o=g*b+i*e+k,p=j*e+h*b+l,q=g*b+i*d+k,r=j*d+h*b+l,s=g*c+i*d+k,t=j*d+h*c+l,u=-1/0,v=-1/0,w=1/0,x=1/0;w=w>m?m:w,w=w>o?o:w,w=w>q?q:w,w=w>s?s:w,x=x>n?n:x,x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,u=m>u?m:u,u=o>u?o:u,u=q>u?q:u,u=s>u?s:u,v=n>v?n:v,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v;var y=this._bounds;return y.x=w,y.width=u-w,y.y=x,y.height=v-x,y},d.Graphics.prototype.updateBounds=function(){for(var a,b,c,e,f,g=1/0,h=-1/0,i=1/0,j=-1/0,k=0;k<this.graphicsData.length;k++){var l=this.graphicsData[k],m=l.type,n=l.lineWidth;
if(a=l.points,m===d.Graphics.RECT)b=a[0]-n/2,c=a[1]-n/2,e=a[2]+n,f=a[3]+n,g=g>b?b:g,h=b+e>h?b+e:h,i=i>c?b:i,j=c+f>j?c+f:j;else if(m===d.Graphics.CIRC||m===d.Graphics.ELIP)b=a[0],c=a[1],e=a[2]+n/2,f=a[3]+n/2,g=g>b-e?b-e:g,h=b+e>h?b+e:h,i=i>c-f?c-f:i,j=c+f>j?c+f:j;else for(var o=0;o<a.length;o+=2)b=a[o],c=a[o+1],g=g>b-n?b-n:g,h=b+n>h?b+n:h,i=i>c-n?c-n:i,j=c+n>j?c+n:j}var p=this.boundsPadding;this.bounds=new d.Rectangle(g-p,i-p,h-g+2*p,j-i+2*p)},d.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var b=new d.CanvasBuffer(a.width,a.height),c=d.Texture.fromCanvas(b.canvas);this._cachedSprite=new d.Sprite(c),this._cachedSprite.buffer=b,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._cachedSprite.buffer.context.translate(-a.x,-a.y),d.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context)},d.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},d.Graphics.POLY=0,d.Graphics.RECT=1,d.Graphics.CIRC=2,d.Graphics.ELIP=3,d.Strip=function(a,b,c){d.DisplayObjectContainer.call(this),this.texture=a,this.blendMode=d.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(e){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=b,this.height=c,a.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},d.Strip.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Strip.prototype.constructor=d.Strip,d.Strip.prototype.setTexture=function(a){this.texture=a,this.width=a.frame.width,this.height=a.frame.height,this.updateFrame=!0},d.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},d.Rope=function(a,b){d.Strip.call(this,a),this.points=b;try{this.verticies=new Float32Array(4*b.length),this.uvs=new Float32Array(4*b.length),this.colors=new Float32Array(2*b.length),this.indices=new Uint16Array(2*b.length)}catch(c){this.verticies=new Array(4*b.length),this.uvs=new Array(4*b.length),this.colors=new Array(2*b.length),this.indices=new Array(2*b.length)}this.refresh()},d.Rope.prototype=Object.create(d.Strip.prototype),d.Rope.prototype.constructor=d.Rope,d.Rope.prototype.refresh=function(){var a=this.points;if(!(a.length<1)){var b=this.uvs,c=a[0],d=this.indices,e=this.colors;this.count-=.2,b[0]=0,b[1]=1,b[2]=0,b[3]=1,e[0]=1,e[1]=1,d[0]=0,d[1]=1;for(var f,g,h,i=a.length,j=1;i>j;j++)f=a[j],g=4*j,h=j/(i-1),j%2?(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1):(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1),g=2*j,e[g]=1,e[g+1]=1,g=2*j,d[g]=g,d[g+1]=g+1,c=f}},d.Rope.prototype.updateTransform=function(){var a=this.points;if(!(a.length<1)){var b,c=a[0],e={x:0,y:0};this.count-=.2;var f=this.verticies;f[0]=c.x+e.x,f[1]=c.y+e.y,f[2]=c.x-e.x,f[3]=c.y-e.y;for(var g,h,i,j,k,l=a.length,m=1;l>m;m++)g=a[m],h=4*m,b=m<a.length-1?a[m+1]:g,e.y=-(b.x-c.x),e.x=b.y-c.y,i=10*(1-m/(l-1)),i>1&&(i=1),j=Math.sqrt(e.x*e.x+e.y*e.y),k=this.texture.height/2,e.x/=j,e.y/=j,e.x*=k,e.y*=k,f[h]=g.x+e.x,f[h+1]=g.y+e.y,f[h+2]=g.x-e.x,f[h+3]=g.y-e.y,c=g;d.DisplayObjectContainer.prototype.updateTransform.call(this)}},d.Rope.prototype.setTexture=function(a){this.texture=a,this.updateFrame=!0},d.TilingSprite=function(a,b,c){d.Sprite.call(this,a),this.width=b||100,this.height=c||100,this.tileScale=new d.Point(1,1),this.tileScaleOffset=new d.Point(1,1),this.tilePosition=new d.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=d.blendModes.NORMAL},d.TilingSprite.prototype=Object.create(d.Sprite.prototype),d.TilingSprite.prototype.constructor=d.TilingSprite,Object.defineProperty(d.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}}),Object.defineProperty(d.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}}),d.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},d.TilingSprite.prototype.setTexture=function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)},d.TilingSprite.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha){var b,c;for(this.mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this.filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(d.updateWebGLTexture(this.tilingTexture.baseTexture,a.gl),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this.filters&&a.filterManager.popFilter(),this.mask&&a.maskManager.popMask(a),a.spriteBatch.start()}},d.TilingSprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){var b=a.context;this._mask&&a.maskManager.pushMask(this._mask,b),b.globalAlpha=this.worldAlpha;var c=this.worldTransform;b.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty),(!this.__tilePattern||this.refreshTexture)&&(this.generateTilingTexture(!1),this.tilingTexture&&(this.__tilePattern=b.createPattern(this.tilingTexture.baseTexture.source,"repeat"))),this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,b.globalCompositeOperation=d.blendModesCanvas[a.currentBlendMode]),b.beginPath();var e=this.tilePosition,f=this.tileScale;e.x%=this.tilingTexture.baseTexture.width,e.y%=this.tilingTexture.baseTexture.height,b.scale(f.x,f.y),b.translate(e.x,e.y),b.fillStyle=this.__tilePattern,b.fillRect(-e.x,-e.y,this.width/f.x,this.height/f.y),b.scale(1/f.x,1/f.y),b.translate(-e.x,-e.y),b.closePath(),this._mask&&a.maskManager.popMask(a.context)}},d.TilingSprite.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,e=b*(1-this.anchor.y),f=b*-this.anchor.y,g=this.worldTransform,h=g.a,i=g.c,j=g.b,k=g.d,l=g.tx,m=g.ty,n=h*d+j*f+l,o=k*f+i*d+m,p=h*c+j*f+l,q=k*f+i*c+m,r=h*c+j*e+l,s=k*e+i*c+m,t=h*d+j*e+l,u=k*e+i*d+m,v=-1/0,w=-1/0,x=1/0,y=1/0;x=x>n?n:x,x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,v=n>v?n:v,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w;var z=this._bounds;return z.x=x,z.width=v-x,z.y=y,z.height=w-y,this._currentBounds=z,z},d.TilingSprite.prototype.generateTilingTexture=function(a){var b=this.texture;if(b.baseTexture.hasLoaded){var c,e,f=b.baseTexture,g=b.frame,h=g.width!==f.width||g.height!==f.height,i=!1;if(a?(c=d.getNextPowerOfTwo(g.width),e=d.getNextPowerOfTwo(g.height),g.width!==c&&g.height!==e&&(i=!0)):h&&(c=g.width,e=g.height,i=!0),i){var j;this.tilingTexture&&this.tilingTexture.isTiling?(j=this.tilingTexture.canvasBuffer,j.resize(c,e),this.tilingTexture.baseTexture.width=c,this.tilingTexture.baseTexture.height=e,this.tilingTexture.needsUpdate=!0):(j=new d.CanvasBuffer(c,e),this.tilingTexture=d.Texture.fromCanvas(j.canvas),this.tilingTexture.canvasBuffer=j,this.tilingTexture.isTiling=!0),j.context.drawImage(b.baseTexture.source,g.x,g.y,g.width,g.height,0,0,c,e),this.tileScaleOffset.x=g.width/c,this.tileScaleOffset.y=g.height/e}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=b;this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}};var i={};i.BoneData=function(a,b){this.name=a,this.parent=b},i.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},i.SlotData=function(a,b){this.name=a,this.boneData=b},i.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},i.Bone=function(a,b){this.data=a,this.parent=b,this.setToSetupPose()},i.Bone.yDown=!1,i.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(a,b){var c=this.parent;null!=c?(this.worldX=this.x*c.m00+this.y*c.m01+c.worldX,this.worldY=this.x*c.m10+this.y*c.m11+c.worldY,this.worldScaleX=c.worldScaleX*this.scaleX,this.worldScaleY=c.worldScaleY*this.scaleY,this.worldRotation=c.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var d=this.worldRotation*Math.PI/180,e=Math.cos(d),f=Math.sin(d);this.m00=e*this.worldScaleX,this.m10=f*this.worldScaleX,this.m01=-f*this.worldScaleY,this.m11=e*this.worldScaleY,a&&(this.m00=-this.m00,this.m01=-this.m01),b&&(this.m10=-this.m10,this.m11=-this.m11),i.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var a=this.data;this.x=a.x,this.y=a.y,this.rotation=a.rotation,this.scaleX=a.scaleX,this.scaleY=a.scaleY}},i.Slot=function(a,b,c){this.data=a,this.skeleton=b,this.bone=c,this.setToSetupPose()},i.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(a){this.attachment=a,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(a){this._attachmentTime=this.skeleton.time-a},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var a=this.data;this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a;for(var b=this.skeleton.data.slots,c=0,d=b.length;d>c;c++)if(b[c]==a){this.setAttachment(a.attachmentName?this.skeleton.getAttachmentBySlotIndex(c,a.attachmentName):null);break}}},i.Skin=function(a){this.name=a,this.attachments={}},i.Skin.prototype={addAttachment:function(a,b,c){this.attachments[a+":"+b]=c},getAttachment:function(a,b){return this.attachments[a+":"+b]},_attachAll:function(a,b){for(var c in b.attachments){var d=c.indexOf(":"),e=parseInt(c.substring(0,d),10),f=c.substring(d+1),g=a.slots[e];if(g.attachment&&g.attachment.name==f){var h=this.getAttachment(e,f);h&&g.setAttachment(h)}}}},i.Animation=function(a,b,c){this.name=a,this.timelines=b,this.duration=c},i.Animation.prototype={apply:function(a,b,c){c&&this.duration&&(b%=this.duration);for(var d=this.timelines,e=0,f=d.length;f>e;e++)d[e].apply(a,b,1)},mix:function(a,b,c,d){c&&this.duration&&(b%=this.duration);for(var e=this.timelines,f=0,g=e.length;g>f;f++)e[f].apply(a,b,d)}},i.binarySearch=function(a,b,c){var d=0,e=Math.floor(a.length/c)-2;if(!e)return c;for(var f=e>>>1;;){if(a[(f+1)*c]<=b?d=f+1:e=f,d==e)return(d+1)*c;f=d+e>>>1}},i.linearSearch=function(a,b,c){for(var d=0,e=a.length-c;e>=d;d+=c)if(a[d]>b)return d;return-1},i.Curves=function(a){this.curves=[],this.curves.length=6*(a-1)},i.Curves.prototype={setLinear:function(a){this.curves[6*a]=0},setStepped:function(a){this.curves[6*a]=-1},setCurve:function(a,b,c,d,e){var f=.1,g=f*f,h=g*f,i=3*f,j=3*g,k=6*g,l=6*h,m=2*-b+d,n=2*-c+e,o=3*(b-d)+1,p=3*(c-e)+1,q=6*a,r=this.curves;r[q]=b*i+m*j+o*h,r[q+1]=c*i+n*j+p*h,r[q+2]=m*k+o*l,r[q+3]=n*k+p*l,r[q+4]=o*l,r[q+5]=p*l},getCurvePercent:function(a,b){b=0>b?0:b>1?1:b;var c=6*a,d=this.curves,e=d[c];if(!e)return b;if(-1==e)return 0;for(var f=d[c+1],g=d[c+2],h=d[c+3],i=d[c+4],j=d[c+5],k=e,l=f,m=8;;){if(k>=b){var n=k-e,o=l-f;return o+(l-o)*(b-n)/(k-n)}if(!m)break;m--,e+=g,f+=h,g+=i,h+=j,k+=e,l+=f}return l+(1-l)*(b-k)/(1-k)}},i.RotateTimeline=function(a){this.curves=new i.Curves(a),this.frames=[],this.frames.length=2*a},i.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(a,b,c){a*=2,this.frames[a]=b,this.frames[a+1]=c},apply:function(a,b,c){var d,e=this.frames;if(!(b<e[0])){var f=a.bones[this.boneIndex];if(b>=e[e.length-2]){for(d=f.data.rotation+e[e.length-1]-f.rotation;d>180;)d-=360;for(;-180>d;)d+=360;return void(f.rotation+=d*c)}var g=i.binarySearch(e,b,2),h=e[g-1],j=e[g],k=1-(b-j)/(e[g-2]-j);for(k=this.curves.getCurvePercent(g/2-1,k),d=e[g+1]-h;d>180;)d-=360;for(;-180>d;)d+=360;for(d=f.data.rotation+(h+d*k)-f.rotation;d>180;)d-=360;for(;-180>d;)d+=360;f.rotation+=d*c}}},i.TranslateTimeline=function(a){this.curves=new i.Curves(a),this.frames=[],this.frames.length=3*a},i.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var e=a.bones[this.boneIndex];if(b>=d[d.length-3])return e.x+=(e.data.x+d[d.length-2]-e.x)*c,void(e.y+=(e.data.y+d[d.length-1]-e.y)*c);var f=i.binarySearch(d,b,3),g=d[f-2],h=d[f-1],j=d[f],k=1-(b-j)/(d[f+-3]-j);k=this.curves.getCurvePercent(f/3-1,k),e.x+=(e.data.x+g+(d[f+1]-g)*k-e.x)*c,e.y+=(e.data.y+h+(d[f+2]-h)*k-e.y)*c}}},i.ScaleTimeline=function(a){this.curves=new i.Curves(a),this.frames=[],this.frames.length=3*a},i.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var e=a.bones[this.boneIndex];if(b>=d[d.length-3])return e.scaleX+=(e.data.scaleX-1+d[d.length-2]-e.scaleX)*c,void(e.scaleY+=(e.data.scaleY-1+d[d.length-1]-e.scaleY)*c);var f=i.binarySearch(d,b,3),g=d[f-2],h=d[f-1],j=d[f],k=1-(b-j)/(d[f+-3]-j);k=this.curves.getCurvePercent(f/3-1,k),e.scaleX+=(e.data.scaleX-1+g+(d[f+1]-g)*k-e.scaleX)*c,e.scaleY+=(e.data.scaleY-1+h+(d[f+2]-h)*k-e.scaleY)*c}}},i.ColorTimeline=function(a){this.curves=new i.Curves(a),this.frames=[],this.frames.length=5*a},i.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(c,d){c*=5,this.frames[c]=d,this.frames[c+1]=r,this.frames[c+2]=g,this.frames[c+3]=b,this.frames[c+4]=a},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var e=a.slots[this.slotIndex];if(b>=d[d.length-5]){var f=d.length-1;return e.r=d[f-3],e.g=d[f-2],e.b=d[f-1],e.a=d[f],void 0}var g=i.binarySearch(d,b,5),h=d[g-4],j=d[g-3],k=d[g-2],l=d[g-1],m=d[g],n=1-(b-m)/(d[g-5]-m);n=this.curves.getCurvePercent(g/5-1,n);var o=h+(d[g+1]-h)*n,p=j+(d[g+2]-j)*n,q=k+(d[g+3]-k)*n,r=l+(d[g+4]-l)*n;1>c?(e.r+=(o-e.r)*c,e.g+=(p-e.g)*c,e.b+=(q-e.b)*c,e.a+=(r-e.a)*c):(e.r=o,e.g=p,e.b=q,e.a=r)}}},i.AttachmentTimeline=function(a){this.curves=new i.Curves(a),this.frames=[],this.frames.length=a,this.attachmentNames=[],this.attachmentNames.length=a},i.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(a,b,c){this.frames[a]=b,this.attachmentNames[a]=c},apply:function(a,b){var c=this.frames;if(!(b<c[0])){var d;d=b>=c[c.length-1]?c.length-1:i.binarySearch(c,b,1)-1;var e=this.attachmentNames[d];a.slots[this.slotIndex].setAttachment(e?a.getAttachmentBySlotIndex(this.slotIndex,e):null)}}},i.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},i.SkeletonData.prototype={defaultSkin:null,findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return slot[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSkin:function(a){for(var b=this.skins,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},findAnimation:function(a){for(var b=this.animations,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null}},i.Skeleton=function(a){this.data=a,this.bones=[];for(var b=0,c=a.bones.length;c>b;b++){var d=a.bones[b],e=d.parent?this.bones[a.bones.indexOf(d.parent)]:null;this.bones.push(new i.Bone(d,e))}for(this.slots=[],this.drawOrder=[],b=0,c=a.slots.length;c>b;b++){var f=a.slots[b],g=this.bones[a.bones.indexOf(f.boneData)],h=new i.Slot(f,this,g);this.slots.push(h),this.drawOrder.push(h)}},i.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var a=this.flipX,b=this.flipY,c=this.bones,d=0,e=c.length;e>d;d++)c[d].updateWorldTransform(a,b)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var a=this.bones,b=0,c=a.length;c>b;b++)a[b].setToSetupPose()},setSlotsToSetupPose:function(){for(var a=this.slots,b=0,c=a.length;c>b;b++)a[b].setToSetupPose(b)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return b[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},setSkinByName:function(a){var b=this.data.findSkin(a);if(!b)throw"Skin not found: "+a;this.setSkin(b)},setSkin:function(a){this.skin&&a&&a._attachAll(this,this.skin),this.skin=a},getAttachmentBySlotName:function(a,b){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(a),b)},getAttachmentBySlotIndex:function(a,b){if(this.skin){var c=this.skin.getAttachment(a,b);if(c)return c}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(a,b):null},setAttachment:function(a,b){for(var c=this.slots,d=0,e=c.size;e>d;d++){var f=c[d];if(f.data.name==a){var g=null;if(b&&(g=this.getAttachment(d,b),null==g))throw"Attachment not found: "+b+", for slot: "+a;return void f.setAttachment(g)}}throw"Slot not found: "+a},update:function(a){time+=a}},i.AttachmentType={region:0},i.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},i.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(a,b,c,d,e){var f=this.uvs;e?(f[2]=a,f[3]=d,f[4]=a,f[5]=b,f[6]=c,f[7]=b,f[0]=c,f[1]=d):(f[0]=a,f[1]=d,f[2]=a,f[3]=b,f[4]=c,f[5]=b,f[6]=c,f[7]=d)},updateOffset:function(){var a=this.width/this.regionOriginalWidth*this.scaleX,b=this.height/this.regionOriginalHeight*this.scaleY,c=-this.width/2*this.scaleX+this.regionOffsetX*a,d=-this.height/2*this.scaleY+this.regionOffsetY*b,e=c+this.regionWidth*a,f=d+this.regionHeight*b,g=this.rotation*Math.PI/180,h=Math.cos(g),i=Math.sin(g),j=c*h+this.x,k=c*i,l=d*h+this.y,m=d*i,n=e*h+this.x,o=e*i,p=f*h+this.y,q=f*i,r=this.offset;r[0]=j-m,r[1]=l+k,r[2]=j-q,r[3]=p+k,r[4]=n-q,r[5]=p+o,r[6]=n-m,r[7]=l+o},computeVertices:function(a,b,c,d){a+=c.worldX,b+=c.worldY;var e=c.m00,f=c.m01,g=c.m10,h=c.m11,i=this.offset;d[0]=i[0]*e+i[1]*f+a,d[1]=i[0]*g+i[1]*h+b,d[2]=i[2]*e+i[3]*f+a,d[3]=i[2]*g+i[3]*h+b,d[4]=i[4]*e+i[5]*f+a,d[5]=i[4]*g+i[5]*h+b,d[6]=i[6]*e+i[7]*f+a,d[7]=i[6]*g+i[7]*h+b}},i.AnimationStateData=function(a){this.skeletonData=a,this.animationToMixTime={}},i.AnimationStateData.prototype={defaultMix:0,setMixByName:function(a,b,c){var d=this.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;var e=this.skeletonData.findAnimation(b);if(!e)throw"Animation not found: "+b;this.setMix(d,e,c)},setMix:function(a,b,c){this.animationToMixTime[a.name+":"+b.name]=c},getMix:function(a,b){var c=this.animationToMixTime[a.name+":"+b.name];return c?c:this.defaultMix}},i.AnimationState=function(a){this.data=a,this.queue=[]},i.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(a){if(this.currentTime+=a,this.previousTime+=a,this.mixTime+=a,this.queue.length>0){var b=this.queue[0];this.currentTime>=b.delay&&(this._setAnimation(b.animation,b.loop),this.queue.shift())}},apply:function(a){if(this.current)if(this.previous){this.previous.apply(a,this.previousTime,this.previousLoop);var b=this.mixTime/this.mixDuration;b>=1&&(b=1,this.previous=null),this.current.mix(a,this.currentTime,this.currentLoop,b)}else this.current.apply(a,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(a,b){this.previous=null,a&&this.current&&(this.mixDuration=this.data.getMix(this.current,a),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=a,this.currentLoop=b,this.currentTime=0},setAnimationByName:function(a,b){var c=this.data.skeletonData.findAnimation(a);if(!c)throw"Animation not found: "+a;this.setAnimation(c,b)},setAnimation:function(a,b){this.queue.length=0,this._setAnimation(a,b)},addAnimationByName:function(a,b,c){var d=this.data.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;this.addAnimation(d,b,c)},addAnimation:function(a,b,c){var d={};if(d.animation=a,d.loop=b,!c||0>=c){var e=this.queue.length?this.queue[this.queue.length-1].animation:this.current;c=null!=e?e.duration-this.data.getMix(e,a)+(c||0):0}d.delay=c,this.queue.push(d)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},i.SkeletonJson=function(a){this.attachmentLoader=a},i.SkeletonJson.prototype={scale:1,readSkeletonData:function(a){for(var b,c=new i.SkeletonData,d=a.bones,e=0,f=d.length;f>e;e++){var g=d[e],h=null;if(g.parent&&(h=c.findBone(g.parent),!h))throw"Parent bone not found: "+g.parent;b=new i.BoneData(g.name,h),b.length=(g.length||0)*this.scale,b.x=(g.x||0)*this.scale,b.y=(g.y||0)*this.scale,b.rotation=g.rotation||0,b.scaleX=g.scaleX||1,b.scaleY=g.scaleY||1,c.bones.push(b)}var j=a.slots;for(e=0,f=j.length;f>e;e++){var k=j[e];if(b=c.findBone(k.bone),!b)throw"Slot bone not found: "+k.bone;var l=new i.SlotData(k.name,b),m=k.color;m&&(l.r=i.SkeletonJson.toColor(m,0),l.g=i.SkeletonJson.toColor(m,1),l.b=i.SkeletonJson.toColor(m,2),l.a=i.SkeletonJson.toColor(m,3)),l.attachmentName=k.attachment,c.slots.push(l)}var n=a.skins;for(var o in n)if(n.hasOwnProperty(o)){var p=n[o],q=new i.Skin(o);for(var r in p)if(p.hasOwnProperty(r)){var s=c.findSlotIndex(r),t=p[r];for(var u in t)if(t.hasOwnProperty(u)){var v=this.readAttachment(q,u,t[u]);null!=v&&q.addAttachment(s,u,v)}}c.skins.push(q),"default"==q.name&&(c.defaultSkin=q)}var w=a.animations;for(var x in w)w.hasOwnProperty(x)&&this.readAnimation(x,w[x],c);return c},readAttachment:function(a,b,c){b=c.name||b;var d=i.AttachmentType[c.type||"region"];if(d==i.AttachmentType.region){var e=new i.RegionAttachment;return e.x=(c.x||0)*this.scale,e.y=(c.y||0)*this.scale,e.scaleX=c.scaleX||1,e.scaleY=c.scaleY||1,e.rotation=c.rotation||0,e.width=(c.width||32)*this.scale,e.height=(c.height||32)*this.scale,e.updateOffset(),e.rendererObject={},e.rendererObject.name=b,e.rendererObject.scale={},e.rendererObject.scale.x=e.scaleX,e.rendererObject.scale.y=e.scaleY,e.rendererObject.rotation=-e.rotation*Math.PI/180,e}throw"Unknown attachment type: "+d},readAnimation:function(a,b,c){var d,e,f,g,h,j,k,l=[],m=0,n=b.bones;for(var o in n)if(n.hasOwnProperty(o)){var p=c.findBoneIndex(o);if(-1==p)throw"Bone not found: "+o;var q=n[o];for(f in q)if(q.hasOwnProperty(f))if(h=q[f],"rotate"==f){for(e=new i.RotateTimeline(h.length),e.boneIndex=p,d=0,j=0,k=h.length;k>j;j++)g=h[j],e.setFrame(d,g.time,g.angle),i.SkeletonJson.readCurve(e,d,g),d++;l.push(e),m=Math.max(m,e.frames[2*e.getFrameCount()-2])}else{if("translate"!=f&&"scale"!=f)throw"Invalid timeline type for a bone: "+f+" ("+o+")";var r=1;for("scale"==f?e=new i.ScaleTimeline(h.length):(e=new i.TranslateTimeline(h.length),r=this.scale),e.boneIndex=p,d=0,j=0,k=h.length;k>j;j++){g=h[j];var s=(g.x||0)*r,t=(g.y||0)*r;e.setFrame(d,g.time,s,t),i.SkeletonJson.readCurve(e,d,g),d++}l.push(e),m=Math.max(m,e.frames[3*e.getFrameCount()-3])}}var u=b.slots;for(var v in u)if(u.hasOwnProperty(v)){var w=u[v],x=c.findSlotIndex(v);for(f in w)if(w.hasOwnProperty(f))if(h=w[f],"color"==f){for(e=new i.ColorTimeline(h.length),e.slotIndex=x,d=0,j=0,k=h.length;k>j;j++){g=h[j];var y=g.color,z=i.SkeletonJson.toColor(y,0),A=i.SkeletonJson.toColor(y,1),B=i.SkeletonJson.toColor(y,2),C=i.SkeletonJson.toColor(y,3);e.setFrame(d,g.time,z,A,B,C),i.SkeletonJson.readCurve(e,d,g),d++}l.push(e),m=Math.max(m,e.frames[5*e.getFrameCount()-5])}else{if("attachment"!=f)throw"Invalid timeline type for a slot: "+f+" ("+v+")";for(e=new i.AttachmentTimeline(h.length),e.slotIndex=x,d=0,j=0,k=h.length;k>j;j++)g=h[j],e.setFrame(d++,g.time,g.name);l.push(e),m=Math.max(m,e.frames[e.getFrameCount()-1])}}c.animations.push(new i.Animation(a,l,m))}},i.SkeletonJson.readCurve=function(a,b,c){var d=c.curve;d&&("stepped"==d?a.curves.setStepped(b):d instanceof Array&&a.curves.setCurve(b,d[0],d[1],d[2],d[3]))},i.SkeletonJson.toColor=function(a,b){if(8!=a.length)throw"Color hexidecimal length must be 8, recieved: "+a;return parseInt(a.substring(2*b,2),16)/255},i.Atlas=function(a,b){this.textureLoader=b,this.pages=[],this.regions=[];var c=new i.AtlasReader(a),d=[];d.length=4;for(var e=null;;){var f=c.readLine();if(null==f)break;if(f=c.trim(f),f.length)if(e){var g=new i.AtlasRegion;g.name=f,g.page=e,g.rotate="true"==c.readValue(),c.readTuple(d);var h=parseInt(d[0],10),j=parseInt(d[1],10);c.readTuple(d);var k=parseInt(d[0],10),l=parseInt(d[1],10);g.u=h/e.width,g.v=j/e.height,g.rotate?(g.u2=(h+l)/e.width,g.v2=(j+k)/e.height):(g.u2=(h+k)/e.width,g.v2=(j+l)/e.height),g.x=h,g.y=j,g.width=Math.abs(k),g.height=Math.abs(l),4==c.readTuple(d)&&(g.splits=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],4==c.readTuple(d)&&(g.pads=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],c.readTuple(d))),g.originalWidth=parseInt(d[0],10),g.originalHeight=parseInt(d[1],10),c.readTuple(d),g.offsetX=parseInt(d[0],10),g.offsetY=parseInt(d[1],10),g.index=parseInt(c.readValue(),10),this.regions.push(g)}else{e=new i.AtlasPage,e.name=f,e.format=i.Atlas.Format[c.readValue()],c.readTuple(d),e.minFilter=i.Atlas.TextureFilter[d[0]],e.magFilter=i.Atlas.TextureFilter[d[1]];var m=c.readValue();e.uWrap=i.Atlas.TextureWrap.clampToEdge,e.vWrap=i.Atlas.TextureWrap.clampToEdge,"x"==m?e.uWrap=i.Atlas.TextureWrap.repeat:"y"==m?e.vWrap=i.Atlas.TextureWrap.repeat:"xy"==m&&(e.uWrap=e.vWrap=i.Atlas.TextureWrap.repeat),b.load(e,f),this.pages.push(e)}else e=null}},i.Atlas.prototype={findRegion:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},dispose:function(){for(var a=this.pages,b=0,c=a.length;c>b;b++)this.textureLoader.unload(a[b].rendererObject)},updateUVs:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++){var e=b[c];e.page==a&&(e.u=e.x/a.width,e.v=e.y/a.height,e.rotate?(e.u2=(e.x+e.height)/a.width,e.v2=(e.y+e.width)/a.height):(e.u2=(e.x+e.width)/a.width,e.v2=(e.y+e.height)/a.height))}}},i.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},i.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},i.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},i.AtlasPage=function(){},i.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},i.AtlasRegion=function(){},i.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},i.AtlasReader=function(a){this.lines=a.split(/\r\n|\r|\n/)},i.AtlasReader.prototype={index:0,trim:function(a){return a.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var a=this.readLine(),b=a.indexOf(":");if(-1==b)throw"Invalid line: "+a;return this.trim(a.substring(b+1))},readTuple:function(a){var b=this.readLine(),c=b.indexOf(":");if(-1==c)throw"Invalid line: "+b;for(var d=0,e=c+1;3>d;d++){var f=b.indexOf(",",e);if(-1==f){if(!d)throw"Invalid line: "+b;break}a[d]=this.trim(b.substr(e,f-e)),e=f+1}return a[d]=this.trim(b.substring(e)),d+1}},i.AtlasAttachmentLoader=function(a){this.atlas=a},i.AtlasAttachmentLoader.prototype={newAttachment:function(a,b,c){switch(b){case i.AttachmentType.region:var d=this.atlas.findRegion(c);if(!d)throw"Region not found in atlas: "+c+" ("+b+")";var e=new i.RegionAttachment(c);return e.rendererObject=d,e.setUVs(d.u,d.v,d.u2,d.v2,d.rotate),e.regionOffsetX=d.offsetX,e.regionOffsetY=d.offsetY,e.regionWidth=d.width,e.regionHeight=d.height,e.regionOriginalWidth=d.originalWidth,e.regionOriginalHeight=d.originalHeight,e}throw"Unknown attachment type: "+b}},i.Bone.yDown=!0,d.AnimCache={},d.Spine=function(a){if(d.DisplayObjectContainer.call(this),this.spineData=d.AnimCache[a],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+a);this.skeleton=new i.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new i.AnimationStateData(this.spineData),this.state=new i.AnimationState(this.stateData),this.slotContainers=[];for(var b=0,c=this.skeleton.drawOrder.length;c>b;b++){var e=this.skeleton.drawOrder[b],f=e.attachment,g=new d.DisplayObjectContainer;if(this.slotContainers.push(g),this.addChild(g),f instanceof i.RegionAttachment){var h=f.rendererObject.name,j=this.createSprite(e,f.rendererObject);e.currentSprite=j,e.currentSpriteName=h,g.addChild(j)}}},d.Spine.prototype=Object.create(d.DisplayObjectContainer.prototype),d.Spine.prototype.constructor=d.Spine,d.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var a=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(a),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var b=this.skeleton.drawOrder,c=0,e=b.length;e>c;c++){var f=b[c],g=f.attachment,h=this.slotContainers[c];if(g instanceof i.RegionAttachment){if(g.rendererObject&&(!f.currentSpriteName||f.currentSpriteName!=g.name)){var j=g.rendererObject.name;if(void 0!==f.currentSprite&&(f.currentSprite.visible=!1),f.sprites=f.sprites||{},void 0!==f.sprites[j])f.sprites[j].visible=!0;else{var k=this.createSprite(f,g.rendererObject);h.addChild(k)}f.currentSprite=f.sprites[j],f.currentSpriteName=j}h.visible=!0;var l=f.bone;h.position.x=l.worldX+g.x*l.m00+g.y*l.m01,h.position.y=l.worldY+g.x*l.m10+g.y*l.m11,h.scale.x=l.worldScaleX,h.scale.y=l.worldScaleY,h.rotation=-(f.bone.worldRotation*Math.PI/180)}else h.visible=!1}d.DisplayObjectContainer.prototype.updateTransform.call(this)},d.Spine.prototype.createSprite=function(a,b){var c=d.TextureCache[b.name]?b.name:b.name+".png",e=new d.Sprite(d.Texture.fromFrame(c));return e.scale=b.scale,e.rotation=b.rotation,e.anchor.x=e.anchor.y=.5,a.sprites=a.sprites||{},a.sprites[b.name]=e,e},d.BaseTextureCache={},d.texturesToUpdate=[],d.texturesToDestroy=[],d.BaseTextureCacheIdGenerator=0,d.BaseTexture=function(a,b){if(d.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=b||d.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,this.id=d.BaseTextureCacheIdGenerator++,this._glTextures=[],a){if(this.source.complete||this.source.getContext)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,d.texturesToUpdate.push(this);else{var c=this;this.source.onload=function(){c.hasLoaded=!0,c.width=c.source.width,c.height=c.source.height,d.texturesToUpdate.push(c),c.dispatchEvent({type:"loaded",content:c})}}this.imageUrl=null,this._powerOf2=!1}},d.BaseTexture.prototype.constructor=d.BaseTexture,d.BaseTexture.prototype.destroy=function(){this.imageUrl&&(delete d.BaseTextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null),this.source=null,d.texturesToDestroy.push(this)
},d.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1,this.source.src=null,this.source.src=a},d.BaseTexture.fromImage=function(a,b,c){var e=d.BaseTextureCache[a];if(!e){var f=new Image;b&&(f.crossOrigin=""),f.src=a,e=new d.BaseTexture(f,c),e.imageUrl=a,d.BaseTextureCache[a]=e}return e},d.BaseTexture.fromCanvas=function(a,b){a._pixiId||(a._pixiId="canvas_"+d.TextureCacheIdGenerator++);var c=d.BaseTextureCache[a._pixiId];return c||(c=new d.BaseTexture(a,b),d.BaseTextureCache[a._pixiId]=c),c},d.TextureCache={},d.FrameCache={},d.TextureCacheIdGenerator=0,d.Texture=function(a,b){if(d.EventTarget.call(this),b||(this.noFrame=!0,b=new d.Rectangle(0,0,1,1)),a instanceof d.Texture&&(a=a.baseTexture),this.baseTexture=a,this.frame=b,this.trim=null,this.scope=this,this._uvs=null,a.hasLoaded)this.noFrame&&(b=new d.Rectangle(0,0,a.width,a.height)),this.setFrame(b);else{var c=this;a.addEventListener("loaded",function(){c.onBaseTextureLoaded()})}},d.Texture.prototype.constructor=d.Texture,d.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;a.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new d.Rectangle(0,0,a.width,a.height)),this.setFrame(this.frame),this.scope.dispatchEvent({type:"update",content:this})},d.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy()},d.Texture.prototype.setFrame=function(a){if(this.frame=a,this.width=a.width,this.height=a.height,a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,d.Texture.frameUpdates.push(this)},d.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new d.TextureUvs);var a=this.frame,b=this.baseTexture.width,c=this.baseTexture.height;this._uvs.x0=a.x/b,this._uvs.y0=a.y/c,this._uvs.x1=(a.x+a.width)/b,this._uvs.y1=a.y/c,this._uvs.x2=(a.x+a.width)/b,this._uvs.y2=(a.y+a.height)/c,this._uvs.x3=a.x/b,this._uvs.y3=(a.y+a.height)/c},d.Texture.fromImage=function(a,b,c){var e=d.TextureCache[a];return e||(e=new d.Texture(d.BaseTexture.fromImage(a,b,c)),d.TextureCache[a]=e),e},d.Texture.fromFrame=function(a){var b=d.TextureCache[a];if(!b)throw new Error('The frameId "'+a+'" does not exist in the texture cache ');return b},d.Texture.fromCanvas=function(a,b){var c=d.BaseTexture.fromCanvas(a,b);return new d.Texture(c)},d.Texture.addTextureToCache=function(a,b){d.TextureCache[b]=a},d.Texture.removeTextureFromCache=function(a){var b=d.TextureCache[a];return delete d.TextureCache[a],delete d.BaseTextureCache[a],b},d.Texture.frameUpdates=[],d.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y4=0},d.RenderTexture=function(a,b,c){if(d.EventTarget.call(this),this.width=a||100,this.height=b||100,this.frame=new d.Rectangle(0,0,this.width,this.height),this.baseTexture=new d.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.hasLoaded=!0,this.renderer=c||d.defaultRenderer,this.renderer.type===d.WEBGL_RENDERER){var e=this.renderer.gl;this.textureBuffer=new d.FilterTexture(e,this.width,this.height),this.baseTexture._glTextures[e.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new d.Point(this.width/2,-this.height/2)}else this.render=this.renderCanvas,this.textureBuffer=new d.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas;d.Texture.frameUpdates.push(this)},d.RenderTexture.prototype=Object.create(d.Texture.prototype),d.RenderTexture.prototype.constructor=d.RenderTexture,d.RenderTexture.prototype.resize=function(a,b){if(this.width=a,this.height=b,this.frame.width=this.width,this.frame.height=this.height,this.renderer.type===d.WEBGL_RENDERER){this.projection.x=this.width/2,this.projection.y=-this.height/2;var c=this.renderer.gl;c.bindTexture(c.TEXTURE_2D,this.baseTexture._glTextures[c.id]),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,this.width,this.height,0,c.RGBA,c.UNSIGNED_BYTE,null)}else this.textureBuffer.resize(this.width,this.height);d.Texture.frameUpdates.push(this)},d.RenderTexture.prototype.renderWebGL=function(a,b,c){var e=this.renderer.gl;e.colorMask(!0,!0,!0,!0),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),c&&this.textureBuffer.clear();var f=a.children,g=a.worldTransform;a.worldTransform=d.RenderTexture.tempMatrix,a.worldTransform.d=-1,a.worldTransform.ty=-2*this.projection.y,b&&(a.worldTransform.tx=b.x,a.worldTransform.ty-=b.y);for(var h=0,i=f.length;i>h;h++)f[h].updateTransform();d.WebGLRenderer.updateTextures(),this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),a.worldTransform=g},d.RenderTexture.prototype.renderCanvas=function(a,b,c){var e=a.children,f=a.worldTransform;a.worldTransform=d.RenderTexture.tempMatrix,b&&(a.worldTransform.tx=b.x,a.worldTransform.ty=b.y);for(var g=0,h=e.length;h>g;g++)e[g].updateTransform();c&&this.textureBuffer.clear();var i=this.textureBuffer.context;this.renderer.renderDisplayObject(a,i),i.setTransform(1,0,0,1,0,0),a.worldTransform=f},d.RenderTexture.tempMatrix=new d.Matrix,d.AssetLoader=function(a,b){d.EventTarget.call(this),this.assetURLs=a,this.crossorigin=b,this.loadersByType={jpg:d.ImageLoader,jpeg:d.ImageLoader,png:d.ImageLoader,gif:d.ImageLoader,json:d.JsonLoader,atlas:d.AtlasLoader,anim:d.SpineLoader,xml:d.BitmapFontLoader,fnt:d.BitmapFontLoader}},d.AssetLoader.prototype.constructor=d.AssetLoader,d.AssetLoader.prototype._getDataType=function(a){var b="data:",c=a.slice(0,b.length).toLowerCase();if(c===b){var d=a.slice(b.length),e=d.indexOf(",");if(-1===e)return null;var f=d.slice(0,e).split(";")[0];return f&&"text/plain"!==f.toLowerCase()?f.split("/").pop().toLowerCase():"txt"}return null},d.AssetLoader.prototype.load=function(){function a(a){b.onAssetLoaded(a.content)}var b=this;this.loadCount=this.assetURLs.length;for(var c=0;c<this.assetURLs.length;c++){var d=this.assetURLs[c],e=this._getDataType(d);e||(e=d.split("?").shift().split(".").pop().toLowerCase());var f=this.loadersByType[e];if(!f)throw new Error(e+" is an unsupported file type");var g=new f(d,this.crossorigin);g.addEventListener("loaded",a),g.load()}},d.AssetLoader.prototype.onAssetLoaded=function(a){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this,loader:a}),this.onProgress&&this.onProgress(a),this.loadCount||(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},d.JsonLoader=function(a,b){d.EventTarget.call(this),this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.loaded=!1},d.JsonLoader.prototype.constructor=d.JsonLoader,d.JsonLoader.prototype.load=function(){this.ajaxRequest=new d.AjaxRequest(this.crossorigin);var a=this;this.ajaxRequest.onreadystatechange=function(){a.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},d.JsonLoader.prototype.onJSONLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var a=this,b=this.baseUrl+this.json.meta.image,c=new d.ImageLoader(b,this.crossorigin),e=this.json.frames;this.texture=c.texture.baseTexture,c.addEventListener("loaded",function(){a.onLoaded()});for(var f in e){var g=e[f].frame;if(g&&(d.TextureCache[f]=new d.Texture(this.texture,{x:g.x,y:g.y,width:g.w,height:g.h}),e[f].trimmed)){var h=d.TextureCache[f],j=e[f].sourceSize,k=e[f].spriteSourceSize;h.trim=new d.Rectangle(k.x,k.y,j.w,j.h)}}c.load()}else if(this.json.bones){var l=new i.SkeletonJson,m=l.readSkeletonData(this.json);d.AnimCache[this.url]=m,this.onLoaded()}else this.onLoaded();else this.onError()},d.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},d.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},d.AtlasLoader=function(a,b){d.EventTarget.call(this),this.url=a,this.baseUrl=a.replace(/[^\/]*$/,""),this.crossorigin=b,this.loaded=!1},d.AtlasLoader.constructor=d.AtlasLoader,d.AtlasLoader.prototype.load=function(){this.ajaxRequest=new d.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},d.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var a=this.ajaxRequest.responseText.split(/\r?\n/),b=-3,c=0,e=null,f=!1,g=0,h=0,i=this.onLoaded.bind(this);for(g=0;g<a.length;g++)if(a[g]=a[g].replace(/^\s+|\s+$/g,""),""===a[g]&&(f=g+1),a[g].length>0){if(f===g)this.atlas.meta.image.push(a[g]),c=this.atlas.meta.image.length-1,this.atlas.frames.push({}),b=-3;else if(b>0)if(b%7===1)null!=e&&(this.atlas.frames[c][e.name]=e),e={name:a[g],frame:{}};else{var j=a[g].split(" ");if(b%7===3)e.frame.x=Number(j[1].replace(",","")),e.frame.y=Number(j[2]);else if(b%7===4)e.frame.w=Number(j[1].replace(",","")),e.frame.h=Number(j[2]);else if(b%7===5){var k={x:0,y:0,w:Number(j[1].replace(",","")),h:Number(j[2])};k.w>e.frame.w||k.h>e.frame.h?(e.trimmed=!0,e.realSize=k):e.trimmed=!1}}b++}if(null!=e&&(this.atlas.frames[c][e.name]=e),this.atlas.meta.image.length>0){for(this.images=[],h=0;h<this.atlas.meta.image.length;h++){var l=this.baseUrl+this.atlas.meta.image[h],m=this.atlas.frames[h];this.images.push(new d.ImageLoader(l,this.crossorigin));for(g in m){var n=m[g].frame;n&&(d.TextureCache[g]=new d.Texture(this.images[h].texture.baseTexture,{x:n.x,y:n.y,width:n.w,height:n.h}),m[g].trimmed&&(d.TextureCache[g].realSize=m[g].realSize,d.TextureCache[g].trim.x=0,d.TextureCache[g].trim.y=0))}}for(this.currentImageId=0,h=0;h<this.images.length;h++)this.images[h].addEventListener("loaded",i);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},d.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.dispatchEvent({type:"loaded",content:this}))},d.AtlasLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},d.SpriteSheetLoader=function(a,b){d.EventTarget.call(this),this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},d.SpriteSheetLoader.prototype.constructor=d.SpriteSheetLoader,d.SpriteSheetLoader.prototype.load=function(){var a=this,b=new d.JsonLoader(this.url,this.crossorigin);b.addEventListener("loaded",function(b){a.json=b.content.json,a.onLoaded()}),b.load()},d.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},d.ImageLoader=function(a,b){d.EventTarget.call(this),this.texture=d.Texture.fromImage(a,b),this.frames=[]},d.ImageLoader.prototype.constructor=d.ImageLoader,d.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var a=this;this.texture.baseTexture.addEventListener("loaded",function(){a.onLoaded()})}},d.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},d.ImageLoader.prototype.loadFramedSpriteSheet=function(a,b,c){this.frames=[];for(var e=Math.floor(this.texture.width/a),f=Math.floor(this.texture.height/b),g=0,h=0;f>h;h++)for(var i=0;e>i;i++,g++){var j=new d.Texture(this.texture,{x:i*a,y:h*b,width:a,height:b});this.frames.push(j),c&&(d.TextureCache[c+"-"+g]=j)}if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var k=this;this.texture.baseTexture.addEventListener("loaded",function(){k.onLoaded()})}},d.BitmapFontLoader=function(a,b){d.EventTarget.call(this),this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null},d.BitmapFontLoader.prototype.constructor=d.BitmapFontLoader,d.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new d.AjaxRequest;var a=this;this.ajaxRequest.onreadystatechange=function(){a.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},d.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var a=this.ajaxRequest.responseXML;if(!a||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var b=new DOMParser;a=b.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var c=document.createElement("div");c.innerHTML=this.ajaxRequest.responseText,a=c}var e=this.baseUrl+a.getElementsByTagName("page")[0].getAttribute("file"),f=new d.ImageLoader(e,this.crossorigin);this.texture=f.texture.baseTexture;var g={},h=a.getElementsByTagName("info")[0],i=a.getElementsByTagName("common")[0];g.font=h.getAttribute("face"),g.size=parseInt(h.getAttribute("size"),10),g.lineHeight=parseInt(i.getAttribute("lineHeight"),10),g.chars={};for(var j=a.getElementsByTagName("char"),k=0;k<j.length;k++){var l=parseInt(j[k].getAttribute("id"),10),m=new d.Rectangle(parseInt(j[k].getAttribute("x"),10),parseInt(j[k].getAttribute("y"),10),parseInt(j[k].getAttribute("width"),10),parseInt(j[k].getAttribute("height"),10));g.chars[l]={xOffset:parseInt(j[k].getAttribute("xoffset"),10),yOffset:parseInt(j[k].getAttribute("yoffset"),10),xAdvance:parseInt(j[k].getAttribute("xadvance"),10),kerning:{},texture:d.TextureCache[l]=new d.Texture(this.texture,m)}}var n=a.getElementsByTagName("kerning");for(k=0;k<n.length;k++){var o=parseInt(n[k].getAttribute("first"),10),p=parseInt(n[k].getAttribute("second"),10),q=parseInt(n[k].getAttribute("amount"),10);g.chars[p].kerning[o]=q}d.BitmapText.fonts[g.font]=g;var r=this;f.addEventListener("loaded",function(){r.onLoaded()}),f.load()}},d.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},d.SpineLoader=function(a,b){d.EventTarget.call(this),this.url=a,this.crossorigin=b,this.loaded=!1},d.SpineLoader.prototype.constructor=d.SpineLoader,d.SpineLoader.prototype.load=function(){var a=this,b=new d.JsonLoader(this.url,this.crossorigin);b.addEventListener("loaded",function(b){a.json=b.content.json,a.onLoaded()}),b.load()},d.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},d.AbstractFilter=function(a,b){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=b||{},this.fragmentSrc=a||[]},d.AlphaMaskFilter=function(a){d.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:a},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mask.value.x=a.width,this.uniforms.mask.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},d.AlphaMaskFilter.prototype=Object.create(d.AbstractFilter.prototype),d.AlphaMaskFilter.prototype.constructor=d.AlphaMaskFilter,d.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(d.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(a){this.uniforms.mask.value=a}}),d.ColorMatrixFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},d.ColorMatrixFilter.prototype=Object.create(d.AbstractFilter.prototype),d.ColorMatrixFilter.prototype.constructor=d.ColorMatrixFilter,Object.defineProperty(d.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(a){this.uniforms.matrix.value=a}}),d.GrayFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},d.GrayFilter.prototype=Object.create(d.AbstractFilter.prototype),d.GrayFilter.prototype.constructor=d.GrayFilter,Object.defineProperty(d.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(a){this.uniforms.gray.value=a}}),d.DisplacementFilter=function(a){d.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:a},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=a.width,this.uniforms.mapDimensions.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},d.DisplacementFilter.prototype=Object.create(d.AbstractFilter.prototype),d.DisplacementFilter.prototype.constructor=d.DisplacementFilter,d.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(d.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(a){this.uniforms.displacementMap.value=a}}),Object.defineProperty(d.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}}),Object.defineProperty(d.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}}),d.PixelateFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},d.PixelateFilter.prototype=Object.create(d.AbstractFilter.prototype),d.PixelateFilter.prototype.constructor=d.PixelateFilter,Object.defineProperty(d.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.dirty=!0,this.uniforms.pixelSize.value=a}}),d.BlurXFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},d.BlurXFilter.prototype=Object.create(d.AbstractFilter.prototype),d.BlurXFilter.prototype.constructor=d.BlurXFilter,Object.defineProperty(d.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.dirty=!0,this.uniforms.blur.value=1/7e3*a}}),d.BlurYFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},d.BlurYFilter.prototype=Object.create(d.AbstractFilter.prototype),d.BlurYFilter.prototype.constructor=d.BlurYFilter,Object.defineProperty(d.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),d.BlurFilter=function(){this.blurXFilter=new d.BlurXFilter,this.blurYFilter=new d.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},Object.defineProperty(d.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a}}),Object.defineProperty(d.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=a}}),Object.defineProperty(d.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a}}),d.InvertFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},d.InvertFilter.prototype=Object.create(d.AbstractFilter.prototype),d.InvertFilter.prototype.constructor=d.InvertFilter,Object.defineProperty(d.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(a){this.uniforms.invert.value=a}}),d.SepiaFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},d.SepiaFilter.prototype=Object.create(d.AbstractFilter.prototype),d.SepiaFilter.prototype.constructor=d.SepiaFilter,Object.defineProperty(d.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(a){this.uniforms.sepia.value=a}}),d.TwistFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},d.TwistFilter.prototype=Object.create(d.AbstractFilter.prototype),d.TwistFilter.prototype.constructor=d.TwistFilter,Object.defineProperty(d.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.dirty=!0,this.uniforms.offset.value=a}}),Object.defineProperty(d.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(a){this.dirty=!0,this.uniforms.radius.value=a}}),Object.defineProperty(d.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),d.ColorStepFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},d.ColorStepFilter.prototype=Object.create(d.AbstractFilter.prototype),d.ColorStepFilter.prototype.constructor=d.ColorStepFilter,Object.defineProperty(d.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(a){this.uniforms.step.value=a}}),d.DotScreenFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},d.DotScreenFilter.prototype=Object.create(d.DotScreenFilter.prototype),d.DotScreenFilter.prototype.constructor=d.DotScreenFilter,Object.defineProperty(d.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.dirty=!0,this.uniforms.scale.value=a}}),Object.defineProperty(d.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),d.CrossHatchFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},d.CrossHatchFilter.prototype=Object.create(d.AbstractFilter.prototype),d.CrossHatchFilter.prototype.constructor=d.BlurYFilter,Object.defineProperty(d.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),d.RGBSplitFilter=function(){d.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},d.RGBSplitFilter.prototype=Object.create(d.AbstractFilter.prototype),d.RGBSplitFilter.prototype.constructor=d.RGBSplitFilter,Object.defineProperty(d.RGBSplitFilter.prototype,"angle",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a
}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=d),exports.PIXI=d):"undefined"!=typeof define&&define.amd?define("pixi",d):c.PIXI=d}.call(this),function(){define("conversions",["box2d","pixi"],function(a,b){var c;return c={B2DtoPIXI:{toPoint:function(a){return new b.Point(a.x,a.y)}},PIXI2Box2D:{toVec2:function(b){return new a.Vec2(b.x,b.y)}}}})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("cannon_temperature_view",["view"],function(a){var c;return c=function(a){function c(a,b,d){this.spaceship=d,this.options={numberOfTicks:40,height:20,width:200,borderWidth:4,ticksPadding:2,borderColor:{nominal:11184810,jammaed:15597568}},c.__super__.constructor.call(this,a,b)}return b(c,a),c.prototype.createGraphics=function(){var a;return a=new PIXI.Graphics,this.cannonTemperatureGraphics=this._createCannonTemperatureGraphics(),a.addChild(this.cannonTemperatureGraphics),a},c.prototype.updateGraphics=function(){return this.borderGraphics.clear(),this._drawBorderGraphics(this.borderGraphics,this._getBorderColor()),this.ticksContainer.clear(),this._drawTicks()},c.prototype._createCannonTemperatureGraphics=function(){var a;return a=new PIXI.Graphics,this.borderGraphics=this._createBoderGraphics(),a.addChild(this.borderGraphics),this.ticksContainer=new PIXI.Graphics,a.addChild(this.ticksContainer),a.position.x=this.container.width-this.options.width-this.container.width/40,a.position.y=this.container.height-this.options.height-this.container.width/40,a},c.prototype._createBoderGraphics=function(){var a;return a=new PIXI.Graphics,this._drawBorderGraphics(a,this.options.borderColor.nominal),a},c.prototype._drawBorderGraphics=function(a,b){return a.lineStyle(this.options.borderWidth,b,.5),a.drawRect(0,0,this.options.width,this.options.height)},c.prototype._getBorderColor=function(){return this.spaceship.isCannonJammed()?this.options.borderColor.jammaed:this.options.borderColor.nominal},c.prototype._drawTicks=function(){var a,b,c,d,e,f,g;for(c=this.spaceship.getCannonTemperature(),g=[],b=e=0,f=this.options.numberOfTicks-1;f>=0?f>=e:e>=f;b=f>=0?++e:--e)a=this._calculateTickColor(b,c),d=(this.options.width-2*this.options.borderWidth)/this.options.numberOfTicks,g.push(this._drawTick(b,a,d,this.options.height));return g},c.prototype._drawTick=function(a,b,c,d){var e,f,g;return e=this.options.borderWidth,g=this.options.ticksPadding,f=d-2*e,this.ticksContainer.beginFill(b,.5),this.ticksContainer.lineStyle(this.options.ticksPadding,11184810,.5),this.ticksContainer.drawRect(e+a*c,e,c,f),this.ticksContainer.endFill()},c.prototype._calculateTickColor=function(a,b){var c,d,e,f,g;return g=1/this.options.numberOfTicks,a*g>b?16777215:(c=0,f=a/this.options.numberOfTicks,e=255*f,d=255*(1-f),this._getRgb(e,d,c))},c.prototype._getRgb=function(a,b,c){var d,e,f;return f=a<<16,e=b<<8,d=c+e+f},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("spaceship_view",["conversions","view","box2d","cannon_temperature_view","math_helpers"],function(a,c,d,e,f){var g;return g=function(c){function g(a,b,c){this.spaceship=c,this.cannonTemperatureView=new e(a,b,this.spaceship),g.__super__.constructor.call(this,a,b)}return b(g,c),g.prototype.createGraphics=function(){var a;return a=new PIXI.Graphics,this.spaceship.isSuperCannon()||a.addChild(this.cannonTemperatureView.createGraphics()),this.spaceshipGraphics=this._createSpaceshipGraphics(),this.distanceMeterGraphics=this._createOutOfWorldIndicatorGraphics(),a.addChild(this.spaceshipGraphics),a.addChild(this.distanceMeterGraphics),a},g.prototype.updateGraphics=function(){return this.spaceship.isSuperCannon()||this.cannonTemperatureView.updateGraphics(),this.spaceship.isOutOfWOrld()?this._updateOutOfWorldGraphics():this._updateInWorldGraphics(),this.pushToTop()},g.prototype._createSpaceshipGraphics=function(){var a;return a=new PIXI.Graphics,this._drawSpaceshipGraphics(a),a},g.prototype._drawSpaceshipGraphics=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;return m=this.spaceship.getVertices(),a.beginFill(15987699),d=.8,e=.75,g=this._getAveragePoint(m[0],m[1],d),h=this._getAveragePoint(m[2],m[1],d),i=this._getAveragePoint(g,h,e),j=this._getAveragePoint(g,h,1-e),f=m[0].Copy(),f.Add(m[2].GetNegative()),f.Normalize(),k=this._findMirrorPoint(j,f,m[0]),l=this._findMirrorPoint(i,f,m[0]),a.moveTo(m[0].x,m[0].y),a.lineTo(m[1].x,m[1].y),a.lineTo(m[2].x,m[2].y),a.lineTo(j.x,j.y),a.lineTo(i.x,i.y),a.lineTo(m[0].x,m[0].y),a.endFill(),b=this._getSpeedIndicatorAlpha(),c=7272695,a.beginFill(c,b),a.moveTo(m[0].x,m[0].y),a.lineTo(i.x,i.y),a.lineTo(j.x,j.y),a.lineTo(m[2].x,m[2].y),a.lineTo(k.x,k.y),a.lineTo(l.x,l.y),a.lineTo(m[0].x,m[0].y),a.endFill()},g.prototype._findMirrorPoint=function(a,b,c){var d,e,f,g,h,i;return i=a.Copy(),i.Add(c.GetNegative()),d=i.x*b.x+i.y*b.y,f=b.Copy(),f.Multiply(2*d),g=c.Copy(),g.Multiply(2),h=g.Copy(),h.Add(f),h.Multiply(.75),e=a.Copy().GetNegative(),e.Add(h),e},g.prototype._getSpeedIndicatorAlpha=function(){var a,b,c;return c=this.spaceship.getSpeed(),a=35,b=c/a},g.prototype._getAveragePoint=function(a,b,c){return new d.Vec2(f.average(a.x,b.x,c),f.average(a.y,b.y,c))},g.prototype._createOutOfWorldIndicatorGraphics=function(){var a;return a=new PIXI.Text("0",{font:"10pt Helvetica",fill:"EEEEEE",align:"center"}),a.anchor=new PIXI.Point(.5,.5),a.alpha=.8,a},g.prototype._updateInWorldGraphics=function(){var b,c;return c=this.camera.project(this.spaceship.getPosition()),b=a.B2DtoPIXI.toPoint(c),this.spaceshipGraphics.clear(),this._drawSpaceshipGraphics(this.spaceshipGraphics),this.distanceMeterGraphics.visible=!1,this.spaceshipGraphics.position=b,this.spaceshipGraphics.scale=new PIXI.Point(this.camera.getZoom(),this.camera.getZoom()),this.spaceshipGraphics.rotation=this.spaceship.getAngle()},g.prototype._updateOutOfWorldGraphics=function(){var b,c,d,e,f,g;return g=this.camera.project(this.spaceship.getPosition()),e=a.B2DtoPIXI.toPoint(g),b=this._getDistanceFromEdge(e),f=this._calculateIndicatorPosition(e),d=2,this.spaceshipGraphics.position=f,this.spaceshipGraphics.scale=new PIXI.Point(this.camera.getZoom()/d,this.camera.getZoom()/d),this.spaceshipGraphics.rotation=this.spaceship.getAngle(),c=this._calculateDistanceMeterPosition(e,f),this.distanceMeterGraphics.visible=!0,this.distanceMeterGraphics.setText(b),this.distanceMeterGraphics.position=c},g.prototype._getDistanceFromEdge=function(a){var b;return b=0,a.y<0?b=-a.y:a.y>this.container.height&&(b=a.y-this.container.height),a.x<0?b=-a.x:a.x>this.container.width&&(b=a.x-this.container.width),Math.ceil(b)},g.prototype._calculateIndicatorPosition=function(a){var b;return b=a.clone(),a.y<0?b.y=10:a.y>this.container.height&&(b.y=this.container.height-10),a.x<0?b.x=10:a.x>this.container.width&&(b.x=this.container.width-10),b},g.prototype._calculateDistanceMeterPosition=function(a,b){var c,d,e,f;return e=this.spaceshipGraphics.getLocalBounds(),f=e.width/this.spaceshipGraphics.scale.x,c=0,a.y<0?c=e.width+5:a.y>this.container.height&&(c=e.width+5),a.x<0?c=f+5+this.distanceMeterGraphics.width/2:a.x>this.container.width&&(c=-(f+5+this.distanceMeterGraphics.width/2)),d=b.clone(),d.x+=c,d},g}(c)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("bullet_view",["conversions","view"],function(a,c){var d;return d=function(c){function d(a,b,c){this.bullet=c,d.__super__.constructor.call(this,a,b)}return b(d,c),d.prototype.createGraphics=function(){var a;return a=new PIXI.Graphics,a.beginFill(16775309),a.drawCircle(0,0,this.bullet.getRadius()),a.endFill(),a},d.prototype.updateGraphics=function(){var b,c;return c=this.camera.project(this.bullet.getPosition()),b=a.B2DtoPIXI.toPoint(c),this.graphics.position=b,this.graphics.scale=new PIXI.Point(this.camera.getZoom(),this.camera.getZoom())},d.prototype.onAppearance=function(){return createjs.Sound.play("shoot",{volume:.1})},d}(c)})}.call(this),function(){define("earth_graphics_points",[],function(){var a;return a=[[[107.6879,1950.8501],[110.25271,1949.0547],[110.02057,1946.4349],[109.98702,1943.3578],[123.97756,1938.6138],[120.35493,1921.0041],[118.07724,1910.0041],[127.9421,1897.4081],[141.75417,1885.7273],[167.94409,1847.5008],[163.63432,1844.0126],[146.95245,1847.7628],[139.22536,1848.3095],[135.13432,1841.5061],[123.63433,1828.2175],[112.13433,1814.9883],[107.08115,1805.2076],[105.13433,1798.9013],[102.23158,1788.6513],[95.134328,1772.2581],[94.248038,1769.4972],[90.733808,1756.0999],[99.091668,1756.238],[109.35202,1772.2608],[114.60925,1782.2608],[117.10616,1790.0537],[121.42339,1798.0537],[128.67339,1807.143],[133.41805,1814.143],[134.77124,1819.1965],[136.13715,1825.6965],[139.01252,1832.5108],[144.13432,1833.7608],[149.00676,1832.229],[154.57545,1830.729],[158.24872,1829.2608],[162.81607,1826.8751],[169.31231,1822.9598],[174.08726,1819.3487],[184.61923,1813.2608],[187.17111,1810.664],[190.11324,1807.5561],[192.66893,1805.1518],[195.20204,1802.2246],[197.13432,1798.3481],[198.63432,1794.2608],[200.13432,1791.5427],[201.88432,1787.0975],[203.63432,1784.1255],[200.13432,1781.2201],[193.9568,1778.2877],[188.75763,1775.0387],[186.23598,1771.8167],[183.9215,1773.991],[177.90279,1777.7131],[167.13432,1774.4524],[164.87601,1772.6108],[158.28447,1766.9021],[153.14246,1758.6173],[155.21241,1745.736],[164.98586,1750.5193],[176.7144,1761.2042],[180.79447,1763.4381],[184.2144,1761.3532],[193.57513,1762.635],[206.3076,1766.7107],[220.15012,1765.8511],[236.88742,1769.384],[241.63742,1772.2618],[245.13432,1776.1694],[247.65453,1780.2716],[252.29874,1777.7723],[254.33797,1775.4601],[259.13434,1785.0445],[259.81964,1789.6128],[263.11924,1798.9727],[266.83014,1807.9708],[273.18394,1823.7589],[277.23814,1831.7608],[281.03364,1826.7608],[283.53364,1809.736],[285.88434,1794.8511],[288.13434,1791.0643],[291.47374,1782.9491],[297.68134,1764.9852],[301.79044,1758.2608],[305.29204,1754.7181],[309.25834,1752.873],[311.13434,1755.9158],[313.35424,1759.4807],[319.13434,1770.9723],[322.13434,1770.7608],[325.61944,1772.5108],[328.68784,1779.6019],[332.06234,1781.4029],[336.08504,1774.3009],[333.45774,1752.371],[332.68884,1724.1086],[331.16494,1706.6086],[309.36024,1661.052],[304.25564,1656.5227],[297.95414,1644.041],[293.63434,1633.7164],[288.13434,1626.2663],[270.19694,1608.2971],[252.80749,1598.636],[241.67617,1593.8446],[233.84432,1588.7849],[228.91896,1584.2363],[222.57398,1579.235],[217.39753,1575.1593],[205.50311,1569.2608],[198.96235,1567.2918],[189.39182,1569.3279],[186.36214,1570.6101],[179.13432,1573.5379],[157.51944,1572.629],[151.60527,1575.0233],[152.25071,1580.6258],[154.15708,1585.1258],[155.66385,1591.2608],[153.66358,1589.7608],[149.81522,1585.9604],[142.32222,1586.9401],[132.9955,1589.7242],[128.5924,1592.2608],[123.78711,1595.2608],[117.11458,1596.737],[121.21154,1590.8145],[124.63433,1589.7341],[120.45069,1584.9277],[112.45069,1582.1877],[100.13433,1588.8127],[88.634328,1594.9737],[75.760118,1602.2937],[75.634328,1606.8502],[76.634328,1611.6066],[75.134328,1616.2287],[80.145068,1614.2457],[85.079478,1609.7892],[88.469158,1605.3367],[99.253738,1595.7812],[107.86803,1591.6612],[102.1956,1598.2018],[96.613848,1605.2277],[100.69335,1606.2608],[104.13433,1608.1538],[98.651318,1611.2608],[94.266828,1614.7608],[89.693738,1618.2608],[85.612108,1621.3038],[74.580918,1625.7058],[67.384328,1625.3053],[65.134328,1623.8828],[67.384328,1620.9781],[68.339638,1618.1115],[63.839638,1620.4176],[56.728224,1624.6247],[50.228224,1627.6195],[29.720325,1636.6773],[24.966535,1640.9968],[17.674204,1654.7608],[14.181844,1658.7608],[8.6894039,1655.8128],[2.8001939,1653.3128],[.38318606,1658.2608],[5.4329761,1664.8845],[11.162896,1679.0816],[6.6557961,1683.2608],[5.1945639,1675.2608],[14.811634,1667.2608],[19.396405,1664.5108],[27.451115,1661.5478],[35.634325,1661.0478],[38.634325,1660.7608],[38.295425,1667.3284],[40.545424,1676.9728],[43.134324,1681.6552],[45.134324,1683.2608],[47.134324,1682.9332],[44.634324,1676.4531],[44.723214,1659.3375],[50.439654,1662.6276],[54.498414,1674.7452],[56.516534,1684.5947],[57.743064,1695.3511],[58.599324,1699.4202],[62.598198,1699.9563],[62.928618,1694.5268],[68.278118,1686.4394],[75.134328,1696.3118],[76.712308,1705.6959],[84.277348,1708.7154],[89.657108,1709.843],[97.045928,1710.4054],[100.77145,1731.814],[87.939958,1739.6826],[76.838528,1739.1312],[59.345414,1730.5447],[51.817914,1726.2608],[45.134324,1732.1175],[36.836575,1734.9779],[31.897185,1730.9633],[27.084895,1725.1639],[22.131825,1719.4446],[17.807104,1714.1097],[18.716104,1706.5937],[19.152435,1694.2705],[13.402434,1693.3304],[4.8445839,1692.2664],[1.1881861,1692.1135],[11.197556,1693.2229],[-14.750586,1691.3186],[-19.920496,1694.7977],[30.840836,1707.1917],[38.547586,1715.2275],[49.427996,1731.2562],[52.456086,1744.7562],[54.770986,1761.7608],[45.574946,1814.099],[36.290046,1826.766],[30.416956,1831.1778],[25.661516,1832.2608],[10.610306,1842.346],[2.9865961,1849.6995],[6.5557239,1867.19],[8.2197939,1875.1276],[17.134324,1886.7918],[37.134325,1916.7143],[66.169558,1940.6377],[88.169558,1948.6984],[88.6879,1950.8501]],[[154.1796,1711.8154],[149.46393,1708.7541],[147.21393,1697.2877],[146.91674,1691.7877],[138.13432,1678.9668],[137.13432,1675.7608],[141.6284,1665.7239],[149.3784,1660.9939],[152.63432,1671.2608],[150.17403,1673.4861],[160.83634,1684.6662],[164.69517,1687.994],[164.28463,1692.077],[163.64189,1696.6506],[167.48288,1711.3123],[161.08653,1712.8366],[161.1796,1711.8154]],[[112.34088,1690.5265],[104.45134,1687.7012],[92.634328,1686.7897],[81.151108,1684.7781],[77.775548,1681.2954],[81.049718,1674.7797],[88.876608,1664.2565],[93.429328,1660.249],[96.531828,1662.0671],[99.634328,1665.9827],[102.42084,1666.1189],[110.38433,1659.8459],[112.5828,1665.3605],[114.4009,1673.1909],[124.13433,1685.9962],[118.38433,1691.0861],[118.34088,1690.5265]],[[144.52942,1951.3765],[159.12532,1934.0108],[154.09923,1934.9438],[146.27251,1938.7982],[141.30424,1942.8653],[138.94947,1947.9368],[137.58857,1951.1868],[137.52942,1951.3765]],[[287.73534,1834.7142],[286.77504,1831.3441],[286.09624,1837.2608],[286.73534,1834.7142]],[[41.716664,1627.6149],[48.134324,1617.0066],[42.134324,1620.842],[36.800995,1628.5941],[36.716664,1627.6149]],[[40.134324,1616.7608],[40.982954,1614.2608],[37.134325,1616.7608],[36.285695,1619.2608],[36.134324,1616.7608]],[[55.692254,1606.4854],[49.134324,1613.2644],[52.754654,1610.5826],[52.692254,1606.4854]],[[76.134328,1584.2608],[75.134328,1583.2608],[74.134328,1584.2608],[75.134328,1585.2608],[75.134328,1584.2608]],[[148.13432,1581.7608],[146.34932,1580.7125],[147.13432,1582.7608],[148.91932,1583.8091],[148.13432,1581.7608]],[[65.634328,1578.0629],[90.634328,1574.3466],[103.13433,1571.9096],[119.38433,1567.6977],[131.13432,1564.212],[118.67377,1563.9837],[104.67377,1566.7756],[60.634328,1577.7668],[60.34328,1578.0629]]]})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("planet_view",["conversions","view","earth_graphics_points","pixi_animator"],function(a,c,d,e){var f;return f=function(c){function d(a,b,c){this.planet=c,d.__super__.constructor.call(this,a,b)}return b(d,c),d.prototype.createGraphics=function(){var a,b;return a=new PIXI.Graphics,b=new PIXI.Graphics,b.scale=new PIXI.Point(1/this.camera.getZoom(),1/this.camera.getZoom()),this.planetGraphics=this._getPlanetGraphics(),this.shieldGraphics=this._getShieldGraphics(),b.addChild(this.shieldGraphics),b.addChild(this.planetGraphics),a.addChild(b),this._bindPlanetEvents(),a},d.prototype.updateGraphics=function(){var b,c;return c=this.camera.project(this.planet.getPosition()),b=a.B2DtoPIXI.toPoint(c),this.graphics.position=b,this.graphics.scale=new PIXI.Point(this.camera.getZoom(),this.camera.getZoom())},d.prototype._getPlanetGraphics=function(){var a;return a=new PIXI.Graphics,a.beginFill(7715567),a.drawCircle(0,0,this._getScaledRadius()),a.endFill(),this._drawContinents(a),a},d.prototype._drawContinents=function(a){var b,c;return b=new PIXI.Graphics,c=PIXI.Texture.fromImage("images/continents.png"),b=new PIXI.Sprite(c),b.width=2*this._getScaledRadius(),b.height=2*this._getScaledRadius(),b.position=new PIXI.Point(-this._getScaledRadius(),-this._getScaledRadius()),a.addChild(b)},d.prototype._getShieldGraphics=function(){var a,b;return b=new PIXI.Graphics,a=.5*this.camera.getZoom(),b.lineStyle(a,16777215,.85),b.drawCircle(0,0,this._getScaledRadius()-a),b},d.prototype._getScaledRadius=function(){return this.planet.getRadius()*this.camera.getZoom()},d.prototype._bindPlanetEvents=function(){var a=this;return this.planet.events.on("rasingShield",function(){return a._raiseShieldAnimation()}),this.planet.events.on("dropingShield",function(){return a._dropShieldAnimation()})},d.prototype._raiseShieldAnimation=function(){var a,b,c;return c=this.planet.getShieldRadius(),a=this.planet.getRadius(),b=c/a,new e(this.shieldGraphics).animateParallel([{type:"grow",by:b,duration:200}])},d.prototype._dropShieldAnimation=function(){var a=this;return new e(this.shieldGraphics).animateParallel([{type:"grow",by:1.2,duration:200},{type:"fadeOut",duration:200}]).then(function(){return a.shieldGraphics.scale.x=a.shieldGraphics.scale.y=1,a.shieldGraphics.alpha=1})},d}(c)})}.call(this),function(){define("color_helpers",["math_helpers"],function(a){var b;return b={combineRgb:function(a,b,c){var d,e,f;return f=a<<16,e=b<<8,d=c+e+f},splitRgb:function(a){var b,c,d,e;return d=255,b=a&d,a>>=8,c=a&d,a>>=8,e=a&d,[e,c,b]},colorAverage:function(c,d,e){var f,g,h,i,j,k,l,m,n,o,p;return o=b.splitRgb(c),m=o[0],j=o[1],g=o[2],p=b.splitRgb(d),n=p[0],k=p[1],h=p[2],l=a.average(m,n,e),i=a.average(j,k,e),f=a.average(g,h,e),b.combineRgb(l,i,f)}}})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("astroid_view",["conversions","view","color_helpers"],function(a,c,d){var e;return e=function(c){function e(a,b,c){this.astroid=c,e.__super__.constructor.call(this,a,b)}return b(e,c),e.prototype.createGraphics=function(){var a;return a=new PIXI.Graphics,a.beginFill(this.getColor()),a.drawCircle(0,0,this.astroid.getRadius()),a.endFill(),a},e.prototype.updateGraphics=function(){var b,c;return c=this.camera.project(this.astroid.getPosition()),b=a.B2DtoPIXI.toPoint(c),this.graphics.position=b,this.graphics.scale=new PIXI.Point(this.camera.getZoom(),this.camera.getZoom())},e.prototype.getColor=function(){var a,b,c,e,f,g;return a=this.astroid.getDensity(),c=15567872,b=5373952,f=1,e=9,g=1-(a-f)/(e-f),d.colorAverage(c,b,g)},e}(c)})}.call(this),function(){define("camera",[],function(){var a;return a=function(){function a(a,b){this.viewportWidth=a,this.viewportHeight=b,this.zoomMultiplier=1,this.translation={x:0,y:0}}return a.prototype.zoom=function(a){return this.zoomMultiplier=a},a.prototype.lookAt=function(a,b){return this.translation={x:a,y:b}},a.prototype.project=function(a){var b;return b=a.Copy(),b.Multiply(this.zoomMultiplier),b.Add(new B2D.Vec2(this.translation.x*this.zoomMultiplier,this.translation.y*this.zoomMultiplier)),b.Add(new B2D.Vec2(this.viewportWidth/2,this.viewportHeight/2)),b},a.prototype.backProject=function(a){var b;return b=a.Copy(),b.Add(new B2D.Vec2(-this.viewportWidth/2,-this.viewportHeight/2)),b.Add(new B2D.Vec2(-this.translation.x*this.zoomMultiplier,-this.translation.y*this.zoomMultiplier)),b.Multiply(1/this.zoomMultiplier),b},a.prototype.getZoom=function(){return this.zoomMultiplier},a.prototype.getTranslation=function(){return this.translation},a}()})}.call(this),function(){define("pauseable_timeout",[],function(){var a;return a=function(){function a(a,b){this.callback=a,this.remainingTimeout=b}return a.prototype.start=function(){var a;return a=setTimeout(this.callback,this.remainingTimeout),this.handler=a,this.timeAtStart=new Date},a.setTimeout=function(b,c){var d;return d=new a(b,c),d.start(),d},a.prototype.clear=function(){return clearTimeout(this.handler)},a.prototype.pause=function(){var a;return a=new Date,this.remainingTimeout=this.remainingTimeout-(a-this.timeAtStart),console.log("pausing at "+a.getTime()+". remaningTime: "+this.remainingTimeout),clearTimeout(this.handler)},a.prototype.resume=function(){return console.log("resuming at "+(new Date).getTime()),this.start()},a}()})}.call(this),function(){define("wave",["events","pauseable_timeout"],function(a,b){var c;return c=function(){function c(b){this.wavePlan=b,this.events=new a,this.activeAstroids=this.wavePlan.length}return c.prototype.start=function(){return this.continueWave(0)},c.prototype.continueWave=function(a){var c,d=this;if(a!==this.wavePlan.length)return c=this.wavePlan[a],this.waveTimeoutHandler=b.setTimeout(function(){return d._spwanAstroid(c),d.continueWave(a+1)},c.offset)},c.prototype.pause=function(){return this.waveTimeoutHandler.pause()},c.prototype.resume=function(){return this.waveTimeoutHandler.resume()},c.prototype.destroy=function(){return this.waveTimeoutHandler.clear()},c.prototype._spwanAstroid=function(a){var b,c,d=this;return console.log("spwaning astroid"),c={radius:a.radius,position:a.position,density:a.density},b=window.EntityFactory.createAstroid(c),this.events.trigger("newAstroid",b),b.on("destroy",function(){return d.activeAstroids--,0===d.activeAstroids?d.events.trigger("waveDestroyed"):void 0})},c}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("astroid_spwaner",["typed_object","planet","wave","events","math_helpers"],function(a,c,d,e,f){var g;return g=function(a){function c(a){c.__super__.constructor.call(this,"astroidSpwaner"),this.width=a.width,this.height=a.height,this.waveIndex=0,this.events=new e,this.options={sizeRange:{min:3,max:4},timeOffset:{min:1e3,max:3e3,range:1e3,step:200},density:{min:1,max:9,step:.2,range:.4}}}return b(c,a),c.prototype.startSpwaning=function(){return this.startNextWave(0)},c.prototype.startNextWave=function(a){var b,c=this;return b=this.generageWavePlan(a),console.log("wave plan "+a),console.log,this.events.trigger("newWave",a),this.currentWave=new d(b),this.currentWave.events.on("newAstroid",function(a){return c.events.trigger("newAstroid",a)}),this.waveDestroyedCallback=function(){return c.waveIndex++,c.startNextWave(c.waveIndex)},this.currentWave.events.on("waveDestroyed",this.waveDestroyedCallback),this.currentWave.start()},c.prototype.generageWavePlan=function(a){var b,c,d,e;for(this.currentWaveCount=this._getRandomAstroidsCount(a),c=[],b=d=0,e=this.currentWaveCount;e>=0?e>=d:d>=e;b=e>=0?++d:--d)c.push(this._generageRandomAstroidPlan(a));return c},c.prototype.getWaveNumber=function(){return this.waveIndex},c.prototype.pause=function(){return this.currentWave.pause()},c.prototype.resume=function(){return this.currentWave.resume()},c.prototype.destroy=function(){return this.currentWave.events.off("waveDestroyed",this.waveDestroyedCallback),this.currentWave.destroy()},c.prototype._generageRandomAstroidPlan=function(a){var b,c;return c=this._getRandomRadius(),b={radius:c,position:this._getRandomPosition(c),offset:this._getRandomTimeOffset(a),density:this._getRandomDensity(a)},console.log(b),b},c.prototype._getRandomAstroidsCount=function(a){return 3+Math.floor(Math.pow(a+1,1.2))},c.prototype._getRandomRadius=function(){return f.random(this.options.sizeRange.min,this.options.sizeRange.max)},c.prototype._getRandomDensity=function(a){var b,c,d;return d=Math.min(this.options.density.min+this.options.density.step*a,this.options.density.max),c=Math.min(d+this.options.density.range,this.options.density.max),b=f.random(d,c)},c.prototype._getRandomTimeOffset=function(a){var b,c,d;return c=Math.max(this.options.timeOffset.max-this.options.timeOffset.step*a,this.options.timeOffset.min),d=Math.max(c-this.options.timeOffset.range,this.options.timeOffset.min),b=f.random(d,c)},c.prototype._getRandomPosition=function(a){var b,c,d,e;switch(e=_.random(3,4),d=_.random(-this.height/2,this.height/2),c=_.random(-this.width/2,this.width/2),b=.1,e){case 1:return{x:c,y:-this.height/2-a+b};case 2:return{x:c,y:this.height/2+a-b};case 3:return{x:-this.width/2-a+b,y:d};case 4:return{x:this.width/2+a-b,y:d}}},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("score",["typed_object"],function(a){var c;return c=function(a){function c(a){c.__super__.constructor.call(this,"score"),this.score=0,this.upInterval=a.upInterval,this.multiplier=1}return b(c,a),c.prototype.update=function(a){var b;return b=1e3*a,this.score+=b/this.upInterval*this.multiplier},c.prototype.setMultiplier=function(a){return this.multiplier=a},c.prototype.getScore=function(){return Math.ceil(this.score)},c.prototype.updateHighscore=function(){return this.score>this.getHighScore()?this._setAsHighScore():void 0},c.prototype.getHighScore=function(){var a;return a=window.localStorage.getItem("highscore"),null==a&&(a="0"),parseInt(a,10)},c.prototype._setAsHighScore=function(){return window.localStorage.setItem("highscore",this.getScore())},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("score_view",["view"],function(a){var c;return c=function(a){function c(a,b){this.score=b,c.__super__.constructor.call(this,a)}return b(c,a),c.prototype.createGraphics=function(){var a,b;return b=this.container.height/6,a=new PIXI.Text(this.score.getScore(),{fill:"white",font:""+b+"px DroidSans",align:"center"}),a.alpha=.6,a.position.x=10,a.position.y=this.container.height,a.anchor=new PIXI.Point(0,1),a},c.prototype.updateGraphics=function(){return this.graphics.setText(this.score.getScore())},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("start_screen_view",["events","view","math_helpers","pixi_animator"],function(a,c,d,e){var f;return f=function(a){function c(a){c.__super__.constructor.call(this,a)}return b(c,a),c.prototype.createGraphics=function(){var a,b;return a=new PIXI.Graphics,b=this._createStartButton(),a.addChild(b),a},c.prototype.fadeOut=function(){return new e(this.graphics).animate([{type:"fadeOut",duration:1e3}])},c.prototype._createStartButton=function(){var a,b,c=this;return a=this.container.height/3,b=new PIXI.Text("START",{fill:"white",font:""+a+"px DroidSans",align:"center"}),b.position.x=this.container.width/2,b.position.y=this.container.height/2,b.anchor=new PIXI.Point(.5,.5),b.buttonMode=!0,b.interactive=!0,b.click=b.touchstart=function(){return c.buttonClicked||c.events.trigger("gameStartClicked"),c.buttonClicked=!0},b},c}(c)})}.call(this),function(){define("pixi_layout",[],function(){var a;return a=function(){function a(){}return a.order=function(a,b){var c,d,e,f,g,h,i,j,k;for(g=this._calculatePadding(a,b),k=[],d=i=0,j=b.length;j>i;d=++i)e=b[d],c=e.element,c.anchor=new PIXI.Point(.5,0),c.x=a.width/2,h=c.width/c.height,c.height=a.height*e.height,c.width=c.height*h,c.y=0===d?0:f.element.y+f.element.height+g,a.addChild(c),k.push(f=e);return k},a._calculatePadding=function(a,b){var c,d;return d=this._sumHeights(b),c=a.height*(1-d)/(b.length-1)},a._sumHeights=function(a){var b;return b=_.chain(a).map(function(a){return a.height}).reduce(function(a,b){return a+b},0).value()},a}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("game_over_view",["events","view","pixi_animator","pixi_layout"],function(a,c,d,e){var f;return f=function(a){function c(a,b){this.score=b,c.__super__.constructor.call(this,a)}return b(c,a),c.prototype.createGraphics=function(){var a,b,c,d;return b=new PIXI.Graphics,a=this._createGameOverText(),d=this._createScoreText(),c=this._createHighScoreText(),this.refreshGraphics=this._createRefreshButton(),b.alpha=0,b.width=this.container.width,b.height=.8*this.container.height,b.y=.1*this.container.height,e.order(b,[{element:a,height:.3},{element:d,height:.2},{element:c,height:.1},{element:this.refreshGraphics,height:.4}]),b},c.prototype.updateGraphics=function(){},c.prototype.onAppearance=function(){var a=this;return this.fadeIn(),setTimeout(function(){return new d(a.refreshGraphics).animate([{type:"fadeIn",duration:1e3}]).then(function(){return a.refreshGraphics.interactive=!0})},1e3)},c.prototype.fadeIn=function(){return new d(this.graphics).animate([{type:"fadeIn",duration:1e3}])},c.prototype._createGameOverText=function(){return new PIXI.Text("GAME OVER",{fill:"white",font:"100px DroidSans",align:"center"})},c.prototype._createScoreText=function(){return new PIXI.Text("SCORE: "+this.score.getScore(),{fill:"white",font:"100px DroidSans",align:"center"})},c.prototype._createHighScoreText=function(){return this.score.getHighScore()===this.score.getScore()?new PIXI.Text("NEW HIGHSCORE!",{fill:"#ffcc00",font:"100px DroidSans",align:"center"}):new PIXI.Text("HIGHSCORE: "+this.score.getHighScore(),{fill:"white",font:"100px DroidSans",align:"center"})},c.prototype._createRefreshButton=function(){var a,b,c=this;return b=PIXI.Texture.fromImage("images/refresh.png"),a=new PIXI.Sprite(b),a.width=10,a.height=10,a.buttonMode=!0,a.interactive=!1,a.alpha=0,a.click=a.touchstart=function(){return c.events.trigger("gameStartClicked")},a},c}(c)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("wave_view",["view","box2d","conversions","pixi_animator"],function(a,c,d,e){var f;return f=function(a){function f(a,b,c){var d=this;this.astroidSpwaner=c,f.__super__.constructor.call(this,a,b),this.animationDirection=0,this.options={showDuration:1e3,hideDuration:1e3,stayDuration:2e3},this.newWaveHandler=function(a){return d.graphics.setText("WAVE "+(a+1)),d.graphics.alpha=0,d.animate()},this.astroidSpwaner.events.on("newWave",this.newWaveHandler)}return b(f,a),f.prototype.createGraphics=function(){return this.graphics=new PIXI.Text("WAVE 1",{font:"30pt DroidSans",fill:"white",align:"center"}),this.graphics.alpha=0,this.graphics.anchor=new PIXI.Point(.5,.5),this.graphics.x=this.container.width/2,this.graphics.y=this.container.height/2,this.graphics},f.prototype.updateGraphics=function(){var a,b;return b=this.camera.project(new c.Vec2(0,0)),a=d.B2DtoPIXI.toPoint(b),this.graphics.position=a},f.prototype.animate=function(){return new e(this.graphics).animate([{type:"fadeIn",duration:this.options.showDuration},{type:"stay",duration:this.options.stayDuration},{type:"fadeOut",duration:this.options.hideDuration}])},f.prototype.onDestroy=function(){return this.astroidSpwaner.events.off("newWave",this.newWaveHandler)},f}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("background_view",["view"],function(a){var c;
return c=function(a){function c(a,b){this.options={numberOfStarts:50,starRadiusRange:{min:3/8*b.getZoom(),max:5/8*b.getZoom()},startPoints:5,starRatio:.3,musicFadeOutDuration:1e3},c.__super__.constructor.call(this,a,b)}return b(c,a),c.prototype.createGraphics=function(){var a,b,c,d,e;for(a=new PIXI.Graphics,c=50,b=e=0;c>=0?c>e:e>c;b=c>=0?++e:--e)d=this._getRandomPosition(),this._drawRandomStar(a,d);return a},c.prototype.onAppearance=function(){},c.prototype.fadeAudioOut=function(){},c.prototype.onDestroy=function(){return this.sound.stop()},c.prototype._getRandomPosition=function(){var a,b;return a=_.random(0,this.container.width),b=_.random(0,this.container.height),new PIXI.Point(a,b)},c.prototype._drawRandomStar=function(a,b){var c,d;return c=Math.PI*Math.random(),d=_.random(this.options.starRadiusRange.min,this.options.starRadiusRange.max),this._drawStar(a,b,c,d)},c.prototype._drawStar=function(a,b,c,d){var e,f,g,h,i,j,k;for(a.beginFill(16777215),h=this._getPointInAngle(c,d,b),a.moveTo(h.x,h.y),i=Math.PI/this.options.startPoints,g=j=1,k=2*this.options.startPoints;k>=1?k>=j:j>=k;g=k>=1?++j:--j)e=i*g+c,f=g%2===0?d:d*this.options.starRatio,h=this._getPointInAngle(e,f,b),a.lineTo(h.x,h.y);return a.endFill()},c.prototype._getPointInAngle=function(a,b,c){var d,e;return d=b*Math.cos(a)+c.x,e=b*Math.sin(a)+c.y,new PIXI.Point(d,e)},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("shockwave_view",["view"],function(a){var c;return c=function(a){function c(a,b,d){this.shockWaveOrigin=d,c.__super__.constructor.call(this,a,b),this.radius=0,this.options={expensionRate:1e3}}return b(c,a),c.prototype.createGraphics=function(){var a;return this.shockwaveGraphics=new PIXI.Graphics,a=new PIXI.Graphics,a.addChild(this.shockwaveGraphics),a},c.prototype.updateGraphics=function(){var a,b;return a=this.getFrameTime(),this.radius+=a*this.options.expensionRate,b=this.camera.project(this.shockWaveOrigin),this.shockwaveGraphics.clear(),this.shockwaveGraphics.beginFill(15658734,.5),this.shockwaveGraphics.drawCircle(b.x,b.y,this.radius),this.shockwaveGraphics.endFill()},c.prototype.onAppearance=function(){return createjs.Sound.play("explosion")},c}(a)})}.call(this),function(){define("camera_shaker",[],function(){var a;return a=function(){function a(a,b){this.camera=a,this.options=null!=b?b:{},_.defaults(this.options,{duration:2e3,intensity:{min:-1,max:1}})}return a.prototype.shake=function(){var a;return a=new Date,this._startShaking(a,this.camera.getTranslation())},a.prototype._startShaking=function(a,b){var c,d,e,f,g=this;return d=new Date,d-a>this.options.duration?void 0:(c=(d-a)/this.options.duration,e=this._getRandomShake(c)+b.x,f=this._getRandomShake(c)+b.y,this.camera.lookAt(e,f),requestAnimFrame(function(){return g._startShaking(a,b)}))},a.prototype._getRandomShake=function(a){var b;return b=1-a,_.random(this.options.intensity.min,this.options.intensity.max)*b},a}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("tutorial_view",["view","pixi_animator"],function(a,c){var d;return d=function(a){function d(a,b,c){var e,f=this;d.__super__.constructor.call(this,a,b),e=function(a){return c.events.off("newAstroid",e),f.astroidToFollow=a,f._showFireTutorial(a)},c.events.on("newAstroid",e)}return b(d,a),d.prototype.createGraphics=function(){var a,b,c;return b=new PIXI.DisplayObjectContainer,a=PIXI.Texture.fromImage("images/finger.png"),this.moveTutorialGraphics=new PIXI.DisplayObjectContainer,this.moveFingerGraphics=new PIXI.Sprite(a),c=546.43/972.332,this.moveFingerGraphics.height=100,this.moveFingerGraphics.width=100*c,this.moveTutorialGraphics.addChild(this.moveFingerGraphics),this.fireTutorialGraphics=new PIXI.DisplayObjectContainer,this.fireFingerGraphics=new PIXI.Sprite(a),this.fireFingerGraphics.height=100,this.fireFingerGraphics.width=100*c,this.fireTutorialGraphics.visible=!1,this.fireTutorialGraphics.addChild(this.fireFingerGraphics),b.addChild(this.moveTutorialGraphics),b.addChild(this.fireTutorialGraphics),this._showMoveTutorial(),b},d.prototype.updateGraphics=function(){var a;return null!=this.astroidToFollow?(a=this.camera.project(this.astroidToFollow.getPosition()),this.fireTutorialGraphics.position=a):void 0},d.prototype._showMoveTutorial=function(){var a,b;return a=.8*this.container.width,b=.2*this.container.height,this.moveTutorialGraphics.position.x=a,this.moveTutorialGraphics.position.y=b,this._showTappingFinger(this.moveFingerGraphics,[1e3,1e3,1e3])},d.prototype._showFireTutorial=function(){return this.fireTutorialGraphics.visible=!0,this._showTappingFinger(this.fireFingerGraphics,[2e3,2e3,100,100,100,100,1e3,1e3,100,100,100,100])},d.prototype._showTappingFinger=function(a,b){var d=this;return async.series({fadeIn:function(b){var d;return d=new c(a).animate([{type:"fadeIn",duration:700}]),d.then(function(){return b()})},tap:function(c){return d._tapAnimation(a,b,c)},fadeOut:function(b){var d;return d=new c(a).animate([{type:"fadeOut",duration:700}]),d.then(function(){return b()})}})},d.prototype._tapAnimation=function(a,b,c){var d,e,f,g,h;return g=a.position.x,h=a.position.y,e=0,f=b.length,(d=function(){return async.series({tap:function(c){return a.position.x=g-5,a.position.y=h-5,a.scale.x=.1,a.scale.y=.1,setTimeout(function(){return c()},b[e])},hover:function(c){return a.position.x=g,a.position.y=h,a.scale.x=.11,a.scale.y=.11,setTimeout(function(){return c()},b[e])}},function(){return e++,f>e?d():c()})})()},d}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("powerup_view",["view","conversions","pixi_animator"],function(a,c,d){var e;return e=function(a){function e(a,b,c){this.powerup=c,e.__super__.constructor.call(this,a,b)}return b(e,a),e.prototype.createGraphics=function(){var a,b,c,d=this;return a=new PIXI.Graphics,c=PIXI.Texture.fromImage(this.image),b=new PIXI.Sprite(c),b.width=2*this.powerup.getRadius(),b.height=2*this.powerup.getRadius(),b.position.x=-this.powerup.getRadius(),b.position.y=-this.powerup.getRadius(),a.addChild(b),this.powerup.events.on("applied",function(){return d.showAppliedAnimation()}),a},e.prototype.updateGraphics=function(){var a,b;return b=this.camera.project(this.powerup.getPosition()),a=c.B2DtoPIXI.toPoint(b),this.graphics.position=a,this.graphics.scale=new PIXI.Point(this.camera.getZoom(),this.camera.getZoom())},e.prototype.showAppliedAnimation=function(){var a,b,c,e=this;return c=new PIXI.Text(this.text,{fill:"white",font:"20pt DroidSans",align:"center"}),c.anchor=new PIXI.Point(.5,.5),c.position=this.graphics.position,this.container.addChild(c),a=new d(c).animate([{type:"fadeOut",duration:500}]),a.then(function(){return e.container.removeChild(c)}),b=new d(this.graphics).animate([{type:"fadeOut",duration:500}]),this.setActivePromise(Promise.all([a,b]))},e}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("speed_powerup_view",["powerup_view","conversions","pixi_animator"],function(a){var c,d;return c=function(a){function c(){return d=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.image="images/speed.png",c.prototype.text="+ SPEED",c}(a)})}.call(this),function(){define("powerup_spawner",["box2d","math_helpers","shield_powerup","pauseable_timeout"],function(a,b,c,d){var e;return e=function(){function e(a){null==a&&(a={}),this.width=a.width,this.height=a.height,this.planet=a.planet,this.config={appearance:{min:15e3,max:25e3}},this.powerups={speed:{generator:function(){return window.EntityFactory.createSpeedPowerup()},frequency:.2*.4},bullet_mass:{generator:function(){return window.EntityFactory.createBulletMassPowerup()},frequency:.2*.4},shockwave:{generator:function(){return window.EntityFactory.createShockwavePowerup()},frequency:.2*.2},shield:{generator:function(){return window.EntityFactory.createShieldPowerup()},frequency:.8}}}return e.prototype.startSpwaning=function(){return this._spawnNext()},e.prototype.pause=function(){return this.timeoutHandler.pause()},e.prototype.resume=function(){return this.timeoutHandler.resume()},e.prototype.destroy=function(){return this.timeoutHandler.clear()},e.prototype._spawnNext=function(){var a,b=this;return a=_.random(this.config.appearance.min,this.config.appearance.max),this.timeoutHandler=d.setTimeout(function(){return console.log("spawn powerup"),b._spawnPowerup(),b._spawnNext()},a)},e.prototype._spawnPowerup=function(){var b,d=this;return b=this._getRandomPowerup(),b instanceof c&&(this.lastShieldSpawned=b,this.lastShieldSpawned.events.on("destroy",function(){return delete d.lastShieldSpawned})),b.setPosition(new a.Vec2(0,0)),b.goToDirection(this._getRandomAngle())},e.prototype._getRandomAngle=function(){return b.random(0,2*Math.PI)},e.prototype._getRandomPosition=function(){var c,d,e;return c=10,d=b.random(-this.width/2+c,this.width/2-c),e=b.random(-this.height/2+c,this.height/2-c),new a.Vec2(d,e)},e.prototype._getRandomPowerup=function(){var a,b;return a=this._getAvilablePowerups(),(b=this._sampleWithFrequencies(a).generator)()},e.prototype._getAvilablePowerups=function(){var a;return a=_(this.powerups).clone(),(this.planet.hasShield()||null!=this.lastShieldSpawned)&&delete a.shield,a},e.prototype._sampleWithFrequencies=function(a){var c,d,e,f,g;f=_(a).reduce(function(a,b){return a+b.frequency},0),e=b.random(0,f),c=0;for(d in a)if(g=a[d],c+=g.frequency,c>e)return g},e}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("bullet_mass_powerup_view",["powerup_view","conversions","pixi_animator"],function(a){var c,d;return c=function(a){function c(){return d=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.image="images/mass.png",c.prototype.text="+ BULLET POWER",c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("shockwave_powerup_view",["powerup_view","conversions","pixi_animator"],function(a){var c,d;return c=function(a){function c(){return d=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.image="images/shockwave.png",c.prototype.text="SHOCKWAVE",c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("shield_powerup_view",["powerup_view","conversions","pixi_animator"],function(a){var c,d;return c=function(a){function c(){return d=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.image="images/shield.png",c.prototype.text="SHIELD",c}(a)})}.call(this),function(){define("game",["entity_factory","world","world_view","spaceship","player","spaceship_view","bullet_view","planet_view","astroid_view","camera","planet","astroid_spwaner","score","score_view","start_screen_view","game_over_view","wave_view","background_view","box2d","shockwave_view","camera_shaker","stopwatch","tutorial_view","views_collection","speed_powerup_view","powerup_spawner","bullet_mass_powerup_view","shockwave_powerup_view","shield_powerup_view"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){var D;return D=function(){function d(a,b){var c;this.stage=a,this.config=b,this.gameState="startScreen",this.viewportWidth=this.stage.getWidth(),this.viewportHeight=this.stage.getHeight(),this.views=new x,this.pixleToUnitRatio=this.viewportHeight/45,this.zoom=this.pixleToUnitRatio,this.cameraShiftDivider=10,this.stopwatch=new v,c=this.calculateWorldDimenstion(),this.worldWidth=c[0],this.worldHeight=c[1]}return d.prototype.start=function(){var a=this;return this.stage.events.on("frame",function(){return a.update()}),this.views.add("startScreen",this.createStartScreen(),1),this.createGameObjects()},d.prototype.startGame=function(){return this.gameState="gameOn",this.player.control(this.spaceship),this.views.add("scoreView",this.createScoreView(),1),this.astroidSpwaner.startSpwaning(),this.powerupSpawner.startSpwaning()},d.prototype.reset=function(){return this.world.destroy(),this.player.destroy(),this.spaceship.destroy(),this.stage.clear(),delete this.world},d.prototype.endGame=function(){return this.score.updateHighscore(),this.views.add("gameOverScreen",this.createGameOverScreen()),this.views.remove("scoreView"),this.views.get("backgroundView").fadeAudioOut(),this.player.stopControling(),this.stopwatch.setMark("gameOver"),this.powerupSpawner.destroy(),this.astroidSpwaner.destroy(),this.gameState="gameOver"},d.prototype.createGameObjects=function(){return this.world=this.createWorld(),window.EntityFactory=new a(this.world,this.config),this.spaceship=window.EntityFactory.createSpaceship(),navigator.isCocoonJS&&this.spaceship.setSuperCannon(),this.spaceship.setPosition(new s.Vec2(0,-20)),this.planet=this.createPlanet(),this.astroidSpwaner=this.createAstroidSpawner(),this.camera=this.createCamera(),this.views.add("worldView",this.createWorldView()),this.player=new e(this.camera,this.world),this.score=this.createScore(),this.powerupSpawner=this.createPowerupSpawner(),this.views.add("waveView",this.createWaveView(),1),this.views.add("backgroundView",this.createBackgroundView(),-1)},d.prototype.createWorld=function(){var a;return a=new b({size:{width:this.worldWidth,height:this.worldHeight}})},d.prototype.createPlanet=function(){var a,b=this;return a=window.EntityFactory.createPlanet(),a.setPosition(new s.Vec2(0,0)),a.events.on("worldDistruction",function(a){return"gameOver"!==b.gameState?(b.showGameOverEffect(a),b.endGame(),console.log("game over")):void 0}),a},d.prototype.createAstroidSpawner=function(){return new l({width:this.worldWidth,height:this.worldHeight,planet:this.planet})},d.prototype.createPowerupSpawner=function(){return new z({width:this.worldWidth,height:this.worldHeight,planet:this.planet})},d.prototype.createCamera=function(){return this.camera=new j(this.stage.getWidth(),this.stage.getHeight()),this.camera.zoom(this.zoom),this.camera},d.prototype.createWorldView=function(){var a;return a=new c(this.stage.getContainer(),this.camera,this.world),this.registerViewTypes(a),a},d.prototype.createScoreView=function(){return new n(this.stage.getContainer(),this.score)},d.prototype.createScore=function(){var a;return a=new m({upInterval:300}),this.astroidSpwaner.events.on("newWave",function(b){return a.setMultiplier(b+1)}),a},d.prototype.createWaveView=function(){return new q(this.stage.getContainer(),this.camera,this.astroidSpwaner)},d.prototype.createStartScreen=function(){var a,b=this;return a=new o(this.stage.getContainer()),a.events.on("gameStartClicked",function(){return b.views.add("tutorialView",b.createTutorialView(),1),b.views.get("startScreen").fadeOut().then(function(){return b.views.remove("startScreen")}),b.startGame()}),a},d.prototype.createGameOverScreen=function(){var a,b=this;return a=new p(this.stage.getContainer(),this.score),a.events.on("gameStartClicked",function(){return b.views.remove("waveView"),b.views.remove("shockwaveView"),b.views.remove("gameOverScreen"),b.reset(),b.createGameObjects(),b.startGame()}),a},d.prototype.createBackgroundView=function(){return new r(this.stage.getContainer(),this.camera)},d.prototype.createTutorialView=function(){var a;return new(a=this.config.tutorialViewType)(this.stage.getContainer(),this.camera,this.astroidSpwaner)},d.prototype.registerViewTypes=function(a){return a.registerView("spaceship",f),a.registerView("bullet",g),a.registerView("astroid",i),a.registerView("planet",h),a.registerView("score",n),a.registerView("speedPowerup",y,-1),a.registerView("bulletMassPowerup",A,-1),a.registerView("shockwavePowerup",B,-1),a.registerView("shieldPowerup",C,-1)},d.prototype.showGameOverEffect=function(a){var b;return this.world.startShockWave(a),u(b=new u(this.camera)),b.shake(),this.views.add("shockwaveView",new t(this.stage.getContainer(),this.camera,a))},d.prototype.calculateWorldDimenstion=function(){var a,b,c,d,e,f,g,h;for(g=this.viewportWidth/this.pixleToUnitRatio,f=this.viewportHeight/this.pixleToUnitRatio,c=g,b=f,a=h=0;5>=h;a=++h)d=g/this.cameraShiftDivider,e=f/this.cameraShiftDivider,g=c+d,f=b+e;return[g,f]},d.prototype.pause=function(){return"gameOver"!==this.gameState?(this.stopwatch.pause(),this.powerupSpawner.pause(),this.astroidSpwaner.pause()):void 0},d.prototype.resume=function(){return"gameOver"!==this.gameState?(this.stopwatch.resume(),this.powerupSpawner.resume(),this.astroidSpwaner.resume()):void 0},d.prototype.update=function(){var a;return a=this.stopwatch.getFrameTime(),("gameOver"!==this.gameState||"gameOver"===this.gameState&&this.stopwatch.getTimeSinceMark("gameOver")<3e3)&&this.world.update(a),"gameOver"!==this.gameState&&this.updateParalex(),"gameOn"===this.gameState&&this.score.update(a),this.views.render()},d.prototype.updateParalex=function(){var a;return a=this.spaceship.getPosition(),this.camera.lookAt(-a.x/this.cameraShiftDivider,-a.y/this.cameraShiftDivider)},d}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("desktop_tutorial_view",["view","math_helpers","pixi_animator"],function(a,c,d){var e;return e=function(a){function e(a,b){e.__super__.constructor.call(this,a,b)}return b(e,a),e.prototype.createGraphics=function(){var a,b,c,d,e,f;return b=new PIXI.Graphics,a=30,d=5,c=a+d,e=c,f=this.container.height/2,this.keysTutorialContainter=new PIXI.Graphics,this._drawMovmentTutorial(this.keysTutorialContainter,e,f,a,d),this._drawCannonTutorial(this.keysTutorialContainter,e,f,a,d),this.keysTutorialContainter.alpha=0,this.objectiveTutorialContainer=new PIXI.Graphics,this._drawObjectiveTutorial(this.objectiveTutorialContainer,e,f,a,d),this.objectiveTutorialContainer.alpha=0,b.addChild(this.keysTutorialContainter),b.addChild(this.objectiveTutorialContainer),b},e.prototype.onAppearance=function(){var a=this;return new d(this.keysTutorialContainter).animate([{type:"fadeIn",duration:1e3},{type:"stay",duration:1e3},{type:"fadeOut",duration:1e3},{type:"stay",duration:1e3}]).then(function(){return new d(a.objectiveTutorialContainer).animate([{type:"fadeIn",duration:1e3},{type:"stay",duration:1e3},{type:"fadeOut",duration:1e3}])})},e.prototype._drawMovmentTutorial=function(a,b,c,d,e){var f,g;return f=d+e,this._drawArrowGraphcis(a,{position:new PIXI.Point(b,c-d),keysize:d,charSet:["A","D","W"],padding:5}),this._drawArrowGraphcis(a,{position:new PIXI.Point(b+4*f,c-d),keysize:d,charSet:["⬅","➡","⬆"],padding:5}),g=new PIXI.Text("/",{font:"12pt Helvetica",fill:"EEEEEE",align:"center"}),g.position=new PIXI.Point(b+3.5*f,c),g.anchor=new PIXI.Point(.5,.5),a.addChild(g)},e.prototype._drawArrowGraphcis=function(a,b){var c,d,e,f,g,h=this;return g=b.position,e=b.keysize,c=b.charSet,f=b.padding,f=5,d=function(b,c,d){return h._drawKey(a,c,d,e,e,b)},d(c[0],g.x,g.y),d(c[1],g.x+2*(f+e),g.y),d(c[2],g.x+f+e,g.y-f-e)},e.prototype._drawCannonTutorial=function(a,b,c,d,e){var f;return f=d+e,this._drawKey(a,b,c+1*f,7*f-e,d,"SPACE")},e.prototype._drawKey=function(a,b,c,d,e,f){return a.lineStyle(2,15658734,.7),a.beginFill(1190457),a.drawRect(b,c,d,e),a.endFill(),f=new PIXI.Text(f,{font:"12pt DroidSans",fill:"white",align:"center"}),f.position=new PIXI.Point(b+d/2,c+e/2),f.anchor=new PIXI.Point(.5,.5),a.addChild(f)},e.prototype._drawObjectiveTutorial=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n=this;return h=d+e,a.lineStyle(3,14540253,1),m=[b+h,c],k=m[0],l=m[1],a.drawCircle(k,l,d),g=function(b,c){return n._drawSwiftLine(a,k,l,d,c,b)},g(90,30),g(145,20),g(180,20),g(215,20),g(270,30),f=30,a.drawCircle(k+h+f,l,5),a.drawCircle(k+h+2*f,l,5),a.drawCircle(k+h+3*f,l,5),i=20,j=30,a.moveTo(k+3*h+3*f,l-i/2),a.lineTo(k+3*h+3*f,l+i/2),a.lineTo(k+3*h+3*f-j,l),a.lineTo(k+3*h+3*f,l-i/2),a.endFill()},e.prototype._drawSwiftLine=function(a,b,c,d,e,f){var g;return g=this._getPointOnCircle(b,c,d,f),a.moveTo(g.x,g.y),a.lineTo(g.x-e,g.y)},e.prototype._getPointOnCircle=function(a,b,d,e){return new PIXI.Point(a+Math.cos(c.d2r(e))*d,b+Math.sin(c.d2r(e))*d)},e}(a)})}.call(this),function(){define("configuration",["tutorial_view","desktop_tutorial_view"],function(a,b){var c;return c={Mobile:{type:"mobile",Spaceship:{speed:150,angularSpeed:100,width:2,length:3,cannonHeatRate:.13,cannonCooldownRate:.3,angularDamping:5,linearDamping:1.7},tutorialViewType:a},Desktop:{type:"desktop",Spaceship:{speed:150,angularSpeed:50,width:2,length:3,cannonHeatRate:.13,cannonCooldownRate:.3,angularDamping:4,linearDamping:1.5},tutorialViewType:b}}})}.call(this),function(){requirejs.config({baseUrl:"scripts",paths:{pixi:"../bower_components/pixi/bin/pixi.dev"},shim:{pixi:{deps:[],exports:"PIXI"}}}),require(["stage","asset_loader","splashscreen_view","game","dom_events","configuration"],function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q;return k=function(a){var b;return b=new Promise(function(b){return setTimeout(function(){return b()},a)})},p=function(a){var d;return d=["images/splashscreen.png"],b.loadGraphicAssets(d).then(function(){var b;return b=new c(a.getContainer()),a.events.on("frame",function(){return b.render()}),Promise.resolve(b)})},h=function(a,b){var c,d,f;return d=!1,c=function(){return d?void 0:(a.pause(),b.pause(),d=!0)},f=function(){return d?(a.resume(),b.resume(),d=!1):void 0},e.bind(window,"blur",function(){return console.log("blur"),c()}),e.bind(window,"focus",function(){return console.log("focus"),f()}),CocoonJS.App.setAppShouldFinishCallback(function(){return console.log("app should finish"),c(),CocoonJS.App.showMessageBox("Confirmation","Are you sure you want to quit?","Yes","No"),CocoonJS.App.onMessageBoxConfirmed.addEventListener(function(){return CocoonJS.App.forceToFinish()}),CocoonJS.App.onMessageBoxDenied.addEventListener(function(){return f()}),!1}),CocoonJS.App.onSuspending.addEventListener(function(){return console.log("onSuspending"),c()}),CocoonJS.App.onActivated.addEventListener(function(){return console.log("onActivated"),f()})},m=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},window.isCocoonJS=function(){return navigator.isCocoonJS},o=function(a,b){var c,d;return d=document.getElementById(a).innerHTML,c=document.getElementById(b),c.innerHTML=d},null!=document.getElementById("container")?(isCocoonJS()?(o("cocoon-template","container"),n={width:window.innerWidth,height:window.innerHeight,container:document.body},i=f.Mobile):(o("desktop-template","container"),j=document.getElementById("game"),n={width:j.clientWidth,height:j.clientHeight,container:j},i=f.Desktop),q=new a(n),g=[{src:"shoot.ogg",id:"shoot"},{src:"explosion.ogg",id:"explosion"}],l=["images/refresh.png","images/finger.png","images/continents.png","images/mass.png","images/shield.png","images/shockwave.png","images/speed.png"],q.startMainLoop(),p(q).then(function(a){return Promise.all([b.loadAudioAssets(g),b.loadGraphicAssets(l),k(2e3)]).then(function(){return a.fadeOut().then(function(){var b;return a.destroy(),b=new d(q,i),b.start(),h(b,q)})})["catch"](function(a){return console.log(a)})})):void 0})}.call(this),define("main",function(){});